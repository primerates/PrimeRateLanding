<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Loan Status Dashboard</title>
  

  <style>
/* ==========================================
   MAIN STYLES - Layout, Cards, Metrics
   ========================================== */

* {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
      min-height: 100vh;
      background: linear-gradient(135deg, #0f172a 0%, #581c87 50%, #0f172a 100%);
      padding: 2rem;
    }

    .container {
      max-width: 1680px;  /* Cinematic wide desktop */
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      font-size: 1.875rem;
      font-weight: bold;
      color: white;
    }

    .header .client-badge {
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      background: rgba(30, 41, 59, 0.5);
      backdrop-filter: blur(12px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(168, 85, 247, 0.2);
      color: #d1d5db;
      font-size: 0.875rem;
    }

    .header-buttons {
      display: flex;
      gap: 0.75rem;
      align-items: center;
    }

    .screen-share-btn {
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      background: rgba(30, 41, 59, 0.5);
      backdrop-filter: blur(12px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(59, 130, 246, 0.3);
      color: #93c5fd;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      height: fit-content;
    }

    .screen-share-btn:hover {
      background: rgba(30, 41, 59, 0.7);
      border-color: rgba(59, 130, 246, 0.5);
      color: #dbeafe;
      transform: translateY(-2px);
      box-shadow: 0 12px 20px -5px rgba(59, 130, 246, 0.4);
    }

    .screen-share-btn svg {
      width: 16px;
      height: 16px;
    }

    .live-indicator {
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      background: rgba(30, 41, 59, 0.5);
      backdrop-filter: blur(12px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(59, 130, 246, 0.4);
      color: #60a5fa;
      font-size: 0.875rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      height: fit-content;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .live-indicator:hover {
      background: rgba(30, 41, 59, 0.7);
      border-color: rgba(59, 130, 246, 0.6);
      color: #93c5fd;
      transform: translateY(-2px);
      box-shadow: 0 12px 20px -5px rgba(59, 130, 246, 0.4);
    }

    .live-dot {
      width: 6px;
      height: 6px;
      background: #3b82f6;
      border-radius: 50%;
      position: relative;
      animation: livePulse 2s ease-in-out infinite;
      flex-shrink: 0;
    }

    .live-dot::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100%;
      height: 100%;
      background: #3b82f6;
      border-radius: 50%;
      animation: liveGlow 2s ease-in-out infinite;
    }

    @keyframes livePulse {
      0%, 100% {
        transform: scale(1);
        opacity: 1;
      }
      50% {
        transform: scale(1.2);
        opacity: 0.8;
      }
    }

    @keyframes liveGlow {
      0%, 100% {
        box-shadow: 0 0 8px #3b82f6, 0 0 16px #3b82f6, 0 0 24px #3b82f6;
        opacity: 0.7;
      }
      50% {
        box-shadow: 0 0 12px #60a5fa, 0 0 24px #60a5fa, 0 0 36px #60a5fa, 0 0 48px #60a5fa;
        opacity: 1;
      }
    }

    .nav-card {
      background: rgba(30, 41, 59, 0.5);
      backdrop-filter: blur(12px);
      border-radius: 1rem;
      padding: 1rem;
      border: 1px solid rgba(168, 85, 247, 0.2);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    }

    /* Performance Card Styles */
    .performance-card {
      position: relative;
      background: rgba(30, 41, 59, 0.5);
      backdrop-filter: blur(12px);
      border-radius: 1rem;
      padding: 1.5rem;
      border: 1px solid rgba(168, 85, 247, 0.2);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 1rem;

    /* Metrics Customization Button */
    .metrics-customize-btn {
      position: absolute;
      top: 1.5rem;
      right: 1.5rem;
      background: rgba(168, 85, 247, 0.1);
      border: 1px solid rgba(168, 85, 247, 0.3);
      border-radius: 0.5rem;
      padding: 0.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0.6;
      z-index: 10;
    }

    .metrics-customize-btn:hover {
      opacity: 1;
      background: rgba(168, 85, 247, 0.2);
      border-color: rgba(168, 85, 247, 0.5);
      transform: translateY(-2px);
    }

    .metrics-customize-btn svg {
      width: 16px;
      height: 16px;
      color: #d8b4fe;
      transition: transform 0.3s ease;
    }

    .metrics-customize-btn:hover svg {
      transform: rotate(90deg);
      color: white;
    }
    }

    @media (max-width: 1400px) {
      .performance-card {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    @media (max-width: 1200px) {
      .performance-card {
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      }
    }

    .metric-item {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .metric-label {
      color: #94a3b8;
      font-size: 0.875rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .metric-value {
      color: white;
      font-size: 1.5rem;
      font-weight: bold;
      display: flex;
      align-items: baseline;
      gap: 0.5rem;
    }

    .metric-unit {
      font-size: 1rem;
      color: #94a3b8;
      font-weight: 500;
    }

    .metric-change {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.875rem;
      font-weight: 600;
      padding: 0.25rem 0.5rem;
      border-radius: 0.375rem;
    }

    .metric-change.positive {
      color: #10b981;
      background: rgba(16, 185, 129, 0.1);
    }

    .metric-change.negative {
      color: #ef4444;
      background: rgba(239, 68, 68, 0.1);
    }

    .metric-change svg {
      width: 14px;
      height: 14px;
    }

    .nav-container {
      display: flex;
      justify-content: center;
    }

    .nav-pills {
      display: inline-flex;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .nav-pill {
      padding: 0.5rem 1rem;
      border-radius: 9999px;
      font-size: 0.875rem;
      font-weight: 500;
      border: none;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .nav-pill.active {
      background: linear-gradient(to right, #9333ea, #ec4899);
      color: white;
      box-shadow: 0 10px 15px -3px rgba(147, 51, 234, 0.4);
      transform: scale(1.05);
    }

    .nav-pill:not(.active) {
      background: transparent;
      color: #d8b4fe;
    }

    .nav-pill:not(.active):hover {
      background: rgba(71, 85, 105, 0.5);
      color: white;
    }



    /* Bento Style Icons for Nav Pills */
    .nav-pill-icon {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1.5px solid currentColor;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      flex-shrink: 0;
    }

    .nav-pill-icon svg {
      width: 11px;
      height: 11px;
      stroke: currentColor;
      fill: none;
      transition: all 0.3s;
    }

    .nav-pill.active .nav-pill-icon {
      background: white;
      border-color: white;
    }

    .nav-pill.active .nav-pill-icon svg {
      stroke: #9333ea;
    }

    .nav-pill:not(.active) .nav-pill-icon {
      background: transparent;
      border-color: rgba(216, 180, 254, 0.6);
    }

    .nav-pill:not(.active):hover .nav-pill-icon {
      background: rgba(255, 255, 255, 0.1);
      border-color: white;
      transform: scale(1.1);
    }
    /* Documents Dropdown */
    .nav-pill-dropdown {
      position: relative;
      display: inline-block;
    }

    .docs-dropdown-menu {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 0.5rem;
      background: rgba(30, 41, 59, 0.98);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(168, 85, 247, 0.3);
      border-radius: 0.75rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      min-width: 160px;
      z-index: 1000;
      overflow: hidden;
    }

    .docs-dropdown-menu.show {
      display: block;
    }

    .dropdown-option {
      padding: 0.75rem 1rem;
      color: #d8b4fe;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.875rem;
    }

    .dropdown-option:hover {
      background: rgba(168, 85, 247, 0.2);
      color: white;
    }

    .dropdown-option.selected {
      background: linear-gradient(to right, rgba(147, 51, 234, 0.3), rgba(236, 72, 153, 0.3));
      color: white;
      font-weight: 600;
    }



    /* Vendors Dropdown */
    .vendors-dropdown-menu {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 0.5rem;
      background: rgba(30, 41, 59, 0.98);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(168, 85, 247, 0.3);
      border-radius: 0.75rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      min-width: 160px;
      z-index: 1000;
      overflow: hidden;
    }


    /* Rate Lock Dropdown */
    .ratelock-dropdown-menu {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 0.5rem;
      background: rgba(30, 41, 59, 0.98);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(168, 85, 247, 0.3);
      border-radius: 0.75rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      min-width: 160px;
      z-index: 1000;
      overflow: hidden;
    }



    /* Figures Dropdown */
    .figures-dropdown-menu {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 0.5rem;
      background: rgba(30, 41, 59, 0.98);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(168, 85, 247, 0.3);
      border-radius: 0.75rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      min-width: 160px;
      z-index: 1000;
      overflow: hidden;
    }



    /* Team Dropdown */
    .team-dropdown-menu {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 0.5rem;
      background: rgba(30, 41, 59, 0.98);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(168, 85, 247, 0.3);
      border-radius: 0.75rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      min-width: 160px;
      z-index: 1000;
      overflow: hidden;
    }



    /* Loan Details Dropdown */
    .loandetails-dropdown-menu {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 0.5rem;
      background: rgba(30, 41, 59, 0.98);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(168, 85, 247, 0.3);
      border-radius: 0.75rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      min-width: 160px;
      z-index: 1000;
      overflow: hidden;
    }



    /* Activity Dropdown */
    .activity-dropdown-menu {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 0.5rem;
      background: rgba(30, 41, 59, 0.98);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(168, 85, 247, 0.3);
      border-radius: 0.75rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      min-width: 160px;
      z-index: 1000;
      overflow: hidden;
    }



    /* Notes Dropdown */
    .notes-dropdown-menu {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 0.5rem;
      background: rgba(30, 41, 59, 0.98);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(168, 85, 247, 0.3);
      border-radius: 0.75rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      min-width: 160px;
      z-index: 1000;
      overflow: hidden;
    }

    .notes-dropdown-menu.show {
      display: block;
    }
    .activity-dropdown-menu.show {
      display: block;
    }
    .loandetails-dropdown-menu.show {
      display: block;
    }
    .team-dropdown-menu.show {
      display: block;
    }
    .figures-dropdown-menu.show {
      display: block;
    }
    .ratelock-dropdown-menu.show {
      display: block;
    }

    .vendors-dropdown-menu.show {
      display: block;
    }
    .dropdown-arrow {
      transition: transform 0.3s;
    }

    .nav-pill-dropdown.open .dropdown-arrow {
      transform: rotate(180deg);
    }

    .badge {
      padding: 0.125rem 0.375rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: bold;
    }

    .nav-pill.active .badge {
      background: rgba(255, 255, 255, 0.2);
      color: white;
    }

    .nav-pill:not(.active) .badge {
      background: rgba(168, 85, 247, 0.2);
      color: #d8b4fe;
    }

    .two-col-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0;
    }

    .card {
      background: rgba(30, 41, 59, 0.5);
      backdrop-filter: blur(12px);
      padding: 1.5rem;
      border: 1px solid rgba(168, 85, 247, 0.2);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    }


    /* Hidden state for cards */
    .card.hidden {
      display: none;
    }

    .card:first-child {
      border-radius: 1rem 0 0 1rem;
      border-right: none;
    }

    .card:last-child {
      border-radius: 0 1rem 1rem 0;
    }

    .docs-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .docs-list-scrollable {
      max-height: 280px;
      overflow-y: auto;
      overflow-x: hidden;
      padding-right: 0.5rem;
      scrollbar-width: thin;
      scrollbar-color: rgba(139, 92, 246, 0.5) rgba(148, 163, 184, 0.1);
    }

    .docs-list-scrollable::-webkit-scrollbar {
      width: 12px;
    }

    .docs-list-scrollable::-webkit-scrollbar-track {
      background: rgba(148, 163, 184, 0.15);
      border-radius: 10px;
      border: 1px solid rgba(168, 85, 247, 0.2);
    }

    .docs-list-scrollable::-webkit-scrollbar-thumb {
      background: linear-gradient(to bottom, #8b5cf6, #ec4899);
      border-radius: 10px;
      transition: all 0.3s ease;
      border: 2px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 2px 8px rgba(139, 92, 246, 0.4);
    }

    .docs-list-scrollable::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(to bottom, #a78bfa, #f472b6);
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.6);
      transform: scale(1.1);
    }

    .docs-list-scrollable::-webkit-scrollbar-thumb:active {
      background: linear-gradient(to bottom, #7c3aed, #db2777);
      box-shadow: 0 2px 6px rgba(139, 92, 246, 0.8);
    }

    .scroll-indicator {
      text-align: center;
      padding: 0.5rem;
      color: #94a3b8;
      font-size: 0.75rem;
      display: none;
      animation: pulse 2s ease-in-out infinite;
    }

    .scroll-indicator.visible {
      display: block;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }

    .doc-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 0.5rem;
      cursor: pointer;
      border-radius: 0.5rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }

    .doc-item:hover {
      background: rgba(71, 85, 105, 0.2);
    }

    .doc-item-content {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex: 1;
      transition: all 0.3s;
    }

    .eye-icon {
      position: absolute;
      right: -30px;
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      color: #d8b4fe;
      width: 24px;
      height: 24px;
      pointer-events: auto;
      cursor: pointer;
    }

    .doc-item:hover .eye-icon {
      right: 10px;
      opacity: 1;
    }

    .magnify-icon {
      position: absolute;
      right: -60px;
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      color: #a78bfa;
      width: 24px;
      height: 24px;
      pointer-events: auto;
      cursor: pointer;
    }

    .doc-item:hover .magnify-icon {
      right: 40px;
      opacity: 1;
    }

    /* Icon Tooltips */
    .icon-tooltip {
      position: absolute;
      bottom: -30px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(15, 23, 42, 0.95);
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.75rem;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
      z-index: 100;
      border: 1px solid rgba(168, 85, 247, 0.3);
    }

    .eye-icon:hover .icon-tooltip,
    .magnify-icon:hover .icon-tooltip {
      opacity: 1;
    }

    /* Expandable Details Card */
    .details-card {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1), 
                  opacity 0.3s ease,
                  margin 0.3s ease;
      opacity: 0;
      margin-top: 0;
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(88, 28, 135, 0.7) 100%);
      backdrop-filter: blur(12px);
      border-radius: 1rem;
      padding: 0 1.5rem;
      border: 1px solid rgba(168, 85, 247, 0.3);
    }

    .details-card.expanded {
      max-height: 500px;
      opacity: 1;
      margin-top: 1rem;
      padding: 1.5rem;
    }

    .details-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid rgba(168, 85, 247, 0.2);
    }

    .details-title {
      font-size: 1.25rem;
      font-weight: bold;
      color: white;
    }

    .close-details-btn {
      background: transparent;
      border: none;
      color: #d8b4fe;
      cursor: pointer;
      font-size: 1.5rem;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 0.5rem;
      transition: all 0.2s;
    }

    .close-details-btn:hover {
      background: rgba(168, 85, 247, 0.2);
      color: white;
    }

    .details-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }

    .detail-item {
      background: rgba(15, 23, 42, 0.5);
      padding: 1rem;
      border-radius: 0.5rem;
      border: 1px solid rgba(168, 85, 247, 0.2);
    }

    .detail-label {
      color: #d8b4fe;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      margin-bottom: 0.5rem;
    }

    .detail-value {
      color: white;
      font-size: 1rem;
      font-weight: 500;
    }

    /* Rolldown Table Styles */
    .table-container {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1), 
                  opacity 0.3s ease,
                  margin 0.3s ease;
      opacity: 0;
      margin-top: 0;
    }

    .table-container.expanded {
      max-height: 600px;
      opacity: 1;
      margin-top: 0;
    }

    .table-wrapper {
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(88, 28, 135, 0.7) 100%);
      backdrop-filter: blur(12px);
      border-radius: 1rem;
      padding: 1.5rem;
      border: 1px solid rgba(168, 85, 247, 0.3);
    }

    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .table-title-dropdown-wrapper {
      position: relative;
    }

    .clickable-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
      transition: all 0.2s;
      user-select: none;
    }

    .clickable-title:hover {
      color: #d8b4fe;
    }

    .dropdown-arrow {
      width: 18px;
      height: 18px;
      transition: transform 0.3s;
    }

    .clickable-title:hover .dropdown-arrow {
      color: #d8b4fe;
    }

    .title-dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 0.5rem;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(168, 85, 247, 0.3);
      border-radius: 0.5rem;
      padding: 0.5rem;
      min-width: 200px;
      display: none;
      z-index: 100;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
    }

    .title-dropdown-menu.active {
      display: block;
    }

    .dropdown-option {
      padding: 0.75rem 1rem;
      color: #cbd5e1;
      cursor: pointer;
      border-radius: 0.375rem;
      transition: all 0.2s;
      font-size: 0.875rem;
    }

    .dropdown-option:hover {
      background: rgba(168, 85, 247, 0.2);
      color: white;
    }

    .dropdown-option.selected {
      background: rgba(168, 85, 247, 0.3);
      color: white;
      font-weight: 600;
    }

    .table-title {
      font-size: 1.125rem;
      font-weight: bold;
      color: white;
    }

    .close-table-btn {
      background: transparent;
      border: none;
      color: #d8b4fe;
      cursor: pointer;
      font-size: 1.5rem;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 0.5rem;
      transition: all 0.2s;
    }

    .close-table-btn:hover {
      background: rgba(168, 85, 247, 0.2);
      color: white;
    }

    .scrollbar-custom::-webkit-scrollbar {
      height: 8px;
    }

    .scrollbar-custom::-webkit-scrollbar-track {
      background: transparent;
    }

    .scrollbar-custom::-webkit-scrollbar-thumb {
      background: transparent;
      border-radius: 4px;
    }

    .scrollbar-custom {
      scrollbar-width: thin;
      scrollbar-color: transparent transparent;
    }

    .table-body-wrapper {
      max-height: 280px; /* Approximately 4 rows */
      overflow-y: auto;
      overflow-x: hidden;
    }

    .table-body-wrapper::-webkit-scrollbar {
      width: 8px;
    }

    .table-body-wrapper::-webkit-scrollbar-track {
      background: rgba(15, 23, 42, 0.3);
      border-radius: 4px;
    }

    .table-body-wrapper::-webkit-scrollbar-thumb {
      background: rgba(168, 85, 247, 0.5);
      border-radius: 4px;
    }

    .table-body-wrapper::-webkit-scrollbar-thumb:hover {
      background: rgba(168, 85, 247, 0.7);
    }

    .table-scroll-wrapper {
      max-height: 340px;
      overflow-y: auto;
    }

    .table-scroll-wrapper::-webkit-scrollbar {
      width: 8px;
    }

    .table-scroll-wrapper::-webkit-scrollbar-track {
      background: rgba(15, 23, 42, 0.3);
      border-radius: 4px;
    }

    .table-scroll-wrapper::-webkit-scrollbar-thumb {
      background: rgba(168, 85, 247, 0.5);
      border-radius: 4px;
    }

    .table-scroll-wrapper::-webkit-scrollbar-thumb:hover {
      background: rgba(168, 85, 247, 0.7);
    }

    .data-table tbody::-webkit-scrollbar {
      width: 8px;
    }

    .data-table tbody::-webkit-scrollbar-track {
      background: rgba(15, 23, 42, 0.3);
      border-radius: 4px;
    }

    .data-table tbody::-webkit-scrollbar-thumb {
      background: rgba(168, 85, 247, 0.5);
      border-radius: 4px;
    }

    .data-table tbody::-webkit-scrollbar-thumb:hover {
      background: rgba(168, 85, 247, 0.7);
    }

    .scroll-track {
      height: 8px;
      background: rgba(71, 85, 105, 0.5);
      border-radius: 9999px;
      overflow: hidden;
      cursor: pointer;
      margin-bottom: 0.5rem;
    }

    .scroll-indicator {
      height: 100%;
      background: linear-gradient(to right, #9333ea, #ec4899);
      border-radius: 9999px;
      cursor: grab;
      transition: all 0.1s;
    }

    .scroll-indicator:active {
      cursor: grabbing;
    }

    .data-table {
      width: 100%;
      min-width: max-content;
      border-collapse: collapse;
    }

    .data-table thead tr {
      border-bottom: 1px solid rgba(168, 85, 247, 0.3);
    }

    .data-table th {
      text-align: left;
      padding: 0.75rem 1rem;
      color: #d8b4fe;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
      user-select: none;
    }

    .data-table th:hover {
      color: white;
    }

    .data-table td {
      padding: 0.75rem 1rem;
      color: #cbd5e1;
      font-size: 0.875rem;
      border-bottom: 1px solid rgba(71, 85, 105, 0.5);
      white-space: nowrap;
    }

    .data-table tbody tr {
      transition: all 0.2s;
    }

    .data-table tbody tr:hover {
      background: rgba(71, 85, 105, 0.3);
    }

    .sort-icon {
      display: inline-block;
      margin-left: 0.5rem;
      width: 16px;
      height: 16px;
      vertical-align: middle;
    }

    .accent-line {
      width: 4px;
      height: 3rem;
      border-radius: 9999px;
    }

    .accent-blue {
      background: linear-gradient(to bottom, #3b82f6, #2563eb);
      box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
    }

    .accent-purple {
      background: linear-gradient(to bottom, #8b5cf6, #7c3aed);
      box-shadow: 0 0 10px rgba(168, 85, 247, 0.5);
    }

    .accent-emerald {
      background: linear-gradient(to bottom, #10b981, #059669);
      box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
    }

    .doc-content {
      flex: 1;
    }

    .doc-title {
      color: white;
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .doc-subtitle {
      color: #94a3b8;
      font-size: 0.875rem;
    }

    .doc-date {
      position: absolute;
      right: 4.5rem;
      top: 50%;
      transform: translateY(-50%);
      color: #64748b;
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .custom-label-date {
      right: 4.5rem;
    }

    .doc-item:hover .doc-date {
      right: 8rem;
    }

    .doc-count-badge {
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(168, 85, 247, 0.2);
      border: 1px solid rgba(168, 85, 247, 0.3);
      color: #d8b4fe;
      padding: 0.25rem 0.625rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .doc-item:hover .doc-count-badge {
      background: rgba(168, 85, 247, 0.3);
      border-color: rgba(168, 85, 247, 0.5);
      color: white;
      right: 4.5rem;
      transform: translateY(-50%) scale(1.05);
    }

    .icon-card {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 300px;
      position: relative;
    }

    .stacked-icon {
      width: 210px;
      height: 210px;
      flex-shrink: 0;
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Modal Styles */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(8px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(88, 28, 135, 0.95) 100%);
      backdrop-filter: blur(20px);
      border-radius: 1rem;
      padding: 2rem;
      border: 1px solid rgba(168, 85, 247, 0.3);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8);
      max-width: 500px;
      width: 90%;
      position: relative;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .modal-title {
      font-size: 1.5rem;
      font-weight: bold;
      color: white;
    }

    .close-btn {
      background: transparent;
      border: none;
      color: #d8b4fe;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 0.5rem;
      transition: all 0.2s;
    }

    .close-btn:hover {
      background: rgba(168, 85, 247, 0.2);
      color: white;
    }

    .modal-date {
      color: #d8b4fe;
      font-size: 0.875rem;
      margin-bottom: 1.5rem;
    }

    .form-group {
      margin-bottom: 1.25rem;
    }

    .form-label {
      display: block;
      color: white;
      font-size: 0.875rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .form-select,
    .form-input {
      width: 100%;
      padding: 0.75rem;
      background: rgba(15, 23, 42, 0.5);
      border: 1px solid rgba(168, 85, 247, 0.3);
      border-radius: 0.5rem;
      color: white;
      font-size: 0.875rem;
      transition: all 0.2s;
    }

    .form-select:focus,
    .form-input:focus {
      outline: none;
      border-color: rgba(168, 85, 247, 0.6);
      box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
    }

    .form-select option {
      background: #1e293b;
      color: white;
    }

    .save-btn {
      width: 100%;
      padding: 0.75rem;
      background: linear-gradient(to right, #9333ea, #ec4899);
      border: none;
      border-radius: 0.5rem;
      color: white;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 1.5rem;
    }

    .save-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px -5px rgba(147, 51, 234, 0.5);
    }

    .save-btn:active {
      transform: translateY(0);
    }

    /* Choice Buttons */
    .choice-buttons {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }

    .choice-btn {
      flex: 1;
      padding: 1.5rem;
      background: rgba(15, 23, 42, 0.5);
      border: 2px solid rgba(168, 85, 247, 0.3);
      border-radius: 0.75rem;
      color: white;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
    }

    .choice-btn:hover {
      background: rgba(147, 51, 234, 0.3);
      border-color: rgba(168, 85, 247, 0.6);
      transform: translateY(-2px);
      box-shadow: 0 10px 20px -5px rgba(147, 51, 234, 0.3);
    }

    /* File Upload Button */
    .file-upload-btn {
      display: block;
      width: 100%;
      padding: 0.75rem;
      background: rgba(15, 23, 42, 0.5);
      border: 2px dashed rgba(168, 85, 247, 0.3);
      border-radius: 0.5rem;
      color: #d8b4fe;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }

    .file-upload-btn:hover {
      border-color: rgba(168, 85, 247, 0.6);
      background: rgba(168, 85, 247, 0.1);
      color: white;
    }

    /* Document Checkboxes */
    .doc-checkbox-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-top: 0.5rem;
    }

    .doc-checkbox-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      background: rgba(15, 23, 42, 0.3);
      border: 1px solid rgba(168, 85, 247, 0.2);
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .doc-checkbox-item:hover {
      background: rgba(15, 23, 42, 0.5);
      border-color: rgba(168, 85, 247, 0.4);
    }

    .doc-checkbox-item input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
      accent-color: #9333ea;
    }

    .doc-checkbox-label {
      color: white;
      font-size: 0.875rem;
      flex: 1;
      cursor: pointer;
    }

    .back-btn {
      background: rgba(71, 85, 105, 0.5);
      border: 1px solid rgba(148, 163, 184, 0.3);
      color: #cbd5e1;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      cursor: pointer;
      font-size: 0.875rem;
      transition: all 0.2s;
    }

    .back-btn:hover {
      background: rgba(71, 85, 105, 0.7);
      color: white;
    }

    .status-pending {
      color: #ef4444;
      font-weight: 600;
    }

    /* Toggle Button Styles */
    .view-toggle-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
      width: 40px;
      height: 40px;
      background: rgba(168, 85, 247, 0.2);
      border: 1px solid rgba(168, 85, 247, 0.3);
      border-radius: 0.5rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 10;
    }

    .view-toggle-btn:hover {
      background: rgba(168, 85, 247, 0.3);
      border-color: rgba(168, 85, 247, 0.5);
      transform: scale(1.05);
    }

    .view-toggle-btn svg {
      width: 24px;
      height: 24px;
      color: #d8b4fe;
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .view-toggle-btn.active svg {
      transform: rotate(180deg);
    }

      width: 24px;
      height: 24px;
    }

    /* Team Popup Modal */
    .team-popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(8px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .team-popup-overlay.active {
      display: flex;
      opacity: 1;
    }

    .team-popup-container {
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.98) 0%, rgba(30, 41, 59, 0.98) 100%);
      border: 2px solid rgba(168, 85, 247, 0.3);
      border-radius: 1rem;
      padding: 2rem;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      transform: scale(0.9);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .team-popup-overlay.active .team-popup-container {
      transform: scale(1);
    }

    .team-popup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(168, 85, 247, 0.2);
    }

    .team-popup-title {
      font-size: 1.5rem;
      font-weight: bold;
      background: linear-gradient(to right, #a78bfa, #ec4899);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .team-popup-close {
      background: transparent;
      border: none;
      color: #d8b4fe;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 0.5rem;
      transition: all 0.2s;
    }

    .team-popup-close:hover {
      background: rgba(168, 85, 247, 0.2);
      color: white;
    }

    .team-popup-content {
      max-height: 60vh;
      overflow-y: auto;
      padding-right: 0.5rem;
      scrollbar-width: thin;
      scrollbar-color: rgba(139, 92, 246, 0.5) rgba(148, 163, 184, 0.1);
    }

    .team-popup-content::-webkit-scrollbar {
      width: 12px;
    }

    .team-popup-content::-webkit-scrollbar-track {
      background: rgba(148, 163, 184, 0.15);
      border-radius: 10px;
      border: 1px solid rgba(168, 85, 247, 0.2);
    }

    .team-popup-content::-webkit-scrollbar-thumb {
      background: linear-gradient(to bottom, #8b5cf6, #ec4899);
      border-radius: 10px;
      transition: all 0.3s ease;
      border: 2px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 2px 8px rgba(139, 92, 246, 0.4);
    }

    .team-popup-content::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(to bottom, #a78bfa, #f472b6);
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.6);
    }

    .team-member-card {
      background: rgba(15, 23, 42, 0.5);
      border: 1px solid rgba(168, 85, 247, 0.2);
      border-radius: 0.75rem;
      padding: 1rem;
      margin-bottom: 0.75rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
    }

    .team-member-card:hover {
      background: rgba(15, 23, 42, 0.7);
      border-color: rgba(168, 85, 247, 0.4);
      transform: translateX(4px);
      box-shadow: 0 8px 16px rgba(139, 92, 246, 0.2);
    }

    .team-member-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 0.5rem;
    }

    .team-member-avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.125rem;
      color: white;
    }

    .team-member-info {
      flex: 1;
    }

    .team-member-name {
      font-weight: 600;
      color: white;
      font-size: 1.125rem;
      margin-bottom: 0.25rem;
    }

    .team-member-role {
      color: #94a3b8;
      font-size: 0.875rem;
    }

    .team-member-label {
      display: inline-block;
      background: linear-gradient(to right, rgba(139, 92, 246, 0.2), rgba(236, 72, 153, 0.2));
      border: 1px solid rgba(168, 85, 247, 0.3);
      color: #d8b4fe;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-top: 0.5rem;
    }

    /* Vendor Choice Popup */
    .vendor-choice-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(8px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10001;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .vendor-choice-overlay.active {
      display: flex;
      opacity: 1;
    }

    .vendor-choice-container {
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.98) 0%, rgba(30, 41, 59, 0.98) 100%);
      border: 2px solid rgba(168, 85, 247, 0.3);
      border-radius: 1rem;
      padding: 2rem;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      transform: scale(0.9);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .vendor-choice-overlay.active .vendor-choice-container {
      transform: scale(1);
    }

    .vendor-choice-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(168, 85, 247, 0.2);
    }

    .vendor-choice-title {
      font-size: 1.5rem;
      font-weight: bold;
      background: linear-gradient(to right, #a78bfa, #ec4899);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .vendor-choice-close {
      background: transparent;
      border: none;
      color: #d8b4fe;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 0.5rem;
      transition: all 0.2s;
    }

    .vendor-choice-close:hover {
      background: rgba(168, 85, 247, 0.2);
      color: white;
    }

    .vendor-choice-buttons {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .vendor-choice-btn {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(236, 72, 153, 0.2) 100%);
      border: 2px solid rgba(168, 85, 247, 0.3);
      color: white;
      padding: 1.5rem;
      border-radius: 0.75rem;
      font-size: 1.125rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-align: center;
    }

    .vendor-choice-btn:hover {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(236, 72, 153, 0.3) 100%);
      border-color: rgba(168, 85, 247, 0.5);
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(139, 92, 246, 0.3);
    }

    /* Stage Cards for Overview */
    .stage-cards {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .stage-card {
      background: rgba(15, 23, 42, 0.5);
      padding: 1rem 1rem 1rem 1.25rem;
      border-radius: 0.75rem;
      border: 1px solid rgba(168, 85, 247, 0.2);
      border-left: 4px solid;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .stage-card::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      border-radius: 0.75rem;
      padding: 2px;
      background: linear-gradient(45deg, transparent, transparent);
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .stage-card[data-color="#3b82f6"] {
      border-left-color: #3b82f6;
    }

    .stage-card[data-color="#3b82f6"]:hover::before {
      background: linear-gradient(90deg, #3b82f6, #60a5fa, #3b82f6);
      opacity: 1;
      animation: borderGlow 2s linear infinite;
    }

    .stage-card[data-color="#8b5cf6"] {
      border-left-color: #8b5cf6;
    }

    .stage-card[data-color="#8b5cf6"]:hover::before {
      background: linear-gradient(90deg, #8b5cf6, #a78bfa, #8b5cf6);
      opacity: 1;
      animation: borderGlow 2s linear infinite;
    }

    .stage-card[data-color="#10b981"] {
      border-left-color: #10b981;
    }

    .stage-card[data-color="#10b981"]:hover::before {
      background: linear-gradient(90deg, #10b981, #34d399, #10b981);
      opacity: 1;
      animation: borderGlow 2s linear infinite;
    }

    @keyframes borderGlow {
      0% {
        background-position: 0% 50%;
      }
      100% {
        background-position: 200% 50%;
      }
    }

    @keyframes rollUp {
      0% {
        opacity: 1;
        transform: translateY(0) rotateX(0deg);
        max-height: 100px;
      }
      100% {
        opacity: 0;
        transform: translateY(-40px) rotateX(15deg);
        max-height: 0;
      }
    }

    @keyframes rollDown {
      0% {
        opacity: 0;
        transform: translateY(-40px) rotateX(-15deg);
        max-height: 0;
      }
      100% {
        opacity: 1;
        transform: translateY(0) rotateX(0deg);
        max-height: 100px;
      }
    }

    @keyframes slotSpin {
      0% {
        transform: translateY(0);
        opacity: 1;
      }
      15% {
        transform: translateY(-800px);
        opacity: 0.3;
      }
      30% {
        transform: translateY(-1600px);
        opacity: 0.3;
      }
      45% {
        transform: translateY(-2400px);
        opacity: 0.3;
      }
      60% {
        transform: translateY(-3200px);
        opacity: 0.3;
      }
      75% {
        transform: translateY(-4000px);
        opacity: 0.3;
      }
      85% {
        transform: translateY(-200px);
        opacity: 0.7;
      }
      95% {
        transform: translateY(20px);
        opacity: 0.9;
      }
      100% {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes slotSpinSlow {
      0% {
        transform: translateY(0);
        opacity: 1;
      }
      20% {
        transform: translateY(-600px);
        opacity: 0.4;
      }
      40% {
        transform: translateY(-1200px);
        opacity: 0.4;
      }
      60% {
        transform: translateY(-200px);
        opacity: 0.6;
      }
      80% {
        transform: translateY(15px);
        opacity: 0.9;
      }
      100% {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .doc-item.slot-spinning {
      animation: slotSpin 1.2s cubic-bezier(0.25, 0.1, 0.25, 1) forwards;
    }

    .doc-item.slot-spinning-slow {
      animation: slotSpinSlow 1.5s cubic-bezier(0.25, 0.1, 0.25, 1) forwards;
    }

    .doc-item.rolling-up {
      animation: rollUp 0.9s cubic-bezier(0.4, 0.0, 0.2, 1) forwards;
    }

    .doc-item.rolling-down {
      animation: rollDown 1.0s cubic-bezier(0.4, 0.0, 0.2, 1) forwards;
    }

    .stage-card:hover {
      background: rgba(15, 23, 42, 0.7);
      border-color: rgba(168, 85, 247, 0.4);
      transform: translateX(4px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
    }

    .stage-title {
      font-size: 1rem;
      font-weight: 600;
      color: white;
      margin-bottom: 0.25rem;
    }

    .stage-count {
      color: #94a3b8;
      font-size: 0.875rem;
      font-weight: 500;
    }

    /* Pie Chart Styles */
    .pie-chart-container {
      position: absolute;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 280px;
      height: 280px;
    }

    .pie-chart {
      width: 280px;
      height: 280px;
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Morph Animation Classes */
    .morphing {
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .fade-out {
      opacity: 0;
      transform: scale(0.95);
    }

    .fade-in {
      opacity: 1;
      transform: scale(1);
    }

    /* Service Tracker Styles */
    .service-tracker-container {
      margin-top: 0.25rem;
      opacity: 0;
      transform: translateY(-20px);
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .service-tracker-container.active {
      opacity: 1;
      transform: translateY(0);
    }

    .service-tracker-card {
      background: rgba(30, 41, 59, 0.5);
      backdrop-filter: blur(12px);
      border-radius: 1rem;
      padding: 1.5rem;
      border: 1px solid rgba(168, 85, 247, 0.2);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    }

    .tracker-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .tracker-close-btn {
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #f87171;
      width: 32px;
      height: 32px;
      border-radius: 0.5rem;
      cursor: pointer;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      line-height: 1;
    }

    .tracker-close-btn:hover {
      background: rgba(239, 68, 68, 0.3);
      border-color: rgba(239, 68, 68, 0.5);
      transform: scale(1.1);
    }

    .tracker-title-dropdown-wrapper {
      position: relative;
    }

    .tracker-title {
      font-size: 1.25rem;
      font-weight: bold;
      color: white;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
      user-select: none;
    }

    .tracker-title:hover {
      color: #d8b4fe;
    }

    .tracker-dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 0.5rem;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(168, 85, 247, 0.3);
      border-radius: 0.5rem;
      padding: 0.5rem;
      min-width: 200px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 100;
    }

    .tracker-dropdown-menu.active {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .service-wrapper {
      background: rgba(15, 23, 42, 0.4);
      border-radius: 0.75rem;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid rgba(168, 85, 247, 0.15);
    }

    .service-wrapper:last-child {
      margin-bottom: 0;
    }

    .service-name {
      font-size: 1rem;
      font-weight: 600;
      color: white;
      margin-bottom: 0.375rem;
    }


    /* Timeline Horizontal Scroll Wrapper */
    .timeline-scroll-wrapper {
      overflow-x: auto;
      overflow-y: hidden;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: thin;
      scrollbar-color: rgba(168, 85, 247, 0.5) rgba(30, 41, 59, 0.3);
      padding-bottom: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .timeline-scroll-wrapper::-webkit-scrollbar {
      height: 6px;
    }

    .timeline-scroll-wrapper::-webkit-scrollbar-track {
      background: rgba(30, 41, 59, 0.3);
      border-radius: 3px;
    }

    .timeline-scroll-wrapper::-webkit-scrollbar-thumb {
      background: rgba(168, 85, 247, 0.5);
      border-radius: 3px;
      transition: background 0.3s;
    }

    .timeline-scroll-wrapper::-webkit-scrollbar-thumb:hover {
      background: rgba(168, 85, 247, 0.7);
    }
    .progress-timeline {
      position: relative;
      display: flex;
      align-items: center;
      padding: 2rem 0 1rem 0;
      min-height: 80px;
      margin-bottom: 0.75rem;
    }

    .progress-line-background {
      position: absolute;
      left: 0;
      top: 2rem;
      width: calc(100% - 3.5rem);
      height: 3px;
      background: rgba(148, 163, 184, 0.2);
      border-radius: 2px;
    }

    .progress-line {
      position: absolute;
      left: 0;
      top: 2rem;
      height: 3px;
      background: linear-gradient(to right, #ec4899, #8b5cf6);
      border-radius: 2px;
      transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 1;
    }

    .milestones-container {
      position: relative;
      width: 100%;
      display: flex;
      justify-content: space-between;
    }

    .milestone {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 1;
    }

    .milestone-circle {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #3b82f6;
      box-shadow: 0 0 10px rgba(59, 130, 246, 0.7);
      position: absolute;
      top: -4px;
      transform: translateY(-50%);
    }

    .milestone-label {
      font-size: 0.75rem;
      color: #3b82f6;
      text-align: center;
      white-space: nowrap;
      font-weight: 500;
      margin-top: 1.25rem;
    }

    .milestone-date {
      font-size: 0.875rem;
      color: #64748b;
      text-align: center;
      margin-top: 0.25rem;
      white-space: nowrap;
    }

    .progress-percentage {
      position: absolute;
      right: 0;
      top: 2rem;
      transform: translateY(-50%);
      font-size: 0.875rem;
      font-weight: bold;
      color: #94a3b8;
      transition: color 0.3s;
      margin-left: 0.5rem;
    }

    .progress-percentage.complete {
      color: #10b981;
    }


    /* ========================================
       RESPONSIVE DESIGN - CINEMATIC WIDE
       ======================================== */

    /* Tablet (768px - 1024px) - Responsive grid, stacked cards */
    @media (max-width: 1024px) {
      .container {
        max-width: 100%;
        padding: 0 1.5rem;
      }

      .main-content {
        grid-template-columns: 1fr;  /* Stack cards */
      }

      .two-col-grid {
        grid-template-columns: 1fr;  /* Stack two-column layouts */
      }

      .performance-card {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      }

      .header {
        flex-wrap: wrap;
        gap: 1rem;
      }

      .nav-pills {
        justify-content: center;
      }
    }

    /* Mobile (< 768px) - Single column, touch-friendly */
    @media (max-width: 768px) {
      body {
        padding: 1rem;
      }

      .container {
        padding: 0 1rem;  /* Smaller padding */
        gap: 1.5rem;
      }

      .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
      }

      .header h1 {
        font-size: 1.5rem;
      }

      .header-buttons {
        flex-wrap: wrap;  /* Stack buttons if needed */
        width: 100%;
        justify-content: space-between;
      }

      .screen-share-btn,
      .live-indicator,
      .update-docs-btn {
        padding: 0.75rem 1rem;  /* Touch-friendly sizing */
        font-size: 0.875rem;
      }

      .performance-card {
        grid-template-columns: repeat(2, 1fr);  /* 2 columns on mobile */
        gap: 0.75rem;
        padding: 1rem;
      }

      .metric-value {
        font-size: 1.5rem;
      }

      .nav-container {
        overflow-x: auto;  /* Horizontal scroll for tabs */
        -webkit-overflow-scrolling: touch;
      }

      .nav-pills {
        flex-wrap: nowrap;
        padding-bottom: 0.5rem;
        min-width: min-content;
      }

      .nav-pill {
        white-space: nowrap;
        flex-shrink: 0;
      }

      .two-col-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .card {
        padding: 1rem;
      }

      .card:first-child,
      .card:last-child {
        border-radius: 1rem;
        border: 1px solid rgba(168, 85, 247, 0.2);
      }

      .doc-item {
        padding: 1rem;  /* Touch-friendly sizing */
        gap: 0.75rem;
      }

      .docs-list-scrollable {
        max-height: 300px;
      }

      /* Mobile-friendly icon hover states */
      .doc-item .eye-icon,
      .doc-item .magnify-icon {
        position: static;
        opacity: 1;
        margin-left: auto;
      }

      .doc-item:hover .eye-icon {
        right: auto;
      }

      .doc-item:hover .magnify-icon {
        right: auto;
      }

      /* Modal adjustments for mobile */
      .team-popup-container,
      .doc-viewer-modal-content {
        width: 95%;
        max-width: 95%;
        margin: 1rem;
        max-height: 90vh;
      }

      /* Timeline adjustments */
      .timeline-line {
        left: 20px;
      }

      .milestone-marker {
        left: 12px;
      }

      .milestone-label,
      .milestone-date {
        font-size: 0.7rem;
      }
    }

    /* Small Mobile (< 480px) - Extra compact */
    @media (max-width: 480px) {
      .performance-card {
        grid-template-columns: 1fr;  /* Single column on very small screens */
      }

      .header-buttons {
        flex-direction: column;
        width: 100%;
      }

      .screen-share-btn,
      .live-indicator,
      .update-docs-btn {
        width: 100%;
        justify-content: center;
      }

      .metric-value {
        font-size: 1.25rem;
      }

      .metric-label {
        font-size: 0.75rem;
      }
    }

    /* Email Button */
    .email-btn {
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      background: rgba(30, 41, 59, 0.5);
      backdrop-filter: blur(12px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(139, 92, 246, 0.3);
      color: #c4b5fd;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      height: fit-content;
    }

    .email-btn:hover {
      background: rgba(30, 41, 59, 0.7);
      border-color: rgba(139, 92, 246, 0.5);
      color: #e9d5ff;
      transform: translateY(-2px);
      box-shadow: 0 12px 20px -5px rgba(139, 92, 246, 0.4);
    }

    .email-btn svg {
      width: 16px;
      height: 16px;
    }

    .email-btn .badge {
      background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
      color: white;
      padding: 0.125rem 0.375rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: bold;
      min-width: 20px;
      text-align: center;
    }

    /* Email Modal Overlay */

    /* Floating Email Window - Resizable & Draggable */
    .email-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: transparent;  /* No backdrop - window floats over content */
      display: none;
      z-index: 10000;
      pointer-events: none;  /* Allow clicks through to content below */
    }

    .email-modal-overlay.active {
      display: block;
    }

    /* Email Container - Floating Window */
    .email-container {
      position: absolute;
      top: 10%;
      left: 15%;
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.98) 0%, rgba(30, 41, 59, 0.98) 100%);
      border: 2px solid rgba(168, 85, 247, 0.4);
      border-radius: 1rem;
      width: 1200px;
      height: 700px;
      display: grid;
      grid-template-rows: auto 1fr;
      overflow: hidden;
      box-shadow: 0 25px 50px -12px rgba(139, 92, 246, 0.6), 
                  0 0 0 1px rgba(168, 85, 247, 0.2);
      pointer-events: auto;  /* Window itself captures clicks */
      resize: both;  /* Allow resizing */
      min-width: 800px;
      min-height: 500px;
      max-width: 95vw;
      max-height: 95vh;
      transition: box-shadow 0.3s ease;
    }

    .email-container:hover {
      box-shadow: 0 30px 60px -15px rgba(139, 92, 246, 0.7), 
                  0 0 0 2px rgba(168, 85, 247, 0.4);
    }

    .email-container.minimized {
      height: 60px !important;
      width: 300px !important;
      min-height: 60px !important;
      max-height: 60px !important;
      grid-template-rows: auto 0fr !important;
      resize: none !important;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden !important;
    }

    .email-container.minimized .email-body {
      display: none !important;
      height: 0 !important;
      overflow: hidden !important;
    }

    /* Email Header - Draggable */
    .email-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid rgba(168, 85, 247, 0.2);
      background: rgba(15, 23, 42, 0.8);
      cursor: move;  /* Indicates draggable */
      user-select: none;
    }

    .email-header:active {
      cursor: grabbing;
    }

    .email-container.minimized .email-header {
      cursor: move;
    }

    .email-container.minimized .email-header:active {
      cursor: grabbing;
    }


    /* Email Header Left Section */
    .email-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid rgba(168, 85, 247, 0.2);
      background: rgba(15, 23, 42, 0.8);
      cursor: move;
      user-select: none;
    }

    .email-header:active {
      cursor: grabbing;
    }

    .email-header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .email-icon-only {
      width: 24px;
      height: 24px;
      color: #a78bfa;
      flex-shrink: 0;
    }

    /* New Email Button - Same height as other buttons */
    .email-header-btn.new-email-btn {
      padding: 0.45rem 0.9rem;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      white-space: nowrap;
      font-size: 0.8125rem;

    /* Email Search Field */
    .email-search-container {
      flex: 1;
      max-width: 400px;
      position: relative;
      margin: 0 1rem;
    }

    .email-search-input {
      width: 100%;
      height: 36px;
      padding: 0.5rem 1rem 0.5rem 2.5rem;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(168, 85, 247, 0.3);
      border-radius: 0.5rem;
      color: white;
      font-size: 0.875rem;
      transition: all 0.3s;
      outline: none;
    }

    .email-search-input::placeholder {
      color: #64748b;
    }

    .email-search-input:focus {
      background: rgba(15, 23, 42, 0.8);
      border-color: rgba(168, 85, 247, 0.5);
      box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
    }

    .email-search-icon {
      position: absolute;
      left: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      width: 16px;
      height: 16px;
      color: #94a3b8;
      pointer-events: none;
    }

    .email-search-input:focus ~ .email-search-icon {
      color: #a78bfa;
    }

    .email-search-clear {
      position: absolute;
      right: 0.5rem;
      top: 50%;
      transform: translateY(-50%);
      width: 24px;
      height: 24px;
      background: rgba(168, 85, 247, 0.2);
      border: none;
      border-radius: 0.25rem;
      color: #94a3b8;
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .email-search-clear:hover {
      background: rgba(168, 85, 247, 0.3);
      color: white;
    }

    .email-search-input:not(:placeholder-shown) ~ .email-search-clear {
      display: flex;
    }
    }

    .email-header-actions {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    /* Compact Bento-style Search Field */
    .email-search-compact {
      position: relative;
      display: flex;
      align-items: center;
    }

    .email-search-compact input {
      width: 200px;
      height: 36px;
      padding: 0.5rem 0.75rem 0.5rem 2.25rem;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(168, 85, 247, 0.25);
      border-radius: 0.5rem;
      color: white;
      font-size: 0.8125rem;
      transition: all 0.3s ease;
      outline: none;
    }

    .email-search-compact input::placeholder {
      color: #64748b;
    }

    .email-search-compact input:focus {
      width: 280px;
      background: rgba(15, 23, 42, 0.8);
      border-color: rgba(168, 85, 247, 0.4);
      box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
    }

    .email-search-compact .search-icon {
      position: absolute;
      left: 0.625rem;
      top: 50%;
      transform: translateY(-50%);
      width: 14px;
      height: 14px;
      color: #94a3b8;
      pointer-events: none;
      transition: color 0.3s ease;
    }

    .email-search-compact input:focus ~ .search-icon {
      color: #a78bfa;
    }

    /* Compact Bento-style Search Field */
    .email-search-compact {
      position: relative;
      display: flex;
      align-items: center;
    }

    .email-search-compact input {
      width: 200px;
      height: 36px;
      padding: 0.5rem 0.75rem 0.5rem 2.25rem;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(168, 85, 247, 0.25);
      border-radius: 0.5rem;
      color: white;
      font-size: 0.8125rem;
      transition: all 0.3s ease;
      outline: none;
    }

    .email-search-compact input::placeholder {
      color: #64748b;
    }

    .email-search-compact input:focus {
      width: 280px;
      background: rgba(15, 23, 42, 0.8);
      border-color: rgba(168, 85, 247, 0.4);
      box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
    }

    .email-search-compact .search-icon {
      position: absolute;
      left: 0.625rem;
      top: 50%;
      transform: translateY(-50%);
      width: 14px;
      height: 14px;
      color: #94a3b8;
      pointer-events: none;
      transition: color 0.3s ease;
    }

    .email-search-compact input:focus ~ .search-icon {
      color: #a78bfa;
    }

    .email-header-btn {
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      border: 1px solid rgba(168, 85, 247, 0.3);
      background: rgba(139, 92, 246, 0.1);
      color: #c4b5fd;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      height: 36px;
    }

    .email-header-btn:hover {
      background: rgba(139, 92, 246, 0.2);
      border-color: rgba(168, 85, 247, 0.5);
      transform: translateY(-2px);
    }

    .email-header-btn.primary {
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      border-color: transparent;
      color: white;
    }

    .email-header-btn.primary:hover {
      box-shadow: 0 8px 16px rgba(139, 92, 246, 0.4);
    }

    /* Window Control Buttons */
    .email-window-controls {
      display: flex;
      gap: 0.5rem;
      margin-left: 0.5rem;
    }

    .email-control-btn {
      width: 32px;
      height: 32px;
      border-radius: 0.375rem;
      border: 1px solid rgba(168, 85, 247, 0.3);
      background: rgba(30, 41, 59, 0.5);
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #94a3b8;
    }

    .email-control-btn:hover {
      background: rgba(30, 41, 59, 0.8);
      color: white;
      transform: translateY(-2px);
    }

    .email-control-btn.minimize {
      border-color: rgba(59, 130, 246, 0.3);
      color: #60a5fa;
    }

    .email-control-btn.minimize:hover {
      background: rgba(59, 130, 246, 0.2);
      border-color: rgba(59, 130, 246, 0.5);
      color: #93c5fd;
    }

    .email-control-btn.maximize {
      border-color: rgba(16, 185, 129, 0.3);
      color: #6ee7b7;
    }

    .email-control-btn.maximize:hover {
      background: rgba(16, 185, 129, 0.2);
      border-color: rgba(16, 185, 129, 0.5);
      color: #a7f3d0;
    }

    .email-control-btn.close {
      border-color: rgba(239, 68, 68, 0.3);
      color: #fca5a5;
    }

    .email-control-btn.close:hover {
      background: rgba(239, 68, 68, 0.2);
      border-color: rgba(239, 68, 68, 0.5);
      color: #fecaca;
      transform: rotate(90deg) translateY(-2px);
    }

    .email-control-btn svg {
      width: 16px;
      height: 16px;
    }

    /* Resize Handle Visual Indicator */
    .email-container::after {
      content: '';
      position: absolute;
      bottom: 0;
      right: 0;
      width: 20px;
      height: 20px;
      background: linear-gradient(135deg, transparent 50%, rgba(168, 85, 247, 0.3) 50%);
      border-radius: 0 0 0.75rem 0;
      pointer-events: none;
    }

    .email-container.minimized::after {
      display: none;
    }

    /* Dragging State */
    .email-container.dragging {
      opacity: 0.9;
      box-shadow: 0 35px 70px -20px rgba(139, 92, 246, 0.8);
    }

    .email-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem;
      border-bottom: 1px solid rgba(168, 85, 247, 0.2);
      background: rgba(15, 23, 42, 0.5);
    }

    .email-title {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: white;
      font-size: 1.5rem;
      font-weight: bold;
    }

    .email-title svg {
      width: 28px;
      height: 28px;
      color: #a78bfa;
    }

    .email-header-actions {
      display: flex;
      gap: 0.75rem;
      align-items: center;
    }

    .email-header-btn {
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      border: 1px solid rgba(168, 85, 247, 0.3);
      background: rgba(139, 92, 246, 0.1);
      color: #c4b5fd;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
    }

    .email-header-btn:hover {
      background: rgba(139, 92, 246, 0.2);
      border-color: rgba(168, 85, 247, 0.5);
      transform: translateY(-2px);
    }

    .email-header-btn.primary {
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      border-color: transparent;
      color: white;
    }

    .email-header-btn.primary:hover {
      box-shadow: 0 8px 16px rgba(139, 92, 246, 0.4);
    }

    .email-close-btn {
      width: 36px;
      height: 36px;
      border-radius: 0.5rem;
      border: 1px solid rgba(239, 68, 68, 0.3);
      background: rgba(239, 68, 68, 0.1);
      color: #fca5a5;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .email-close-btn:hover {
      background: rgba(239, 68, 68, 0.2);
      border-color: rgba(239, 68, 68, 0.5);
      transform: rotate(90deg);
    }

    /* Email Body - 3 Panes */
    .email-body {
      display: flex;
      height: 100%;
      overflow: hidden;
      position: relative;
    }

    /* Left Sidebar - Folders */
    .email-sidebar {
      background: rgba(15, 23, 42, 0.6);
      border-right: 1px solid rgba(168, 85, 247, 0.2);
      padding: 1rem;
      overflow-y: auto;
      width: 200px;
      min-width: 150px;
      max-width: 400px;
      flex-shrink: 0;
      position: relative;
    }

    /* Resize Handle for Sidebar */
    .sidebar-resize-handle {
      position: absolute;
      top: 0;
      right: 0;
      width: 8px;
      height: 100%;
      cursor: col-resize;
      background: transparent;
      z-index: 10;
      transition: background 0.2s ease;
    }

    .sidebar-resize-handle:hover {
      background: rgba(168, 85, 247, 0.3);
    }

    .sidebar-resize-handle:active {
      background: rgba(168, 85, 247, 0.5);
    }

    /* Visual indicator for resize */
    .sidebar-resize-handle::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 3px;
      height: 40px;
      background: rgba(168, 85, 247, 0.4);
      border-radius: 2px;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .sidebar-resize-handle:hover::before {
      opacity: 1;
    }

    /* Resize tooltip */
    .sidebar-resize-handle::after {
      content: 'Drag to resize';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(139, 92, 246, 0.95);
      color: white;
      padding: 0.5rem 0.75rem;
      border-radius: 0.375rem;
      font-size: 0.75rem;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      z-index: 100;
    }

    .sidebar-resize-handle:hover::after {
      opacity: 1;
      transition-delay: 0.5s;
    }

    .sidebar-resize-handle:active::after {
      opacity: 0;
    }

    .email-sidebar-title {
      color: #94a3b8;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.75rem;
    }

    .email-folder {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.3s;
      color: #cbd5e1;
      margin-bottom: 0.5rem;
    }

    .email-folder:hover {
      background: rgba(139, 92, 246, 0.1);
      color: white;
    }

    .email-folder.active {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(236, 72, 153, 0.2) 100%);
      border: 1px solid rgba(168, 85, 247, 0.3);
      color: white;
    }

    .email-folder svg {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
    }

    .email-folder-name {
      flex: 1;
      font-size: 0.875rem;
    }

    .email-folder-count {
      background: rgba(139, 92, 246, 0.3);
      padding: 0.125rem 0.5rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
      color: #c4b5fd;
    }

    /* Folder Management Styles */
    .new-folder-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.625rem 0.75rem;
      margin-bottom: 0.75rem;
      border-radius: 0.5rem;
      background: rgba(139, 92, 246, 0.1);
      border: 1px solid rgba(168, 85, 247, 0.3);
      color: #c4b5fd;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.8125rem;
      font-weight: 500;
      width: 100%;
    }

    .new-folder-btn:hover {
      background: rgba(139, 92, 246, 0.2);
      border-color: rgba(168, 85, 247, 0.5);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(139, 92, 246, 0.3);
    }

    .new-folder-btn svg {
      width: 16px;
      height: 16px;
    }

    /* Folder Actions (Rename/Delete) */
    .folder-actions {
      display: none;
      gap: 0.25rem;
      margin-left: auto;
    }

    .email-folder:hover .folder-actions {
      display: flex;
    }

    .email-folder.system-folder .folder-actions {
      display: none !important;
    }

    .folder-action-btn {
      width: 24px;
      height: 24px;
      border-radius: 0.25rem;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(168, 85, 247, 0.2);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .folder-action-btn:hover {
      background: rgba(139, 92, 246, 0.3);
      border-color: rgba(168, 85, 247, 0.5);
    }

    .folder-action-btn svg {
      width: 14px;
      height: 14px;
      color: #94a3b8;
    }

    .folder-action-btn.delete:hover {
      background: rgba(239, 68, 68, 0.2);
      border-color: rgba(239, 68, 68, 0.5);
    }

    .folder-action-btn.delete:hover svg {
      color: #fca5a5;
    }

    /* Subfolder Styles */
    .email-folder.subfolder {
      padding-left: 2.5rem;
      position: relative;
    }

    .email-folder.subfolder::before {
      content: '';
      position: absolute;
      left: 1.25rem;
      top: 0;
      bottom: 0;
      width: 1px;
      background: rgba(168, 85, 247, 0.2);
    }

    .email-folder.subfolder::after {
      content: '';
      position: absolute;
      left: 1.25rem;
      top: 50%;
      width: 0.75rem;
      height: 1px;
      background: rgba(168, 85, 247, 0.2);
    }

    /* Folder Toggle (Collapse/Expand) */
    .folder-toggle {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .folder-toggle svg {
      width: 14px;
      height: 14px;
    }

    .email-folder.collapsed .folder-toggle {
      transform: rotate(-90deg);
    }

    .email-folder.collapsed ~ .email-folder.subfolder {
      display: none;
    }

    /* Custom Folder Indicator */
    .email-folder.custom-folder {
      border-left: 2px solid transparent;
    }

    .email-folder.custom-folder:hover {
      border-left-color: rgba(168, 85, 247, 0.5);
    }

    /* Folder Input (for creating/renaming) */
    .folder-input-wrapper {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
      border-radius: 0.5rem;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(168, 85, 247, 0.4);
    }

    .folder-input {
      flex: 1;
      background: transparent;
      border: none;
      outline: none;
      color: white;
      font-size: 0.875rem;
      padding: 0.25rem;
    }

    .folder-input::placeholder {
      color: #64748b;
    }

    .folder-input-btn {
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      border: 1px solid rgba(168, 85, 247, 0.3);
      background: rgba(139, 92, 246, 0.1);
      color: #c4b5fd;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .folder-input-btn:hover {
      background: rgba(139, 92, 246, 0.2);
      border-color: rgba(168, 85, 247, 0.5);
    }

    .folder-input-btn.cancel {
      background: rgba(100, 116, 139, 0.1);
      border-color: rgba(100, 116, 139, 0.3);
      color: #cbd5e1;
    }

    .folder-input-btn.cancel:hover {
      background: rgba(100, 116, 139, 0.2);
    }

    /* Folder Divider */
    .folder-divider {
      height: 1px;
      background: rgba(168, 85, 247, 0.2);
      margin: 0.75rem 0;
    }

    .folder-section-title {
      color: #64748b;
      font-size: 0.6875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 0.5rem 0.75rem;
      margin-bottom: 0.25rem;
    }

    /* Middle Pane - Email List */
    .email-list {
      background: rgba(15, 23, 42, 0.4);
      border-right: 1px solid rgba(168, 85, 247, 0.2);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      flex: 1;
      min-width: 300px;
      max-width: 500px;
    }

    .email-list-header {
      padding: 1rem;
      border-bottom: 1px solid rgba(168, 85, 247, 0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .email-list-header h3 {
      color: white;
      font-size: 1rem;
      font-weight: 600;
    }

    .email-list-actions {
      display: flex;
      gap: 0.5rem;
    }

    .email-list-btn {
      padding: 0.375rem;
      border-radius: 0.375rem;
      border: 1px solid rgba(168, 85, 247, 0.2);
      background: rgba(30, 41, 59, 0.5);
      color: #94a3b8;
      cursor: pointer;
      transition: all 0.3s;
    }

    .email-list-btn:hover {
      background: rgba(139, 92, 246, 0.2);
      color: white;
      border-color: rgba(168, 85, 247, 0.4);
    }

    .email-list-btn svg {
      width: 16px;
      height: 16px;
    }

    .email-list-items {
      flex: 1;
      overflow-y: auto;
      padding: 0.5rem;
    }

    /* Email Item */
    .email-item {
      padding: 1rem;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.3s;
      border: 1px solid transparent;
      margin-bottom: 0.5rem;
      background: rgba(30, 41, 59, 0.3);
    }

    .email-item:hover {
      background: rgba(30, 41, 59, 0.6);
      border-color: rgba(168, 85, 247, 0.2);
      transform: translateX(4px);
    }

    .email-item.active {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(236, 72, 153, 0.1) 100%);
      border-color: rgba(168, 85, 247, 0.4);
    }

    .email-item.unread {
      background: rgba(59, 130, 246, 0.1);
      border-color: rgba(59, 130, 246, 0.3);
    }

    
    /* Star Button */
    .email-star {
      width: 20px;
      height: 20px;
      cursor: pointer;
      transition: all 0.2s ease;
      flex-shrink: 0;
      margin-left: 0.5rem;
    }

    .email-star svg {
      width: 20px;
      height: 20px;
      stroke: #64748b;
      fill: none;
      transition: all 0.2s ease;
    }

    .email-star:hover svg {
      stroke: #fbbf24;
      transform: scale(1.15);
    }

    .email-star.starred svg {
      stroke: #fbbf24;
      fill: #fbbf24;
    }

    .email-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .email-item-header-left {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex: 1;
    }

    .email-item-header-right {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .email-item-sender {
      color: white;
      font-weight: 600;
      font-size: 0.875rem;
    }

    .email-item.unread .email-item-sender {
      color: #93c5fd;
    }

    .email-item-time {
      color: #64748b;
      font-size: 0.75rem;
    }

    .email-item-subject {
      color: #cbd5e1;
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 0.25rem;
      display: -webkit-box;
      -webkit-line-clamp: 1;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .email-item-preview {
      color: #94a3b8;
      font-size: 0.75rem;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    /* Right Pane - Email Content */
    .email-content {
      background: rgba(15, 23, 42, 0.3);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      flex: 1;
    }

    .email-content-header {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(168, 85, 247, 0.2);
      background: rgba(15, 23, 42, 0.5);
    }

    .email-content-subject {
      color: white;
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 0.75rem;
    }

    .email-content-meta {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .email-content-from {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .email-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 0.875rem;
    }

    .email-sender-info {
      display: flex;
      flex-direction: column;
    }

    .email-sender-name {
      color: white;
      font-weight: 600;
      font-size: 0.875rem;
    }

    .email-sender-email {
      color: #94a3b8;
      font-size: 0.75rem;
    }

    .email-content-date {
      color: #64748b;
      font-size: 0.875rem;
      margin-left: auto;
    }

    /* Spam and Block buttons in email header */
    .email-header-actions-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.75rem;
    }

    .email-moderation-btns {
      display: flex;
      gap: 0.5rem;
    }

    .email-mod-btn {
      padding: 0.375rem 0.75rem;
      border-radius: 0.375rem;
      font-size: 0.75rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.375rem;
      border: 1px solid transparent;
    }

    .email-mod-btn svg {
      width: 14px;
      height: 14px;
    }

    .email-mod-btn.spam {
      background: rgba(239, 68, 68, 0.1);
      border-color: rgba(239, 68, 68, 0.3);
      color: #fca5a5;
    }

    .email-mod-btn.spam:hover {
      background: rgba(239, 68, 68, 0.2);
      border-color: rgba(239, 68, 68, 0.5);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(239, 68, 68, 0.3);
    }

    .email-mod-btn.block {
      background: rgba(100, 116, 139, 0.1);
      border-color: rgba(100, 116, 139, 0.3);
      color: #cbd5e1;
    }

    .email-mod-btn.block:hover {
      background: rgba(100, 116, 139, 0.2);
      border-color: rgba(100, 116, 139, 0.5);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(100, 116, 139, 0.3);
    }

    .email-content-body {
      flex: 1;
      overflow-y: auto;
      padding: 1.5rem;
    }

    .email-content-text {
      color: #cbd5e1;
      line-height: 1.6;
      font-size: 0.875rem;
    }

    .email-content-text p {
      margin-bottom: 0.75rem;
    }

    .email-content-actions {
      padding: 1rem 1.5rem;
      border-top: 1px solid rgba(168, 85, 247, 0.2);
      display: flex;
      gap: 0.75rem;
    }

    .email-action-btn {
      flex: 1;
      padding: 0.75rem;
      border-radius: 0.5rem;
      border: 1px solid rgba(168, 85, 247, 0.3);
      background: rgba(30, 41, 59, 0.5);
      color: #c4b5fd;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-weight: 500;
    }

    .email-action-btn:hover {
      background: rgba(139, 92, 246, 0.2);
      border-color: rgba(168, 85, 247, 0.5);
      transform: translateY(-2px);
    }

    .email-action-btn svg {
      width: 16px;
      height: 16px;
    }

    /* Empty State */
    .email-empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #64748b;
    }

    .email-empty svg {
      width: 64px;
      height: 64px;
      margin-bottom: 0.75rem;
      opacity: 0.5;
    }

    .email-empty-text {
      font-size: 1rem;
      font-weight: 500;
    }

    /* Scrollbar Styling */
    .email-sidebar::-webkit-scrollbar,
    .email-list-items::-webkit-scrollbar,
    .email-content-body::-webkit-scrollbar {
      width: 8px;
    }

    .email-sidebar::-webkit-scrollbar-track,
    .email-list-items::-webkit-scrollbar-track,
    .email-content-body::-webkit-scrollbar-track {
      background: rgba(148, 163, 184, 0.1);
      border-radius: 10px;
    }

    .email-sidebar::-webkit-scrollbar-thumb,
    .email-list-items::-webkit-scrollbar-thumb,
    .email-content-body::-webkit-scrollbar-thumb {
      background: linear-gradient(to bottom, #8b5cf6, #ec4899);
      border-radius: 10px;
    }

    .email-sidebar::-webkit-scrollbar-thumb:hover,
    .email-list-items::-webkit-scrollbar-thumb:hover,
    .email-content-body::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(to bottom, #a78bfa, #f472b6);
    }

/* ==========================================
       EMAIL COMPOSER MODAL - BENTO STYLE
       Production Ready with Microsoft Graph API
       ========================================== */
    
    /* Composer Modal Overlay */
    .email-composer-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(12px);
      z-index: 10000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .email-composer-overlay.active {
      display: flex;
      opacity: 1;
    }

    /* Composer Container */
    .email-composer {
      background: rgba(30, 41, 59, 0.95);
      border: 1px solid rgba(168, 85, 247, 0.3);
      border-radius: 1rem;
      width: 90%;
      max-width: 800px;
      max-height: 85vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      transform: scale(0.95);
      transition: transform 0.3s ease;
      overflow: hidden;
    }

    .email-composer-overlay.active .email-composer {
      transform: scale(1);
    }

    /* Composer Header */
    .email-composer-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.25rem;
      border-bottom: 1px solid rgba(168, 85, 247, 0.2);
    }

    .email-composer-title {
      font-size: 1rem;
      font-weight: 600;
      color: white;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .email-composer-title svg {
      width: 18px;
      height: 18px;
    }

    .email-composer-close {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #ef4444;
      border-radius: 0.5rem;
      padding: 0.5rem 0.75rem;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.875rem;
      font-weight: 500;
    }

    .email-composer-close:hover {
      background: rgba(239, 68, 68, 0.2);
      transform: translateY(-2px);
    }

    /* Composer Body */
    .email-composer-body {
      padding: 1rem 1.25rem;
      overflow-y: auto;
      flex: 1;
    }

    /* Form Fields */
    .composer-field {
      margin-bottom: 0.75rem;
    }

    .composer-field-label {
      display: block;
      color: #94a3b8;
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .composer-input {
      width: 100%;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(168, 85, 247, 0.2);
      border-radius: 0.5rem;
      padding: 0.75rem 1rem;
      color: white;
      font-size: 0.875rem;
      transition: all 0.2s ease;
    }

    .composer-input:focus {
      outline: none;
      border-color: rgba(168, 85, 247, 0.5);
      background: rgba(15, 23, 42, 0.8);
    }

    .composer-input::placeholder {
      color: #64748b;
    }

    /* CC/BCC Toggle */
    .cc-bcc-toggle {
      display: flex;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .cc-bcc-btn {
      background: rgba(139, 92, 246, 0.1);
      border: 1px solid rgba(168, 85, 247, 0.3);
      color: #a78bfa;
      padding: 0.5rem 0.75rem;
      border-radius: 0.375rem;
      font-size: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .cc-bcc-btn:hover {
      background: rgba(139, 92, 246, 0.2);
      transform: translateY(-2px);
    }

    .cc-bcc-btn.active {
      background: rgba(139, 92, 246, 0.3);
      border-color: rgba(168, 85, 247, 0.5);
    }

    /* Toolbar */
    .composer-toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      padding: 0.75rem;
      background: rgba(15, 23, 42, 0.4);
      border-radius: 0.5rem;
      margin-bottom: 0.75rem;
      border: 1px solid rgba(168, 85, 247, 0.1);
    }

    .toolbar-group {
      display: flex;
      gap: 0.25rem;
      padding: 0.25rem;
      border-right: 1px solid rgba(168, 85, 247, 0.2);
    }

    .toolbar-group:last-child {
      border-right: none;
    }

    .toolbar-btn {
      background: rgba(139, 92, 246, 0.1);
      border: 1px solid rgba(168, 85, 247, 0.2);
      color: #cbd5e1;
      padding: 0.5rem;
      border-radius: 0.375rem;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 36px;
      height: 36px;
    }

    .toolbar-btn:hover {
      background: rgba(139, 92, 246, 0.2);
      color: white;
      transform: translateY(-1px);
    }

    .toolbar-btn.active {
      background: rgba(139, 92, 246, 0.3);
      color: #a78bfa;
      border-color: rgba(168, 85, 247, 0.4);
    }

    .toolbar-btn svg {
      width: 18px;
      height: 18px;
    }

    /* Dropdowns */
    .toolbar-select {
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(168, 85, 247, 0.2);
      color: white;
      padding: 0.5rem 0.75rem;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 120px;
    }

    .toolbar-select:hover {
      border-color: rgba(168, 85, 247, 0.4);
    }

    .toolbar-select:focus {
      outline: none;
      border-color: rgba(168, 85, 247, 0.5);
    }

    /* Color Picker Button */
    .color-picker-wrapper {
      position: relative;
    }

    .color-picker-input {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0;
    }

    .color-picker-btn {
      position: relative;
      overflow: hidden;
    }

    .color-picker-btn::after {
      content: '';
      position: absolute;
      bottom: 2px;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 3px;
      background: currentColor;
      border-radius: 2px;
    }

    /* Editor Area */
    .composer-editor {
      min-height: 200px;
      max-height: 300px;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(168, 85, 247, 0.2);
      border-radius: 0.5rem;
      padding: 0.875rem;
      color: white;
      font-size: 0.875rem;
      line-height: 1.5;
      overflow-y: auto;
      cursor: text;
      transition: all 0.2s ease;
    }

    .composer-editor:focus {
      outline: none;
      border-color: rgba(168, 85, 247, 0.5);
      background: rgba(15, 23, 42, 0.8);
    }

    .composer-editor:empty::before {
      content: 'Type your message...';
      color: #64748b;
    }

    /* Attachments */
    .composer-attachments {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-top: 1rem;
    }

    .attachment-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(139, 92, 246, 0.1);
      border: 1px solid rgba(168, 85, 247, 0.2);
      padding: 0.5rem 0.75rem;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      color: #cbd5e1;
    }

    .attachment-item svg {
      width: 16px;
      height: 16px;
      color: #a78bfa;
    }

    .attachment-remove {
      background: rgba(239, 68, 68, 0.2);
      border: none;
      color: #ef4444;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-left: 0.25rem;
    }

    .attachment-remove:hover {
      background: rgba(239, 68, 68, 0.3);
      transform: scale(1.1);
    }

    /* Composer Footer */
    .email-composer-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.25rem;
      border-top: 1px solid rgba(168, 85, 247, 0.2);
      background: rgba(15, 23, 42, 0.4);
    }

    .composer-actions {
      display: flex;
      gap: 0.75rem;
      width: 100%;
    }

    .composer-btn-fullwidth {
      flex: 1;
      justify-content: center;
    }

    .composer-btn {
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .composer-btn-primary {
      background: linear-gradient(135deg, #8b5cf6, #ec4899);
      border-color: transparent;
      color: white;
    }

    .composer-btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(139, 92, 246, 0.3);
    }

    .composer-btn-secondary {
      background: rgba(139, 92, 246, 0.1);
      border-color: rgba(168, 85, 247, 0.3);
      color: #cbd5e1;
    }

    .composer-btn-secondary:hover {
      background: rgba(139, 92, 246, 0.2);
      transform: translateY(-2px);
    }

    .composer-btn svg {
      width: 18px;
      height: 18px;
    }

    /* Voice Recording Indicator */
    .voice-recording {
      display: none;
      align-items: center;
      gap: 0.5rem;
      color: #ef4444;
      font-size: 0.875rem;
      font-weight: 600;
    }

    .voice-recording.active {
      display: flex;
    }

    .voice-pulse {
      width: 8px;
      height: 8px;
      background: #ef4444;
      border-radius: 50%;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.2); }
    }

    /* Emoji Picker (Simple) */
    .emoji-picker {
      position: absolute;
      bottom: 50px;
      right: 0;
      background: rgba(30, 41, 59, 0.98);
      border: 1px solid rgba(168, 85, 247, 0.3);
      border-radius: 0.5rem;
      padding: 1rem;
      display: none;
      flex-wrap: wrap;
      gap: 0.5rem;
      max-width: 300px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      z-index: 100;
    }

    .emoji-picker.active {
      display: flex;
    }

    .emoji-item {
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.25rem;
      border-radius: 0.25rem;
      transition: all 0.2s ease;
    }

    .emoji-item:hover {
      background: rgba(139, 92, 246, 0.2);
      transform: scale(1.2);
    }

    /* ==========================================
       MODERN FUN AI BUTTONS
       Emoji + Voice + AI Review
       ========================================== */

    /* Fun Emoji Button - Yellow Smiley */
    .toolbar-btn-emoji-fun {
      background: rgba(30, 41, 59, 0.9);
      border: 1px solid rgba(255, 217, 61, 0.3);
      min-width: 40px;
      height: 40px;
      transition: all 0.3s ease;
    }

    .toolbar-btn-emoji-fun:hover {
      background: rgba(30, 41, 59, 1);
      border-color: rgba(255, 217, 61, 0.6);
      transform: translateY(-2px) rotate(5deg);
      box-shadow: 0 5px 15px rgba(255, 217, 61, 0.3);
    }

    .toolbar-btn-emoji-fun svg {
      width: 24px;
      height: 24px;
    }

    /* Modern Voice Button - Dark Maroon/Burgundy */
    .toolbar-btn-voice-modern {
      background: linear-gradient(135deg, #4a1a2c, #2d0a1a);
      border: 1px solid rgba(239, 68, 68, 0.3);
      min-width: auto;
      padding: 0.5rem 0.875rem;
      gap: 0.5rem;
      color: #fca5a5;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .toolbar-btn-voice-modern:hover {
      background: linear-gradient(135deg, #5a1a3c, #3d0a2a);
      border-color: rgba(239, 68, 68, 0.5);
      color: #fecaca;
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(239, 68, 68, 0.4);
    }

    .toolbar-btn-voice-modern svg {
      width: 18px;
      height: 18px;
      color: #fca5a5;
    }

    .toolbar-btn-voice-modern.recording {
      background: linear-gradient(135deg, #dc2626, #991b1b);
      border-color: rgba(239, 68, 68, 0.8);
      color: white;
      animation: voice-pulse 1.5s ease-in-out infinite;
    }

    .toolbar-btn-voice-modern.recording svg {
      color: white;
    }

    @keyframes voice-pulse {
      0%, 100% {
        box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
      }
      50% {
        box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
      }
    }

        .toolbar-btn-gpt-sparkle {
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      border: 1px solid rgba(139, 92, 246, 0.4);
      min-width: auto;
      padding: 0.5rem 0.875rem;
      gap: 0.5rem;
      color: white;
      font-weight: 600;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .toolbar-btn-gpt-sparkle::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transform: rotate(45deg);
      animation: sparkle-shine 3s ease-in-out infinite;
    }

    @keyframes sparkle-shine {
      0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
      100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
    }

        .toolbar-btn-gpt-sparkle:hover {
      background: linear-gradient(135deg, #4f46e5, #7c3aed);
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
    }

    .toolbar-btn-gpt-sparkle svg {
      width: 18px;
      height: 18px;
      position: relative;
      z-index: 1;
      filter: drop-shadow(0 0 3px rgba(255, 255, 255, 0.5));
    }

    .toolbar-btn-gpt-sparkle .toolbar-btn-label {
      position: relative;
      z-index: 1;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

        

    .toolbar-btn-label {
      font-size: 0.8125rem;
      font-weight: 600;
      white-space: nowrap;
      letter-spacing: 0.02em;
    }

    @media (max-width: 768px) {
      .toolbar-btn-label { display: none; }
      .toolbar-btn-voice-modern, .toolbar-btn-gpt-sparkle { min-width: 40px; padding: 0.5rem; }
      .toolbar-group-last { gap: 0.375rem; }
    }


    /* GPT Review Modal */
    .gpt-modal-overlay {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(12px);
      z-index: 10001; display: none; align-items: center;
      justify-content: center; padding: 2rem; opacity: 0;
      transition: opacity 0.3s ease;
    }
    .gpt-modal-overlay.active { display: flex; opacity: 1; }
    .gpt-modal {
      background: rgba(30, 41, 59, 0.95); border: 1px solid rgba(168, 85, 247, 0.3);
      border-radius: 1rem; width: 90%; max-width: 700px; max-height: 85vh;
      display: flex; flex-direction: column; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      transform: scale(0.95); transition: transform 0.3s ease; overflow: hidden;
    }
    .gpt-modal-overlay.active .gpt-modal { transform: scale(1); }
    .gpt-modal-header {
      display: flex; justify-content: space-between; align-items: center;
      padding: 1rem 1.25rem; border-bottom: 1px solid rgba(168, 85, 247, 0.2);
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(236, 72, 153, 0.1));
    }
    .gpt-modal-title { font-size: 1rem; font-weight: 600; color: white; display: flex; align-items: center; gap: 0.5rem; }
    .gpt-modal-title svg { width: 20px; height: 20px; color: #a78bfa; }
    .gpt-modal-body { padding: 1.25rem; overflow-y: auto; flex: 1; }
    .gpt-preview {
      background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(168, 85, 247, 0.2);
      border-radius: 0.5rem; padding: 1rem; color: white; font-size: 0.875rem;
      line-height: 1.6; min-height: 200px; max-height: 300px; overflow-y: auto; margin-bottom: 1rem;
    }
    .gpt-suggestions {
      background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(168, 85, 247, 0.2);
      border-radius: 0.5rem; padding: 1rem; margin-bottom: 1rem;
    }
    .gpt-suggestions-title {
      font-size: 0.875rem; font-weight: 600; color: #a78bfa; margin-bottom: 0.75rem;
      display: flex; align-items: center; gap: 0.5rem;
    }
    .gpt-suggestion-item {
      background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(168, 85, 247, 0.15);
      border-radius: 0.375rem; padding: 0.75rem; margin-bottom: 0.5rem;
      color: #cbd5e1; font-size: 0.8125rem; line-height: 1.5;
    }
    .gpt-suggestion-item:last-child { margin-bottom: 0; }
    .gpt-loading { display: flex; align-items: center; justify-content: center; gap: 0.75rem; padding: 2rem; color: #a78bfa; font-size: 0.875rem; }
    .gpt-loading-spinner {
      width: 24px; height: 24px; border: 3px solid rgba(168, 85, 247, 0.2);
      border-top-color: #a78bfa; border-radius: 50%; animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .gpt-modal-footer {
      display: flex; justify-content: space-between; gap: 0.75rem; padding: 1rem 1.25rem;
      border-top: 1px solid rgba(168, 85, 247, 0.2); background: rgba(15, 23, 42, 0.4);
    }
    .gpt-btn {
      flex: 1; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-size: 0.875rem;
      font-weight: 600; cursor: pointer; transition: all 0.2s ease; border: 1px solid;
      display: flex; align-items: center; justify-content: center; gap: 0.5rem;
    }
    .gpt-btn-secondary { background: rgba(71, 85, 105, 0.3); border-color: rgba(100, 116, 139, 0.4); color: #cbd5e1; }
    .gpt-btn-secondary:hover { background: rgba(71, 85, 105, 0.5); transform: translateY(-1px); }
    .gpt-btn-primary { background: linear-gradient(135deg, #8b5cf6, #ec4899); border-color: transparent; color: white; }
    .gpt-btn-primary:hover { background: linear-gradient(135deg, #7c3aed, #db2777); transform: translateY(-1px); box-shadow: 0 10px 20px -5px rgba(139, 92, 246, 0.4); }
    .gpt-btn svg { width: 18px; height: 18px; }


    /* ==========================================

EMAIL SIGNATURE MANAGER - BENTO STYLE
       ========================================== */

    /* Signature Modal Overlay */
    .signature-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(12px);
      z-index: 10002;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .signature-modal-overlay.active {
      display: flex;
      opacity: 1;
    }

    /* Main Signature Modal */
    .signature-modal {
      background: rgba(30, 41, 59, 0.98);
      border: 1px solid rgba(168, 85, 247, 0.3);
      border-radius: 1rem;
      width: 95%;
      max-width: 1200px;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
      overflow: hidden;
    }

    /* Modal Header */
    .signature-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid rgba(168, 85, 247, 0.2);
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(99, 102, 241, 0.1));
    }

    .signature-modal-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: white;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .signature-modal-title svg {
      width: 24px;
      height: 24px;
      color: #a78bfa;
    }

    /* Bento Grid Layout */
    .signature-bento {
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 1.5rem;
      padding: 1.5rem;
      overflow-y: auto;
      flex: 1;
    }

    /* Left Panel - Templates */
    .signature-templates-panel {
      background: rgba(15, 23, 42, 0.5);
      border: 1px solid rgba(168, 85, 247, 0.2);
      border-radius: 0.75rem;
      padding: 1rem;
      height: fit-content;
      max-height: calc(90vh - 200px);
      overflow-y: auto;
    }

    .signature-panel-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: #a78bfa;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 1rem;
    }

    .signature-new-btn {
      width: 100%;
      padding: 0.75rem;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      border: none;
      border-radius: 0.5rem;
      color: white;
      font-weight: 600;
      font-size: 0.875rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      transition: all 0.2s ease;
      margin-bottom: 1rem;
    }

    .signature-new-btn:hover {
      background: linear-gradient(135deg, #4f46e5, #7c3aed);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
    }

    .signature-new-btn svg {
      width: 18px;
      height: 18px;
    }

    /* Template Card */
    .signature-template-card {
      background: rgba(30, 41, 59, 0.6);
      border: 1px solid rgba(168, 85, 247, 0.15);
      border-radius: 0.5rem;
      padding: 0.875rem;
      margin-bottom: 0.75rem;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
    }

    .signature-template-card:hover {
      background: rgba(30, 41, 59, 0.8);
      border-color: rgba(168, 85, 247, 0.3);
      transform: translateX(4px);
    }

    .signature-template-card.active {
      background: rgba(99, 102, 241, 0.2);
      border-color: rgba(99, 102, 241, 0.5);
    }

    .signature-template-name {
      font-size: 0.875rem;
      font-weight: 600;
      color: white;
      margin-bottom: 0.25rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .signature-template-default {
      color: #fbbf24;
      font-size: 0.75rem;
    }

    .signature-template-info {
      font-size: 0.75rem;
      color: #94a3b8;
    }

    /* Right Panel - Editor */
    .signature-editor-panel {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    /* Preview Section */
    .signature-preview-section {
      background: white;
      border: 1px solid rgba(168, 85, 247, 0.2);
      border-radius: 0.75rem;
      padding: 1.5rem;
      min-height: 200px;
    }

    .signature-preview-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .signature-preview-content {
      border: 2px dashed #e2e8f0;
      border-radius: 0.5rem;
      padding: 1.5rem;
      min-height: 150px;
      background: #f8fafc;
    }

    /* Editor Form */
    .signature-editor-form {
      background: rgba(15, 23, 42, 0.5);
      border: 1px solid rgba(168, 85, 247, 0.2);
      border-radius: 0.75rem;
      padding: 1.5rem;
    }

    .signature-form-section {
      margin-bottom: 1.5rem;
    }

    .signature-form-section:last-child {
      margin-bottom: 0;
    }

    .signature-section-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: #a78bfa;
      margin-bottom: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .signature-form-group {
      margin-bottom: 1rem;
    }

    .signature-form-label {
      display: block;
      font-size: 0.8125rem;
      font-weight: 500;
      color: #cbd5e1;
      margin-bottom: 0.375rem;
    }

    .signature-form-input {
      width: 100%;
      padding: 0.625rem 0.875rem;
      background: rgba(30, 41, 59, 0.6);
      border: 1px solid rgba(168, 85, 247, 0.2);
      border-radius: 0.375rem;
      color: white;
      font-size: 0.875rem;
      transition: all 0.2s ease;
    }

    .signature-form-input:focus {
      outline: none;
      border-color: rgba(99, 102, 241, 0.5);
      background: rgba(30, 41, 59, 0.8);
    }

    .signature-form-input::placeholder {
      color: #64748b;
    }

    /* Two Column Layout */
    .signature-form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    /* Upload Buttons */
    .signature-upload-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .signature-upload-btn {
      padding: 0.75rem;
      background: rgba(30, 41, 59, 0.6);
      border: 2px dashed rgba(168, 85, 247, 0.3);
      border-radius: 0.5rem;
      color: #cbd5e1;
      font-size: 0.8125rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      text-align: center;
    }

    .signature-upload-btn:hover {
      background: rgba(30, 41, 59, 0.8);
      border-color: rgba(99, 102, 241, 0.5);
    }

    .signature-upload-btn svg {
      width: 24px;
      height: 24px;
      color: #a78bfa;
    }

    /* Auto-Apply Settings */
    .signature-settings-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.75rem;
    }

    .signature-checkbox-card {
      background: rgba(30, 41, 59, 0.6);
      border: 1px solid rgba(168, 85, 247, 0.2);
      border-radius: 0.5rem;
      padding: 0.875rem;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.625rem;
    }

    .signature-checkbox-card:hover {
      background: rgba(30, 41, 59, 0.8);
      border-color: rgba(168, 85, 247, 0.3);
    }

    .signature-checkbox-card.active {
      background: rgba(99, 102, 241, 0.2);
      border-color: rgba(99, 102, 241, 0.5);
    }

    .signature-checkbox {
      width: 18px;
      height: 18px;
      border: 2px solid #64748b;
      border-radius: 0.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .signature-checkbox-card.active .signature-checkbox {
      background: #6366f1;
      border-color: #6366f1;
    }

    .signature-checkbox svg {
      width: 12px;
      height: 12px;
      color: white;
      display: none;
    }

    .signature-checkbox-card.active .signature-checkbox svg {
      display: block;
    }

    .signature-checkbox-label {
      font-size: 0.8125rem;
      color: #cbd5e1;
      font-weight: 500;
    }

    /* Accent Color Picker */
    .signature-color-picker-wrapper {
      display: flex;
      gap: 0.75rem;
      align-items: center;
    }

    .signature-color-swatch {
      width: 48px;
      height: 48px;
      border-radius: 0.5rem;
      border: 2px solid rgba(168, 85, 247, 0.3);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .signature-color-swatch:hover {
      transform: scale(1.05);
      border-color: rgba(99, 102, 241, 0.5);
    }

    .signature-color-input {
      display: none;
    }

    /* CTA Button Builder */
    .signature-cta-builder {
      display: grid;
      grid-template-columns: 2fr 3fr auto;
      gap: 0.75rem;
      align-items: end;
    }

    .signature-cta-preview {
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(30, 41, 59, 0.4);
      border: 1px solid rgba(168, 85, 247, 0.15);
      border-radius: 0.5rem;
    }

    .signature-cta-button-preview {
      display: inline-block;
      padding: 0.625rem 1.25rem;
      background: #6366f1;
      color: white;
      text-decoration: none;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .signature-cta-button-preview:hover {
      background: #4f46e5;
    }

    /* Modal Footer */
    .signature-modal-footer {
      display: flex;
      justify-content: space-between;
      gap: 1rem;
      padding: 1.25rem 1.5rem;
      border-top: 1px solid rgba(168, 85, 247, 0.2);
      background: rgba(15, 23, 42, 0.4);
    }

    .signature-footer-left {
      display: flex;
      gap: 0.75rem;
    }

    .signature-footer-right {
      display: flex;
      gap: 0.75rem;
    }

    .signature-btn {
      padding: 0.625rem 1.25rem;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .signature-btn-secondary {
      background: rgba(71, 85, 105, 0.3);
      border-color: rgba(100, 116, 139, 0.4);
      color: #cbd5e1;
    }

    .signature-btn-secondary:hover {
      background: rgba(71, 85, 105, 0.5);
    }

    .signature-btn-danger {
      background: rgba(239, 68, 68, 0.2);
      border-color: rgba(239, 68, 68, 0.4);
      color: #fca5a5;
    }

    .signature-btn-danger:hover {
      background: rgba(239, 68, 68, 0.3);
    }

    .signature-btn-primary {
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      border-color: transparent;
      color: white;
    }

    .signature-btn-primary:hover {
      background: linear-gradient(135deg, #4f46e5, #7c3aed);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
    }

    .signature-btn svg {
      width: 16px;
      height: 16px;
    }

    /* Manage Signatures Button in Email Header */
    .manage-signatures-btn {
      padding: 0.5rem 1rem;
      background: rgba(99, 102, 241, 0.1);
      border: 1px solid rgba(99, 102, 241, 0.3);
      border-radius: 0.375rem;
      color: #a78bfa;
      font-size: 0.8125rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .manage-signatures-btn:hover {
      background: rgba(99, 102, 241, 0.2);
      border-color: rgba(99, 102, 241, 0.5);
      transform: translateY(-1px);
    }

    .manage-signatures-btn svg {
      width: 16px;
      height: 16px;
    }

    /* Mobile Responsive */
    @media (max-width: 1024px) {
      .signature-bento {
        grid-template-columns: 1fr;
      }

      .signature-templates-panel {
        max-height: 300px;
      }

      .signature-form-row,
      .signature-upload-group,
      .signature-settings-grid {
        grid-template-columns: 1fr;
      }
    }


    /* Field Reorder Section */
    .field-reorder-section {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(168, 85, 247, 0.2);
    }

    .field-reorder-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .field-reorder-item {
      background: rgba(30, 41, 59, 0.6);
      border: 1px solid rgba(168, 85, 247, 0.2);
      border-radius: 0.375rem;
      padding: 0.75rem;
      cursor: move;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      transition: all 0.2s ease;
      user-select: none;
    }

    .field-reorder-item:hover {
      background: rgba(30, 41, 59, 0.8);
      border-color: rgba(168, 85, 247, 0.4);
      transform: translateX(2px);
    }

    .field-reorder-item.dragging {
      opacity: 0.5;
      transform: scale(0.95);
    }

    .field-reorder-item.drag-over {
      border-color: rgba(99, 102, 241, 0.6);
      background: rgba(99, 102, 241, 0.2);
      border-style: dashed;
    }

    .field-drag-handle {
      color: #64748b;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .field-drag-handle svg {
      width: 16px;
      height: 16px;
    }

    .field-reorder-name {
      flex: 1;
      color: #cbd5e1;
      font-size: 0.8125rem;
      font-weight: 500;
    }

    .field-visibility-toggle {
      width: 18px;
      height: 18px;
      border: 2px solid #64748b;
      border-radius: 0.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .field-visibility-toggle.visible {
      background: #6366f1;
      border-color: #6366f1;
    }

    .field-visibility-toggle svg {
      width: 12px;
      height: 12px;
      color: white;
      display: none;
    }

    .field-visibility-toggle.visible svg {
      display: block;
    }

    .field-reorder-hint {
      font-size: 0.75rem;
      color: #64748b;
      margin-top: 0.5rem;
      font-style: italic;
    }


    /* ==========================================

MEETINGS WIDGET
       ========================================== */

    .meetings-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .meeting-item {
      display: flex;
      gap: 1rem;
      padding: 1rem;
      background: rgba(30, 41, 59, 0.4);
      border: 1px solid rgba(168, 85, 247, 0.2);
      border-radius: 0.5rem;
      transition: all 0.2s ease;
    }

    .meeting-item:hover {
      background: rgba(30, 41, 59, 0.6);
      border-color: rgba(168, 85, 247, 0.4);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .meeting-time {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-width: 80px;
      padding: 0.75rem;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
      border: 1px solid rgba(99, 102, 241, 0.3);
      border-radius: 0.5rem;
    }

    .meeting-date {
      font-size: 0.75rem;
      font-weight: 600;
      color: #a78bfa;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .meeting-hour {
      font-size: 1rem;
      font-weight: 700;
      color: white;
      margin-top: 0.25rem;
    }

    .meeting-details {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .meeting-title {
      font-size: 0.9375rem;
      font-weight: 600;
      color: white;
    }

    .meeting-client {
      font-size: 0.8125rem;
      color: #94a3b8;
    }

    .meeting-location {
      display: flex;
      align-items: center;
      gap: 0.375rem;
      font-size: 0.75rem;
      color: #64748b;
      margin-top: 0.25rem;
    }

    .meeting-actions {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .meeting-action-btn {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(99, 102, 241, 0.1);
      border: 1px solid rgba(99, 102, 241, 0.3);
      border-radius: 0.375rem;
      cursor: pointer;
      transition: all 0.2s ease;
      padding: 0;
    }

    .meeting-action-btn:hover {
      background: rgba(99, 102, 241, 0.2);
      border-color: rgba(99, 102, 241, 0.5);
      transform: scale(1.05);
    }

    .meeting-action-btn svg {
      width: 18px;
      height: 18px;
      color: #a78bfa;
    }

    .schedule-meeting-btn {
      padding: 0.5rem 1rem;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      border: none;
      border-radius: 0.375rem;
      color: white;
      font-size: 0.8125rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .schedule-meeting-btn:hover {
      background: linear-gradient(135deg, #4f46e5, #7c3aed);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
    }

    .no-meetings {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 3rem 1rem;
      text-align: center;
    }

    /* Schedule Meeting Button in Email Composer */
    .email-schedule-btn {
      padding: 0.5rem 0.875rem;
      background: rgba(99, 102, 241, 0.1);
      border: 1px solid rgba(99, 102, 241, 0.3);
      border-radius: 0.375rem;
      color: #a78bfa;
      font-size: 0.8125rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .email-schedule-btn:hover {
      background: rgba(99, 102, 241, 0.2);
      border-color: rgba(99, 102, 241, 0.5);
      transform: translateY(-1px);
    }

    .email-schedule-btn svg {
      width: 16px;
      height: 16px;
    }
  </style>

</head>
<body>

  
  <div class="container">
    
    <!-- Header -->
    <div class="header">
      <div>
        <h1>Loan Status</h1>
        <div style="color: #94a3b8; font-size: 1rem; margin-top: 0.25rem; display: flex; align-items: center; gap: 0.5rem;">
          <span>John Doe  Mary Doe</span>
          <span title="Back to Dashboard" style="display: inline-flex; align-items: center;">
            <svg onclick="console.log('Back to Dashboard - feature coming soon')" style="width: 18px; height: 18px; cursor: pointer; color: #a78bfa; transition: all 0.3s;" onmouseover="this.style.color='#d8b4fe'" onmouseout="this.style.color='#a78bfa'" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
          </span>
        </div>
      </div>
      <div class="header-buttons">
        <button class="email-btn" onclick="openEmailModal()" title="Email Inbox">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
            <polyline points="22,6 12,13 2,6"></polyline>
          </svg>
          Email
          <span class="badge">5</span>
        </button>
        <button class="screen-share-btn" onclick="startScreenShare()" title="Screen Share">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
            <line x1="8" y1="21" x2="16" y2="21"></line>
            <line x1="12" y1="17" x2="12" y2="21"></line>
            <path d="M7 10l5 3 5-3"></path>
          </svg>
          Screen Share
        </button>
        <div class="live-indicator" onclick="toggleLoanTimeline()" title="Loan Timeline" style="cursor: pointer;">
          <div class="live-dot"></div>
          Live
        </div>
      </div>
    </div>

    <!-- Performance Card -->
    <div class="performance-card">
      <!-- 1. COMPLETION -->
      <div class="metric-item">
        <div class="metric-label">Completion</div>
        <div class="metric-value">
          72<span class="metric-unit">%</span>
        </div>
      </div>
      
      <!-- 2. DOCS -->
      <div class="metric-item">
        <div class="metric-label">Docs</div>
        <div class="metric-value">
          3
          <span style="font-size: 0.75rem; color: #ef4444; font-weight: 600; margin-left: 0.25rem;">Pending</span>
        </div>
      </div>
      
      <!-- 3. SERVICES -->
      <div class="metric-item">
        <div class="metric-label">Services</div>
        <div class="metric-value">
          2
          <span style="font-size: 0.75rem; color: #ef4444; font-weight: 600; margin-left: 0.25rem;">Pending</span>
        </div>
      </div>
      
      <!-- 4. CATEGORY -->
      <div class="metric-item">
        <div class="metric-label">Category</div>
        <div class="metric-value">
          VA
        </div>
      </div>
      
      <!-- 5. LOAN AMOUNT -->
      <div class="metric-item">
        <div class="metric-label">Loan Amount</div>
        <div class="metric-value">
          $425,000
        </div>
      </div>
      
      <!-- 6. INTEREST RATE -->
      <div class="metric-item">
        <div class="metric-label">Interest Rate</div>
        <div class="metric-value">
          6.75<span class="metric-unit">%</span>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; color: #10b981; margin-left: 0.25rem;">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
          </svg>
        </div>
      </div>
      
      <!-- 6. LOCKED YIELD -->
      <div class="metric-item">
        <div class="metric-label">Locked Yield</div>
        <div class="metric-value">
          3.95
          <span style="font-size: 0.75rem; color: #10b981; font-weight: 600; display: inline-flex; align-items: center; gap: 0.25rem;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 12px; height: 12px;">
              <path d="m18 15-6-6-6 6"/>
            </svg>
            10 yr
          </span>
        </div>
      </div>
      
      <!-- 8. LOCK EXPIRES -->
      <div class="metric-item">
        <div class="metric-label">Lock Expires</div>
        <div class="metric-value">
          18 days
          <button class="metrics-customize-btn" onclick="openMetricsModal()" title="Customize Metrics" style="position: static; opacity: 0.6; margin-left: 0.5rem; padding: 0.35rem;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="3"/>
              <path d="M12 1v6m0 6v6m5.2-13a9.9 9.9 0 0 1 3.8 3.8M21 12h-6M5 12H1m3.8 5.2a9.9 9.9 0 0 1-3.8-3.8"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
    <!-- Navigation Pills -->
    <div class="nav-container">
      <div class="nav-pills">
        <!-- Documents Dropdown -->
        <div class="nav-pill-dropdown" id="docsDropdownContainer">
          <button class="nav-pill" onclick="toggleDocsDropdown(event)" id="docsTabButton">
            <div class="nav-pill-icon"><svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div>
            Documents
            <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; margin-left: 0.25rem;">
              <path d="m6 9 6 6 6-6"/>
            </svg>
          </button>
          <div class="docs-dropdown-menu" id="docsDropdownMenu">
            <div class="dropdown-option" onclick="selectDocsFilter(event, 'pending')">Pending</div>
            <div class="dropdown-option" onclick="selectDocsFilter(event, 'underreview')">Under Review</div>
            <div class="dropdown-option" onclick="selectDocsFilter(event, 'cleared')">Cleared</div>
            <div class="dropdown-option" onclick="selectDocsFilter(event, 'all')">Show All</div>
            <div class="dropdown-option" onclick="selectDocsFilter(event, 'search')">Search</div>
            <div class="dropdown-option" onclick="selectDocsFilter(event, 'updatedocs')">Update Docs</div>
          </div>
        </div>
        <!-- Vendors Dropdown -->
        <div class="nav-pill-dropdown" id="vendorsDropdownContainer">
          <button class="nav-pill" onclick="toggleVendorsDropdown(event)" id="vendorsTabButton">
            <div class="nav-pill-icon"><svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg></div>
            Vendors
            <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; margin-left: 0.25rem;">
              <path d="m6 9 6 6 6-6"/>
            </svg>
          </button>
          <div class="vendors-dropdown-menu" id="vendorsDropdownMenu">
            <div class="dropdown-option" onclick="selectVendorsFilter(event, 'pending')">Pending</div>
            <div class="dropdown-option" onclick="selectVendorsFilter(event, 'underreview')">Under Review</div>
            <div class="dropdown-option" onclick="selectVendorsFilter(event, 'cleared')">Cleared</div>
            <div class="dropdown-option" onclick="selectVendorsFilter(event, 'all')">Show All</div>
            <div class="dropdown-option" onclick="selectVendorsFilter(event, 'search')">Search</div>
            <div class="dropdown-option" onclick="selectVendorsFilter(event, 'updatevendors')">Update Vendors</div>
          </div>
        </div>
        <!-- Rate Lock Dropdown -->
        <div class="nav-pill-dropdown" id="ratelockDropdownContainer">
          <button class="nav-pill" onclick="toggleRatelockDropdown(event)" id="ratelockTabButton">
            <div class="nav-pill-icon"><svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg></div>
            Rate Lock
            <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; margin-left: 0.25rem;">
              <path d="m6 9 6 6 6-6"/>
            </svg>
          </button>
          <div class="ratelock-dropdown-menu" id="ratelockDropdownMenu">
            <div class="dropdown-option" onclick="selectRatelockFilter(event, 'lock')">Lock</div>
            <div class="dropdown-option" onclick="selectRatelockFilter(event, 'search')">Search</div>
            <div class="dropdown-option" onclick="selectRatelockFilter(event, 'updatelock')">Update Lock</div>
          </div>
        </div>
        <!-- Figures Dropdown -->
        <div class="nav-pill-dropdown" id="figuresDropdownContainer">
          <button class="nav-pill" onclick="toggleFiguresDropdown(event)" id="figuresTabButton">
            <div class="nav-pill-icon"><svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg></div>
            Figures
            <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; margin-left: 0.25rem;">
              <path d="m6 9 6 6 6-6"/>
            </svg>
          </button>
          <div class="figures-dropdown-menu" id="figuresDropdownMenu">
            <div class="dropdown-option" onclick="selectFiguresFilter(event, 'le')">Loan Estimate</div>
            <div class="dropdown-option" onclick="selectFiguresFilter(event, 'cd')">Closing Disclosure</div>
            <div class="dropdown-option" onclick="selectFiguresFilter(event, 'all')">Show All</div>
            <div class="dropdown-option" onclick="selectFiguresFilter(event, 'search')">Search</div>
            <div class="dropdown-option" onclick="selectFiguresFilter(event, 'updatefigures')">Update Figures</div>
          </div>
        </div>
        <!-- Team Dropdown -->
        <div class="nav-pill-dropdown" id="teamDropdownContainer">
          <button class="nav-pill" onclick="toggleTeamDropdown(event)" id="teamTabButton">
            <div class="nav-pill-icon"><svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg></div>
            Team
            <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; margin-left: 0.25rem;">
              <path d="m6 9 6 6 6-6"/>
            </svg>
          </button>
          <div class="team-dropdown-menu" id="teamDropdownMenu">
            <div class="dropdown-option" onclick="selectTeamFilter(event, 'origination')">Origination</div>
            <div class="dropdown-option" onclick="selectTeamFilter(event, 'processing')">Processing</div>
            <div class="dropdown-option" onclick="selectTeamFilter(event, 'underwriting')">Underwriting</div>
            <div class="dropdown-option" onclick="selectTeamFilter(event, 'closing')">Closing</div>
            <div class="dropdown-option" onclick="selectTeamFilter(event, 'audit')">Audit</div>
            <div class="dropdown-option" onclick="selectTeamFilter(event, 'funding')">Funding</div>
            <div class="dropdown-option" onclick="selectTeamFilter(event, 'all')">Show All</div>
            <div class="dropdown-option" onclick="selectTeamFilter(event, 'search')">Search</div>
            <div class="dropdown-option" onclick="selectTeamFilter(event, 'updateteam')">Update Team</div>
          </div>
        </div>
        <!-- Loan Details Dropdown -->
        <div class="nav-pill-dropdown" id="loandetailsDropdownContainer">
          <button class="nav-pill" onclick="toggleLoanDetailsDropdown(event)" id="loandetailsTabButton">
            <div class="nav-pill-icon"><svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></div>
            Loan
            <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; margin-left: 0.25rem;">
              <path d="m6 9 6 6 6-6"/>
            </svg>
          </button>
          <div class="loandetails-dropdown-menu" id="loandetailsDropdownMenu">
            <div class="dropdown-option" onclick="selectLoanDetailsFilter(event, 'ratio')">Ratio</div>
            <div class="dropdown-option" onclick="selectLoanDetailsFilter(event, 'amount')">Amount</div>
            <div class="dropdown-option" onclick="selectLoanDetailsFilter(event, 'property')">Property</div>
            <div class="dropdown-option" onclick="selectLoanDetailsFilter(event, 'credit')">Credit</div>
            <div class="dropdown-option" onclick="selectLoanDetailsFilter(event, 'loan')">Loan</div>
            <div class="dropdown-option" onclick="selectLoanDetailsFilter(event, 'all')">Show All</div>
            <div class="dropdown-option" onclick="selectLoanDetailsFilter(event, 'search')">Search</div>
            <div class="dropdown-option" onclick="selectLoanDetailsFilter(event, 'updateloan')">Update Loan</div>
          </div>
        </div>
        <!-- Activity Dropdown -->
        <div class="nav-pill-dropdown" id="activityDropdownContainer">
          <button class="nav-pill" onclick="toggleActivityDropdown(event)" id="activityTabButton">
            <div class="nav-pill-icon"><svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></div>
            Activity
            <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; margin-left: 0.25rem;">
              <path d="m6 9 6 6 6-6"/>
            </svg>
          </button>
          <div class="activity-dropdown-menu" id="activityDropdownMenu">
            <div class="dropdown-option" onclick="selectActivityFilter(event, 'calls')">Calls</div>
            <div class="dropdown-option" onclick="selectActivityFilter(event, 'emails')">Emails</div>
            <div class="dropdown-option" onclick="selectActivityFilter(event, 'notes')">Notes</div>
            <div class="dropdown-option" onclick="selectActivityFilter(event, 'all')">Show All</div>
            <div class="dropdown-option" onclick="selectActivityFilter(event, 'search')">Search</div>
            <div class="dropdown-option" onclick="selectActivityFilter(event, 'updateactivity')">Update Activity</div>
          </div>
        </div>
        <!-- Notes Dropdown -->
        <div class="nav-pill-dropdown" id="notesDropdownContainer">
          <button class="nav-pill" onclick="toggleNotesDropdown(event)" id="notesTabButton">
            <div class="nav-pill-icon"><svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg></div>
            Notes
            <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; margin-left: 0.25rem;">
              <path d="m6 9 6 6 6-6"/>
            </svg>
          </button>
          <div class="notes-dropdown-menu" id="notesDropdownMenu">
            <div class="dropdown-option" onclick="selectNotesFilter(event, 'lead')">Lead</div>
            <div class="dropdown-option" onclick="selectNotesFilter(event, 'quote')">Quote</div>
            <div class="dropdown-option" onclick="selectNotesFilter(event, 'loanprep')">Loan Prep</div>
            <div class="dropdown-option" onclick="selectNotesFilter(event, 'loan')">Loan</div>
            <div class="dropdown-option" onclick="selectNotesFilter(event, 'funding')">Funding</div>
            <div class="dropdown-option" onclick="selectNotesFilter(event, 'audit')">Audit</div>
            <div class="dropdown-option" onclick="selectNotesFilter(event, 'closing')">Closing</div>
            <div class="dropdown-option" onclick="selectNotesFilter(event, 'all')">Show All</div>
            <div class="dropdown-option" onclick="selectNotesFilter(event, 'search')">Search</div>
            <div class="dropdown-option" onclick="selectNotesFilter(event, 'updatenotes')">Update Notes</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Two Card Layout -->
    <div class="two-col-grid">
      
      <!-- Left Card - Documents -->
      <div class="card hidden" id="leftCard">
        <!-- Detail View - Document List -->
        <div class="docs-list morphing" id="docsList">
          <!-- Documents will be dynamically populated here -->
        </div>
        
        <!-- Overview View - Stage Cards -->
        <div class="stage-cards morphing" id="stageCards" style="display: none; opacity: 0;">
          <div class="stage-card" data-color="#3b82f6">
            <div class="stage-title">Loan Prep</div>
            <div class="stage-count">8 Docs Requested</div>
          </div>
          
          <div class="stage-card" data-color="#8b5cf6">
            <div class="stage-title">Initial Approval</div>
            <div class="stage-count">4 Docs Requested</div>
          </div>
          
          <div class="stage-card" data-color="#10b981">
            <div class="stage-title">Final Approval</div>
            <div class="stage-count">2 Docs Requested</div>
          </div>
        </div>
      </div>

      <!-- Right Card - Icon -->
      <div class="card icon-card hidden" id="rightCard">
        <!-- Toggle Button -->
        <button class="view-toggle-btn" id="viewToggle" onclick="toggleView()" title="Show All">
          <svg id="toggleIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <!-- Stack icon (default) -->
            <path d="M3 8L12 3L21 8L12 13L3 8Z"/>
            <path d="M3 12L12 17L21 12"/>
            <path d="M3 16L12 21L21 16"/>
          </svg>
        </button>
        
        <!-- Percentage Icon Box (below toggle) -->
        <div class="percentage-icon-box" id="percentageIconBox" style="display: none; cursor: pointer;" onclick="filterLoanDetails('percentage')" title="LTV - Back End&#10;LTV - Front End&#10;DTI Ratio">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <!-- Circle background -->
            <circle cx="12" cy="12" r="9" fill="none" stroke="#8b5cf6" stroke-width="2"/>
            <!-- Top circle of % -->
            <circle cx="9" cy="9" r="1.5" fill="#8b5cf6"/>
            <!-- Bottom circle of % -->
            <circle cx="15" cy="15" r="1.5" fill="#8b5cf6"/>
            <!-- Diagonal line of % -->
            <line x1="8" y1="16" x2="16" y2="8" stroke="#8b5cf6" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        
        <!-- Dollar Sign Icon Box (below percentage) -->
        <div class="dollar-icon-box" id="dollarIconBox" style="display: none; cursor: pointer;" onclick="filterLoanDetails('dollar')" title="Cash Out Amount&#10;Loan Amount&#10;Monthly Payment&#10;HOA Fees">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <!-- Circle background -->
            <circle cx="12" cy="12" r="9" fill="none" stroke="#10b981" stroke-width="2"/>
            <!-- Dollar sign -->
            <path d="M12 5 L12 19 M8 9 Q8 7 12 7 Q16 7 16 9 Q16 11 12 11 Q8 11 8 13 Q8 15 12 15 Q16 15 16 13" 
                  stroke="#10b981" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        
        <!-- Home Icon Box (below dollar) -->
        <div class="home-icon-box" id="homeIconBox" style="display: none; cursor: pointer;" onclick="filterLoanDetails('home')" title="Appraised Value&#10;Estimated Value&#10;Property Use&#10;Property Type">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <!-- Circle background -->
            <circle cx="12" cy="12" r="9" fill="none" stroke="#3b82f6" stroke-width="2"/>
            <!-- Home roof -->
            <path d="M6 12 L12 7 L18 12" stroke="#3b82f6" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
            <!-- Home body -->
            <path d="M7 12 L7 17 L17 17 L17 12" stroke="#3b82f6" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
            <!-- Door -->
            <rect x="10" y="14" width="4" height="3" stroke="#3b82f6" stroke-width="1.5" fill="none"/>
          </svg>
        </div>
        
        <!-- Info Icon Box (below home) -->
        <div class="info-icon-box" id="infoIconBox" style="display: none; cursor: pointer;" onclick="filterLoanDetails('info')" title="Mid FICO Score&#10;Borrower Scores&#10;Co-Borrower Scores">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <!-- Circle background -->
            <circle cx="12" cy="12" r="9" fill="none" stroke="#f59e0b" stroke-width="2"/>
            <!-- Info dot (top) -->
            <circle cx="12" cy="9" r="1" fill="#f59e0b"/>
            <!-- Info line (bottom) -->
            <line x1="12" y1="12" x2="12" y2="16" stroke="#f59e0b" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        
        <!-- Wrench/Tool Icon Box (below info) -->
        <div class="wrench-icon-box" id="wrenchIconBox" style="display: none; cursor: pointer;" onclick="filterLoanDetails('wrench')" title="Loan Purpose&#10;Loan Program&#10;Loan Category&#10;Lender">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <!-- Circle background -->
            <circle cx="12" cy="12" r="9" fill="none" stroke="#ef4444" stroke-width="2"/>
            <!-- Wrench -->
            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z" 
                  stroke="#ef4444" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round" transform="translate(-2, -2) scale(0.85)"/>
          </svg>
        </div>
        
        <!-- LE Icon Box (for Figures tab) -->
        <div class="le-icon-box" id="leIconBox" style="display: none; cursor: pointer;" onclick="filterFigures('le')" title="Initial LE&#10;Updated LE">
          LE
        </div>
        
        <!-- CD Icon Box (for Figures tab) -->
        <div class="cd-icon-box" id="cdIconBox" style="display: none; cursor: pointer;" onclick="filterFigures('cd')" title="Initial CD&#10;Updated CD&#10;Final CD&#10;Closing CD">
          CD
        </div>
        
        
        <!-- Detail View - Paper Stack Icon -->
        <svg class="stacked-icon morphing" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" id="stackedIcon" style="opacity: 1; transform: scale(1) rotate(0deg);">
          <!-- Layers will be dynamically generated -->
        </svg>
        
        <!-- Overview View - Pie Chart -->
        <div class="pie-chart-container morphing" id="pieChartContainer" style="display: none; opacity: 0; transform: scale(0.8) rotate(180deg);">
          <svg class="pie-chart" viewBox="0 0 280 280" id="pieChart">
            <!-- Pie chart will be dynamically generated -->
          </svg>
        </div>
      </div>

    </div>

    <!-- Loan Timeline Container -->
    <div class="service-tracker-container" id="loanTimelineContainer">
      <div class="service-tracker-card">
        <div class="tracker-header">
          <div class="tracker-title" style="cursor: default;">
            Loan Timeline
          </div>
          <button class="tracker-close-btn" onclick="closeLoanTimeline()"></button>
        </div>

        <div id="loanTimelineContent">
          <!-- Loan timeline will be added here -->
        </div>
      </div>
    </div>

    <!-- Service Tracker Container -->
    <div class="service-tracker-container" id="serviceTrackerContainer">
      <div class="service-tracker-card">
        <div class="tracker-header">
          <div class="tracker-title-dropdown-wrapper">
            <div class="tracker-title" onclick="toggleTrackerDropdown()">
              Track Services
              <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 20px; height: 20px;">
                <path d="m6 9 6 6 6-6"/>
              </svg>
            </div>
            <div class="tracker-dropdown-menu" id="trackerDropdown">
              <div class="dropdown-option" onclick="selectTrackerFilter('pending')">Pending Services</div>
              <div class="dropdown-option" onclick="selectTrackerFilter('completed')">Completed Services</div>
              <div class="dropdown-option" onclick="selectTrackerFilter('all')">See All</div>
            </div>
          </div>
          <button class="tracker-close-btn" onclick="closeServiceTracker()"></button>
        </div>

        <div id="serviceTrackersContent">
          <!-- Service trackers will be added here -->
        </div>
      </div>
    </div>

    <!-- Tables Container (appears below the two-card section) -->
    <div id="tablesContainer">
      <!-- Expandable tables will be dynamically added here -->
    </div>

  </div>

  <!-- Modal Overlay -->
  <div class="modal-overlay" id="modalOverlay" onclick="closeModalOnOverlay(event)">
    <div class="modal" onclick="event.stopPropagation()">
      
      <!-- Step 1: Initial Choice -->
      <div id="choiceStep">
        <div class="modal-header">
          <h2 class="modal-title" id="modalTitle">Update Documents</h2>
          <button class="close-btn" onclick="closeModal()"></button>
        </div>
        
        <div class="choice-buttons">
          <button class="choice-btn" id="requestBtn" onclick="showRequestDocs()">
            <br><span id="requestBtnText">Request Docs</span>
          </button>
          <button class="choice-btn" id="clearBtn" onclick="showClearDocs()">
            <br><span id="clearBtnText">Clear Docs</span>
          </button>
        </div>
      </div>

      <!-- Step 2: Request Documents Form -->
      <div id="requestStep" style="display: none;">
        <div class="modal-header">
          <h2 class="modal-title">Request Documents</h2>
          <button class="close-btn" onclick="closeModal()"></button>
        </div>
        
        <div class="modal-date" id="currentDate"></div>

        <form onsubmit="return handleRequestSubmit(event)">
          <div class="form-group">
            <label class="form-label">Loan Stage</label>
            <select class="form-select" required>
              <option value="">Select</option>
              <option value="loan-prep">Loan Prep</option>
              <option value="pre-approval-purchase">Pre-Approval Purchase</option>
              <option value="pre-approval-refi">Pre-Approval Refi</option>
              <option value="initial-approval">Initial Approval</option>
              <option value="final-approval">Final Approval</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Category</label>
            <select class="form-select" required>
              <option value="">Select</option>
              <option value="mortgage">Mortgage</option>
              <option value="income">Income</option>
              <option value="insurance">Insurance</option>
              <option value="taxes">Taxes</option>
              <option value="id">ID</option>
              <option value="property">Property</option>
              <option value="other">Other</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Document</label>
            <input type="text" class="form-input" placeholder="Enter document name" required>
          </div>

          <div class="form-group">
            <label class="form-label">Document From</label>
            <select class="form-select" required>
              <option value="">Select</option>
              <option value="john-doe">John Doe</option>
              <option value="jane-doe">Jane Doe</option>
              <option value="both">John & Jane Doe</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Request Method</label>
            <select class="form-select" required>
              <option value="">Select</option>
              <option value="email">Email</option>
              <option value="text">Text</option>
              <option value="call">Call</option>
            </select>
          </div>

          <button type="button" class="back-btn" onclick="showChoice()" style="margin-bottom: 0.75rem;"> Back</button>
          <button type="submit" class="save-btn">Save</button>
        </form>
      </div>

      <!-- Step 3: Clear Documents Form -->
      <div id="clearStep" style="display: none;">
        <div class="modal-header">
          <h2 class="modal-title">Clear Received Documents</h2>
          <button class="close-btn" onclick="closeModal()"></button>
        </div>
        
        <div class="modal-date" id="currentDate2"></div>

        <form onsubmit="return handleClearSubmit(event)">
          <div class="form-group">
            <label class="form-label">Request Date</label>
            <input type="date" class="form-input" required>
          </div>

          <div class="form-group">
            <label class="form-label">Received Method</label>
            <select class="form-select" required>
              <option value="">Select</option>
              <option value="upload">Upload</option>
              <option value="email">Email</option>
              <option value="text">Text</option>
              <option value="mail">Mail</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Document</label>
            <input type="file" id="fileInput" style="display: none;">
            <button type="button" class="file-upload-btn" onclick="document.getElementById('fileInput').click()">
               Click to Attach Document
            </button>
            <span id="fileName" style="color: #d8b4fe; font-size: 0.75rem; margin-top: 0.5rem; display: block;"></span>
          </div>

          <div class="form-group">
            <label class="form-label">Clear</label>
            <div class="doc-checkbox-list" id="clearDocsList">
              <!-- Will be populated dynamically -->
            </div>
          </div>

          <button type="button" class="back-btn" onclick="showChoice()" style="margin-bottom: 0.75rem;"> Back</button>
          <button type="submit" class="save-btn">Save</button>
        </form>
      </div>

      <!-- Step 4: Activity Filter -->
      <div id="activityFilterStep" style="display: none;">
        <div class="modal-header">
          <h2 class="modal-title">Filter Activity</h2>
          <button class="close-btn" onclick="closeModal()"></button>
        </div>
        
        <div class="modal-date" id="currentDate3"></div>

        <form onsubmit="return handleActivityFilter(event)">
          <div class="form-group">
            <label class="form-label">Time Period</label>
            <select class="form-select" id="activityPeriod" onchange="toggleCustomDateRange()" required>
              <option value="">Select Period</option>
              <option value="today">Today</option>
              <option value="recent10">Most Recent 10</option>
              <option value="mtd">MTD (Month to Date)</option>
              <option value="custom">Custom Date Range</option>
            </select>
          </div>

          <div id="customDateRangeGroup" style="display: none;">
            <div class="form-group">
              <label class="form-label">From Date</label>
              <input type="date" class="form-input" id="fromDate">
            </div>

            <div class="form-group">
              <label class="form-label">To Date</label>
              <input type="date" class="form-input" id="toDate">
            </div>
          </div>

          <button type="submit" class="save-btn">Show Activity</button>
        </form>
      </div>

    </div>
  </div>


  <!-- Vendor Choice Popup Modal -->
  <div class="vendor-choice-overlay" id="vendorChoiceOverlay" onclick="closeVendorChoiceOnOverlay(event)">
    <div class="vendor-choice-container">
      <div class="vendor-choice-header">
        <h2 class="vendor-choice-title">View Vendor</h2>
        <button class="vendor-choice-close" onclick="closeVendorChoice()"></button>
      </div>
      <div class="vendor-choice-buttons">
        <button class="vendor-choice-btn" onclick="showVendorInfo()">
           Vendor Info
        </button>
        <button class="vendor-choice-btn" onclick="showVendorChart()">
           Vendor Chart
        </button>
        <button class="vendor-choice-btn" onclick="showVendorTracker()">
           Track Services
        </button>
      </div>
    </div>
  </div>


  
  <!-- Email Modal -->
  <div class="email-modal-overlay" id="emailModal">
    <div class="email-container">
      <!-- Email Header -->
      <!-- Email Header -->
      <div class="email-header">
        <div class="email-header-left">
          <svg class="email-icon-only" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
            <polyline points="22,6 12,13 2,6"></polyline>
          </svg>
          <button class="email-header-btn primary new-email-btn">
            New Email
          </button>
        </div>
        <div class="email-header-actions">
          <button class="manage-signatures-btn" onclick="openSignatureManager()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 3a2.83 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
            </svg>
            Signatures
          </button>
          <button class="email-header-btn" onclick="refreshEmails()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"></path>
            </svg>
            Refresh
          </button>
          <div class="email-search-compact">
            <input 
              type="text" 
              id="emailSearchInput"
              placeholder="Search emails..."
              oninput="handleEmailSearch(this.value)"
            />
            <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
          </div>
          <div class="email-window-controls">
            <button class="email-control-btn minimize" onclick="minimizeEmail()" title="Minimize">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M5 12h14"></path>
              </svg>
            </button>
            <button class="email-control-btn maximize" onclick="toggleMaximizeEmail()" title="Maximize/Restore">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
              </svg>
            </button>
            <button class="email-control-btn close" onclick="closeEmailModal()" title="Close">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 6L6 18M6 6l12 12"></path>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <!-- Email Body - 3 Panes -->
      <div class="email-body">
        <!-- Left Sidebar - Folders -->
        <div class="email-sidebar">
          <div class="email-sidebar-title">Folders</div>
          
          <!-- New Folder Button -->
          <button class="new-folder-btn" onclick="showNewFolderInput()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 5v14M5 12h14"></path>
            </svg>
            New Folder
          </button>

          <!-- New Folder Input (hidden by default) -->
          <div id="newFolderInput" class="folder-input-wrapper" style="display: none;">
            <input type="text" class="folder-input" id="folderNameInput" placeholder="Folder name..." onkeypress="if(event.key === 'Enter') createNewFolder()" />
            <button class="folder-input-btn" onclick="createNewFolder()">Create</button>
            <button class="folder-input-btn cancel" onclick="cancelFolderInput()">Cancel</button>
          </div>

          <!-- System Folders -->
          <div class="folder-section-title">System</div>
          <div class="email-folder system-folder active" data-folder-id="inbox" onclick="switchFolder('inbox', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
              <polyline points="22,6 12,13 2,6"></polyline>
            </svg>
            <span class="email-folder-name">Inbox</span>
            <span class="email-folder-count">12</span>
          </div>
          <div class="email-folder system-folder" data-folder-id="starred" onclick="switchFolder('starred', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
            </svg>
            <span class="email-folder-name">Starred</span>
            <span class="email-folder-count">3</span>
          </div>
          <div class="email-folder system-folder" data-folder-id="sent" onclick="switchFolder('sent', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"></path>
            </svg>
            <span class="email-folder-name">Sent</span>
          </div>
          <div class="email-folder system-folder" data-folder-id="drafts" onclick="switchFolder('drafts', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
            </svg>
            <span class="email-folder-name">Drafts</span>
            <span class="email-folder-count">2</span>
          </div>
          <div class="email-folder system-folder" data-folder-id="spam" onclick="switchFolder('spam', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            <span class="email-folder-name">Spam</span>
            <span class="email-folder-count">3</span>
          </div>
          <div class="email-folder system-folder" data-folder-id="trash" onclick="switchFolder('trash', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
            <span class="email-folder-name">Trash</span>
          </div>

          <!-- Custom Folders Section -->
          <div class="folder-divider"></div>
          <div class="folder-section-title">Custom Folders</div>
          <div id="customFolders">
            <!-- Custom folders will be rendered here dynamically -->
          </div>

          <!-- Resize Handle -->
          <div class="sidebar-resize-handle"></div>
        </div>
        <!-- Middle Pane - Email List -->
        <div class="email-list">
          <div class="email-list-header">
            <h3>Inbox</h3>
            <div class="email-list-actions">
              <button class="email-list-btn" title="Search">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.35-4.35"></path>
                </svg>
              </button>
              <button class="email-list-btn" title="Filter">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                </svg>
              </button>
            </div>
          </div>
          <div class="email-list-items" id="emailListItems">
            <!-- Email items will be loaded here -->
            <div class="email-item unread active" onclick="viewEmail(1)">
              <div class="email-item-header">
                <span class="email-item-sender">John Doe</span>
                <span class="email-item-time">2 min ago</span>
              </div>
              <div class="email-item-subject">Loan Documents Ready</div>
              <div class="email-item-preview">Hi there, your loan documents have been processed and are ready for review. Please check the attached files...</div>
            </div>

            <div class="email-item unread" onclick="viewEmail(2)">
              <div class="email-item-header">
                <span class="email-item-sender">Jane Smith</span>
                <span class="email-item-time">15 min ago</span>
              </div>
              <div class="email-item-subject">Appraisal Update</div>
              <div class="email-item-preview">The property appraisal has been completed. The final value came in at $450,000 which is great news for your loan application...</div>
            </div>

            <div class="email-item" onclick="viewEmail(3)">
              <div class="email-item-header">
                <div class="email-item-header-left">
                  <span class="email-item-sender">Mike Johnson</span>
                </div>
                <div class="email-item-header-right">
                  <span class="email-item-time">1 hour ago</span>
                  <div class="email-star" onclick="toggleStar(event, 3)" title="Star">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="email-item-subject">Closing Date Confirmation</div>
              <div class="email-item-preview">Your closing date has been confirmed for November 15th. Please make sure all documents are signed by then...</div>
            </div>

            <div class="email-item unread" onclick="viewEmail(4)">
              <div class="email-item-header">
                <div class="email-item-header-left">
                  <span class="email-item-sender">Sarah Williams</span>
                </div>
                <div class="email-item-header-right">
                  <span class="email-item-time">3 hours ago</span>
                  <div class="email-star" onclick="toggleStar(event, 4)" title="Star">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="email-item-subject">Insurance Quote Ready</div>
              <div class="email-item-preview">I've prepared your homeowners insurance quote. The annual premium is $1,200 with full coverage...</div>
            </div>

            <div class="email-item" onclick="viewEmail(5)">
              <div class="email-item-header">
                <div class="email-item-header-left">
                  <span class="email-item-sender">Tom Brown</span>
                </div>
                <div class="email-item-header-right">
                  <span class="email-item-time">Yesterday</span>
                  <div class="email-star starred" onclick="toggleStar(event, 5)" title="Star">
                    <svg viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
                      <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="email-item-subject">Title Search Complete</div>
              <div class="email-item-preview">The title search has been completed successfully. No issues were found and the property has a clean title...</div>
            </div>

            <div class="email-item unread" onclick="viewEmail(6)">
              <div class="email-item-header">
                <div class="email-item-header-left">
                  <span class="email-item-sender">Lisa Anderson</span>
                </div>
                <div class="email-item-header-right">
                  <span class="email-item-time">Yesterday</span>
                  <div class="email-star" onclick="toggleStar(event, 6)" title="Star">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="email-item-subject">Rate Lock Reminder</div>
              <div class="email-item-preview">Just a friendly reminder that your rate lock expires in 18 days. Let me know if you need an extension...</div>
            </div>
          </div>
        </div>

        <!-- Right Pane - Email Content -->
        <div class="email-content" id="emailContent">
          <div class="email-content-header">
            <div class="email-header-actions-top">
              <div class="email-content-subject">Loan Documents Ready</div>
              <div class="email-moderation-btns">
                <button class="email-mod-btn spam" onclick="markAsSpam()" title="Mark as spam">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="12"></line>
                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                  </svg>
                  Spam
                </button>
                <button class="email-mod-btn block" onclick="blockSender()" title="Block sender">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>
                  </svg>
                  Block
                </button>
              </div>
            </div>
            <div class="email-content-meta">
              <div class="email-content-from">
                <div class="email-avatar">JD</div>
                <div class="email-sender-info">
                  <div class="email-sender-name">John Doe</div>
                  <div class="email-sender-email">john.doe@mortgagebank.com</div>
                </div>
              </div>
              <div class="email-content-date">Today at 2:45 PM</div>
            </div>
          </div>
          <div class="email-content-body">
            <div class="email-content-text">
              <p>Hi there,</p>
              <p>Great news! Your loan documents have been processed and are ready for your review.</p>
              <p>We've completed the following:</p>
              <ul style="margin-left: 1.5rem; margin-bottom: 0.75rem;">
                <li>Loan Application - Verified</li>
                <li>Credit Report - Approved</li>
                <li>Income Verification - Complete</li>
                <li>Bank Statements - Reviewed</li>
              </ul>
              <p>Please review the attached documents and let me know if you have any questions. We're on track for your closing date of November 15th.</p>
              <p>Next steps:</p>
              <ol style="margin-left: 1.5rem; margin-bottom: 0.75rem;">
                <li>Review all documents</li>
                <li>Sign where indicated</li>
                <li>Return signed documents within 3 business days</li>
              </ol>
              <p>If you need any clarification or have questions, please don't hesitate to reach out.</p>
              <p>Best regards,<br>
              John Doe<br>
              Senior Loan Officer<br>
              Direct: (555) 123-4567</p>
            </div>
          </div>
          <div class="email-content-actions">
            <button class="email-action-btn">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 10h10a8 8 0 0 1 8 8v2M3 10l6 6m-6-6l6-6"></path>
              </svg>
              Reply
            </button>
            <button class="email-action-btn">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10H11a8 8 0 0 0-8 8v2M21 10l-6 6m6-6l-6-6"></path>
              </svg>
              Forward
            </button>
            <button class="email-action-btn">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
              Delete
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- Email Composer Modal -->
  <div class="email-composer-overlay" id="emailComposer">
    <div class="email-composer">
      <!-- Header -->
      <div class="email-composer-header">
        <div class="email-composer-title">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
          </svg>
          New Email
        </div>
        <button class="email-composer-close" onclick="closeEmailComposer()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; display: inline;">
            <path d="M18 6L6 18M6 6l12 12"></path>
          </svg>
          Close
        </button>
      </div>

      <!-- Body -->
      <div class="email-composer-body">
        <!-- To Field -->
        <div class="composer-field">
          <label class="composer-field-label">To</label>
          <input type="email" class="composer-input" id="composerTo" placeholder="recipient@example.com" multiple>
        </div>

        <!-- CC/BCC Toggles -->
        <div class="cc-bcc-toggle">
          <button class="cc-bcc-btn" onclick="toggleCCField()">+ CC</button>
          <button class="cc-bcc-btn" onclick="toggleBCCField()">+ BCC</button>
        </div>

        <!-- CC Field (Hidden by default) -->
        <div class="composer-field" id="ccField" style="display: none;">
          <label class="composer-field-label">CC</label>
          <input type="email" class="composer-input" id="composerCC" placeholder="cc@example.com" multiple>
        </div>

        <!-- BCC Field (Hidden by default) -->
        <div class="composer-field" id="bccField" style="display: none;">
          <label class="composer-field-label">BCC</label>
          <input type="email" class="composer-input" id="composerBCC" placeholder="bcc@example.com" multiple>
        </div>

        <!-- Subject Field -->
        <div class="composer-field">
          <label class="composer-field-label">Subject</label>
          <input type="text" class="composer-input" id="composerSubject" placeholder="Email subject">
        </div>

        <!-- Formatting Toolbar -->
        <div class="composer-toolbar">
          <!-- Font Selection -->
          <div class="toolbar-group">
            <select class="toolbar-select" id="fontFamily" onchange="applyFontFamily(this.value)">
              <option value="Arial">Arial</option>
              <option value="Times New Roman">Times New Roman</option>
              <option value="Courier New">Courier New</option>
              <option value="Georgia">Georgia</option>
              <option value="Verdana">Verdana</option>
              <option value="Comic Sans MS">Comic Sans MS</option>
            </select>
            <select class="toolbar-select" id="fontSize" onchange="applyFontSize(this.value)" style="max-width: 80px;">
              <option value="12px">12</option>
              <option value="14px">14</option>
              <option value="16px" selected>16</option>
              <option value="18px">18</option>
              <option value="20px">20</option>
              <option value="24px">24</option>
            </select>
          </div>

          <!-- Text Formatting -->
          <div class="toolbar-group">
            <button class="toolbar-btn" onclick="formatText('bold')" title="Bold">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"></path>
                <path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"></path>
              </svg>
            </button>
            <button class="toolbar-btn" onclick="formatText('italic')" title="Italic">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="19" y1="4" x2="10" y2="4"></line>
                <line x1="14" y1="20" x2="5" y2="20"></line>
                <line x1="15" y1="4" x2="9" y2="20"></line>
              </svg>
            </button>
            <button class="toolbar-btn" onclick="formatText('underline')" title="Underline">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 3v7a6 6 0 0 0 6 6 6 6 0 0 0 6-6V3"></path>
                <line x1="4" y1="21" x2="20" y2="21"></line>
              </svg>
            </button>
          </div>

          <!-- Colors -->
          <div class="toolbar-group">
            <div class="color-picker-wrapper">
              <button class="toolbar-btn color-picker-btn" title="Text Color" onclick="document.getElementById('textColor').click()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M11 5h10M7 19h10M6 5l5.7 14M17 5l-5.7 14"></path>
                </svg>
              </button>
              <input type="color" id="textColor" class="color-picker-input" onchange="applyTextColor(this.value)">
            </div>
            <div class="color-picker-wrapper">
              <button class="toolbar-btn color-picker-btn" title="Highlight Color" onclick="document.getElementById('highlightColor').click()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M15 4l6 6-10 10H5v-6L15 4z"></path>
                </svg>
              </button>
              <input type="color" id="highlightColor" class="color-picker-input" onchange="applyHighlight(this.value)">
            </div>
          </div>

          <!-- Alignment -->
          <div class="toolbar-group">
            <button class="toolbar-btn" onclick="formatText('justifyLeft')" title="Align Left">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="17" y1="10" x2="3" y2="10"></line>
                <line x1="21" y1="6" x2="3" y2="6"></line>
                <line x1="21" y1="14" x2="3" y2="14"></line>
                <line x1="17" y1="18" x2="3" y2="18"></line>
              </svg>
            </button>
            <button class="toolbar-btn" onclick="formatText('justifyCenter')" title="Align Center">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="10" x2="6" y2="10"></line>
                <line x1="21" y1="6" x2="3" y2="6"></line>
                <line x1="21" y1="14" x2="3" y2="14"></line>
                <line x1="18" y1="18" x2="6" y2="18"></line>
              </svg>
            </button>
            <button class="toolbar-btn" onclick="formatText('justifyRight')" title="Align Right">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="21" y1="10" x2="7" y2="10"></line>
                <line x1="21" y1="6" x2="3" y2="6"></line>
                <line x1="21" y1="14" x2="3" y2="14"></line>
                <line x1="21" y1="18" x2="7" y2="18"></line>
              </svg>
            </button>
          </div>

          <!-- Lists -->
          <div class="toolbar-group">
            <button class="toolbar-btn" onclick="formatText('insertUnorderedList')" title="Bullet List">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="8" y1="6" x2="21" y2="6"></line>
                <line x1="8" y1="12" x2="21" y2="12"></line>
                <line x1="8" y1="18" x2="21" y2="18"></line>
                <line x1="3" y1="6" x2="3.01" y2="6"></line>
                <line x1="3" y1="12" x2="3.01" y2="12"></line>
                <line x1="3" y1="18" x2="3.01" y2="18"></line>
              </svg>
            </button>
            <button class="toolbar-btn" onclick="formatText('insertOrderedList')" title="Numbered List">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="10" y1="6" x2="21" y2="6"></line>
                <line x1="10" y1="12" x2="21" y2="12"></line>
                <line x1="10" y1="18" x2="21" y2="18"></line>
                <path d="M4 6h1v4"></path>
                <path d="M4 10h2"></path>
                <path d="M6 18H4c0-1 2-2 2-3s-1-1.5-2-1"></path>
              </svg>
            </button>
          </div>

          <!-- All Toolbar Buttons - Uniform Spacing -->
          <div class="toolbar-group">
            <button class="toolbar-btn" onclick="document.getElementById('fileAttach').click()" title="Attach File">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
              </svg>
            </button>
            <input type="file" id="fileAttach" style="display: none;" multiple onchange="handleFileAttach(this.files)">
            
            <button class="toolbar-btn" onclick="toggleVoiceRead()" title="Read Aloud">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 18v-6a9 9 0 0 1 18 0v6"></path>
                <path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path>
              </svg>
            </button>
            
            <button class="toolbar-btn toolbar-btn-emoji-fun" onclick="toggleEmojiPicker()" title="Add Emoji">
              <svg viewBox="0 0 24 24" fill="currentColor" stroke="none">
                <circle cx="12" cy="12" r="10" fill="#FFD93D"/>
                <circle cx="8" cy="9" r="1.5" fill="#2D3748"/>
                <circle cx="16" cy="9" r="1.5" fill="#2D3748"/>
                <path d="M7 14s1.5 3 5 3 5-3 5-3" stroke="#2D3748" stroke-width="2" stroke-linecap="round" fill="none"/>
              </svg>
            </button>
            
            <button class="toolbar-btn" onclick="insertMeetingLink()" title="Schedule Meeting" style="background: rgba(99, 102, 241, 0.15); border: 1px solid rgba(99, 102, 241, 0.3);">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
              <span class="toolbar-btn-label">Schedule</span>
            </button>
            
            <button class="toolbar-btn toolbar-btn-voice-modern" id="voiceToTextBtn" onclick="toggleVoiceToText()" title="Voice to Text">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                <line x1="12" y1="19" x2="12" y2="23"></line>
                <line x1="8" y1="23" x2="16" y2="23"></line>
              </svg>
              <span class="toolbar-btn-label">Voice</span>
            </button>
            
            <button class="toolbar-btn toolbar-btn-gpt-sparkle" onclick="openGPTReview()" title="AI Review with GPT">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2l2.5 6.5L21 11l-6.5 2.5L12 20l-2.5-6.5L3 11l6.5-2.5z" fill="currentColor" opacity="0.3"/>
                <circle cx="12" cy="12" r="3" fill="currentColor"/>
                <path d="M12 2v4M12 18v4M2 12h4M18 12h4" stroke-linecap="round"/>
              </svg>
              <span class="toolbar-btn-label">AI Review</span>
            </button>
          </div>
        </div>

        <!-- Emoji Picker -->
        <div class="emoji-picker" id="emojiPicker">
          <span class="emoji-item" onclick="insertEmoji('')"></span>
          <span class="emoji-item" onclick="insertEmoji('')"></span>
          <span class="emoji-item" onclick="insertEmoji('')"></span>
          <span class="emoji-item" onclick="insertEmoji('')"></span>
          <span class="emoji-item" onclick="insertEmoji('')"></span>
          <span class="emoji-item" onclick="insertEmoji('')"></span>
          <span class="emoji-item" onclick="insertEmoji('')"></span>
          <span class="emoji-item" onclick="insertEmoji('')"></span>
          <span class="emoji-item" onclick="insertEmoji('')"></span>
          <span class="emoji-item" onclick="insertEmoji('')"></span>
          <span class="emoji-item" onclick="insertEmoji('')"></span>
          <span class="emoji-item" onclick="insertEmoji('')"></span>
        </div>

        <!-- Editor -->
        <div class="composer-editor" id="composerEditor" contenteditable="true"></div>

        <!-- Attachments -->
        <div class="composer-attachments" id="composerAttachments"></div>
      </div>

      <!-- Footer -->
      <div class="email-composer-footer">
        <div class="voice-recording" id="voiceRecording">
          <div class="voice-pulse"></div>
          Reading aloud...
        </div>
        <div class="composer-actions">
          
          <button class="composer-btn composer-btn-primary composer-btn-fullwidth" onclick="sendEmail()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="22" y1="2" x2="11" y2="13"></line>
              <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
            Send Email
          </button>
        </div>
      </div>
    </div>
  </div>


  <!-- GPT Review Modal -->
  <div class="gpt-modal-overlay" id="gptModal">
    <div class="gpt-modal">
      <div class="gpt-modal-header">
        <div class="gpt-modal-title">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          </svg>
          GPT Review
        </div>
        <button class="email-composer-close" onclick="closeGPTModal()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
            <path d="M18 6L6 18M6 6l12 12"></path>
          </svg>
          Close
        </button>
      </div>
      <div class="gpt-modal-body" id="gptModalBody">
        <div class="gpt-loading" id="gptLoading">
          <div class="gpt-loading-spinner"></div>
          <span>Analyzing your email with GPT...</span>
        </div>
        <div id="gptResults" style="display: none;">
          <div class="gpt-preview" id="gptPreview"></div>
          <div class="gpt-suggestions">
            <div class="gpt-suggestions-title">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
              </svg>
              AI Suggestions
            </div>
            <div id="gptSuggestionsList"></div>
          </div>
        </div>
      </div>
      <div class="gpt-modal-footer">
        <button class="gpt-btn gpt-btn-secondary" onclick="closeGPTModal()">Close</button>
        <button class="gpt-btn gpt-btn-primary" onclick="applyGPTSuggestions()">Apply Suggestions</button>
      </div>
    </div>
  </div>


  <!-- Email Signature Manager Modal -->
  <div class="signature-modal-overlay" id="signatureModal">
    <div class="signature-modal">
      <!-- Header -->
      <div class="signature-modal-header">
        <div class="signature-modal-title">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 3a2.83 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
          </svg>
          Email Signatures
        </div>
        <button class="email-composer-close" onclick="closeSignatureManager()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
            <path d="M18 6L6 18M6 6l12 12"></path>
          </svg>
          Close
        </button>
      </div>

      <!-- Bento Grid -->
      <div class="signature-bento">
        <!-- Left Panel - Templates -->
        <div class="signature-templates-panel">
          <div class="signature-panel-title">Templates</div>
          
          <button class="signature-new-btn" onclick="createNewSignature()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            New Template
          </button>

          <div id="signatureTemplatesList">
            <!-- Templates will be rendered here -->
            <div class="signature-template-card active" onclick="selectTemplate('default')">
              <div class="signature-template-name">
                Default
                <span class="signature-template-default"></span>
              </div>
              <div class="signature-template-info">All emails  Last edited today</div>
            </div>

            <div class="signature-template-card" onclick="selectTemplate('professional')">
              <div class="signature-template-name">Professional</div>
              <div class="signature-template-info">New emails  Created 2 days ago</div>
            </div>

            <div class="signature-template-card" onclick="selectTemplate('minimal')">
              <div class="signature-template-name">Minimal</div>
              <div class="signature-template-info">Replies  Created 1 week ago</div>
            </div>
          </div>

          <!-- Field Reorder Section -->
          <div class="field-reorder-section">
            <div class="signature-panel-title">Info Display</div>
            
            <div class="field-reorder-list" id="fieldReorderList">
              <!-- Reorderable fields -->
              <div class="field-reorder-item" draggable="true" data-field="photo">
                <div class="field-drag-handle">
                  <svg viewBox="0 0 24 24" fill="currentColor">
                    <circle cx="9" cy="5" r="1"></circle>
                    <circle cx="9" cy="12" r="1"></circle>
                    <circle cx="9" cy="19" r="1"></circle>
                    <circle cx="15" cy="5" r="1"></circle>
                    <circle cx="15" cy="12" r="1"></circle>
                    <circle cx="15" cy="19" r="1"></circle>
                  </svg>
                </div>
                <span class="field-reorder-name">Photo</span>
                <div class="field-visibility-toggle visible" onclick="toggleFieldVisibility(event, 'photo')">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                </div>
              </div>

              <div class="field-reorder-item" draggable="true" data-field="logo">
                <div class="field-drag-handle">
                  <svg viewBox="0 0 24 24" fill="currentColor">
                    <circle cx="9" cy="5" r="1"></circle>
                    <circle cx="9" cy="12" r="1"></circle>
                    <circle cx="9" cy="19" r="1"></circle>
                    <circle cx="15" cy="5" r="1"></circle>
                    <circle cx="15" cy="12" r="1"></circle>
                    <circle cx="15" cy="19" r="1"></circle>
                  </svg>
                </div>
                <span class="field-reorder-name">Logo</span>
                <div class="field-visibility-toggle visible" onclick="toggleFieldVisibility(event, 'logo')">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                </div>
              </div>

              <div class="field-reorder-item" draggable="true" data-field="name">
                <div class="field-drag-handle">
                  <svg viewBox="0 0 24 24" fill="currentColor">
                    <circle cx="9" cy="5" r="1"></circle>
                    <circle cx="9" cy="12" r="1"></circle>
                    <circle cx="9" cy="19" r="1"></circle>
                    <circle cx="15" cy="5" r="1"></circle>
                    <circle cx="15" cy="12" r="1"></circle>
                    <circle cx="15" cy="19" r="1"></circle>
                  </svg>
                </div>
                <span class="field-reorder-name">Name</span>
                <div class="field-visibility-toggle visible" onclick="toggleFieldVisibility(event, 'name')">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                </div>
              </div>

              <div class="field-reorder-item" draggable="true" data-field="title">
                <div class="field-drag-handle">
                  <svg viewBox="0 0 24 24" fill="currentColor">
                    <circle cx="9" cy="5" r="1"></circle>
                    <circle cx="9" cy="12" r="1"></circle>
                    <circle cx="9" cy="19" r="1"></circle>
                    <circle cx="15" cy="5" r="1"></circle>
                    <circle cx="15" cy="12" r="1"></circle>
                    <circle cx="15" cy="19" r="1"></circle>
                  </svg>
                </div>
                <span class="field-reorder-name">Job Title</span>
                <div class="field-visibility-toggle visible" onclick="toggleFieldVisibility(event, 'title')">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                </div>
              </div>

              <div class="field-reorder-item" draggable="true" data-field="nmls">
                <div class="field-drag-handle">
                  <svg viewBox="0 0 24 24" fill="currentColor">
                    <circle cx="9" cy="5" r="1"></circle>
                    <circle cx="9" cy="12" r="1"></circle>
                    <circle cx="9" cy="19" r="1"></circle>
                    <circle cx="15" cy="5" r="1"></circle>
                    <circle cx="15" cy="12" r="1"></circle>
                    <circle cx="15" cy="19" r="1"></circle>
                  </svg>
                </div>
                <span class="field-reorder-name">NMLS #</span>
                <div class="field-visibility-toggle visible" onclick="toggleFieldVisibility(event, 'nmls')">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                </div>
              </div>

              <div class="field-reorder-item" draggable="true" data-field="company">
                <div class="field-drag-handle">
                  <svg viewBox="0 0 24 24" fill="currentColor">
                    <circle cx="9" cy="5" r="1"></circle>
                    <circle cx="9" cy="12" r="1"></circle>
                    <circle cx="9" cy="19" r="1"></circle>
                    <circle cx="15" cy="5" r="1"></circle>
                    <circle cx="15" cy="12" r="1"></circle>
                    <circle cx="15" cy="19" r="1"></circle>
                  </svg>
                </div>
                <span class="field-reorder-name">Company</span>
                <div class="field-visibility-toggle visible" onclick="toggleFieldVisibility(event, 'company')">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                </div>
              </div>

              <div class="field-reorder-item" draggable="true" data-field="email">
                <div class="field-drag-handle">
                  <svg viewBox="0 0 24 24" fill="currentColor">
                    <circle cx="9" cy="5" r="1"></circle>
                    <circle cx="9" cy="12" r="1"></circle>
                    <circle cx="9" cy="19" r="1"></circle>
                    <circle cx="15" cy="5" r="1"></circle>
                    <circle cx="15" cy="12" r="1"></circle>
                    <circle cx="15" cy="19" r="1"></circle>
                  </svg>
                </div>
                <span class="field-reorder-name">Email</span>
                <div class="field-visibility-toggle visible" onclick="toggleFieldVisibility(event, 'email')">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                </div>
              </div>

              <div class="field-reorder-item" draggable="true" data-field="phone">
                <div class="field-drag-handle">
                  <svg viewBox="0 0 24 24" fill="currentColor">
                    <circle cx="9" cy="5" r="1"></circle>
                    <circle cx="9" cy="12" r="1"></circle>
                    <circle cx="9" cy="19" r="1"></circle>
                    <circle cx="15" cy="5" r="1"></circle>
                    <circle cx="15" cy="12" r="1"></circle>
                    <circle cx="15" cy="19" r="1"></circle>
                  </svg>
                </div>
                <span class="field-reorder-name">Phone</span>
                <div class="field-visibility-toggle visible" onclick="toggleFieldVisibility(event, 'phone')">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                </div>
              </div>

              <div class="field-reorder-item" draggable="true" data-field="website">
                <div class="field-drag-handle">
                  <svg viewBox="0 0 24 24" fill="currentColor">
                    <circle cx="9" cy="5" r="1"></circle>
                    <circle cx="9" cy="12" r="1"></circle>
                    <circle cx="9" cy="19" r="1"></circle>
                    <circle cx="15" cy="5" r="1"></circle>
                    <circle cx="15" cy="12" r="1"></circle>
                    <circle cx="15" cy="19" r="1"></circle>
                  </svg>
                </div>
                <span class="field-reorder-name">Website</span>
                <div class="field-visibility-toggle visible" onclick="toggleFieldVisibility(event, 'website')">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                </div>
              </div>
            </div>

            <div class="field-reorder-hint">Drag to reorder  Click eye to show/hide</div>
          </div>
        </div>

        <!-- Right Panel - Editor & Preview -->
        <div class="signature-editor-panel">
          <!-- Live Preview -->
          <div class="signature-preview-section">
            <div class="signature-preview-title">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 18px; height: 18px;">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
              Live Preview
            </div>
            <div class="signature-preview-content" id="signaturePreview">
              <!-- Preview will render here -->
              <div style="font-family: Arial, sans-serif; color: #1e293b;">
                <strong style="font-size: 16px;">John Smith</strong><br>
                <span style="font-size: 14px; color: #64748b;">Senior Developer</span>
              </div>
            </div>
          </div>

          <!-- Editor Form -->
          <div class="signature-editor-form">
            <!-- Basic Info -->
            <div class="signature-form-section">
              <div class="signature-section-title">Basic Information</div>
              
              <div class="signature-form-row">
                <div class="signature-form-group">
                  <label class="signature-form-label">First Name</label>
                  <input type="text" class="signature-form-input" id="sigFirstName" placeholder="John" oninput="updateSignaturePreview()">
                </div>
                <div class="signature-form-group">
                  <label class="signature-form-label">Last Name</label>
                  <input type="text" class="signature-form-input" id="sigLastName" placeholder="Smith" oninput="updateSignaturePreview()">
                </div>
              </div>

              <div class="signature-form-row">
                <div class="signature-form-group">
                  <label class="signature-form-label">Job Title</label>
                  <input type="text" class="signature-form-input" id="sigTitle" placeholder="Senior Loan Officer" oninput="updateSignaturePreview()">
                </div>
                <div class="signature-form-group">
                  <label class="signature-form-label">NMLS #</label>
                  <input type="text" class="signature-form-input" id="sigNMLS" placeholder="123456" oninput="updateSignaturePreview()">
                </div>
              </div>

              <div class="signature-form-group">
                <label class="signature-form-label">Company Name</label>
                <input type="text" class="signature-form-input" id="sigCompany" placeholder="Acme Corporation" oninput="updateSignaturePreview()">
              </div>
            </div>

            <!-- Contact Info -->
            <div class="signature-form-section">
              <div class="signature-section-title">Contact Information</div>
              
              <div class="signature-form-group">
                <label class="signature-form-label">Email</label>
                <div style="display: flex; gap: 0.5rem; align-items: center;">
                  <select class="signature-form-input" id="emailIcon" onchange="updateSignaturePreview()" style="width: 100px;">
                    <option value=""></option>
                    <option value="">No icon</option>
                    <option value=""></option>
                    <option value=""></option>
                  </select>
                  <input type="email" class="signature-form-input" id="sigEmail" placeholder="john@company.com" oninput="updateSignaturePreview()" style="flex: 1;">
                </div>
              </div>

              <div class="signature-form-group">
                <label class="signature-form-label">Phone</label>
                <div style="display: flex; gap: 0.5rem; align-items: center;">
                  <select class="signature-form-input" id="phoneIcon" onchange="updateSignaturePreview()" style="width: 100px;">
                    <option value=""></option>
                    <option value="">No icon</option>
                    <option value=""></option>
                    <option value=""></option>
                  </select>
                  <input type="tel" class="signature-form-input" id="sigPhone" placeholder="+1 (555) 123-4567" oninput="updateSignaturePreview()" style="flex: 1;">
                </div>
              </div>

              <div class="signature-form-group">
                <label class="signature-form-label">Website</label>
                <div style="display: flex; gap: 0.5rem; align-items: center;">
                  <select class="signature-form-input" id="websiteIcon" onchange="updateSignaturePreview()" style="width: 100px;">
                    <option value=""></option>
                    <option value="">No icon</option>
                    <option value=""></option>
                    <option value=""></option>
                  </select>
                  <input type="url" class="signature-form-input" id="sigWebsite" placeholder="www.company.com" oninput="updateSignaturePreview()" style="flex: 1;">
                </div>
              </div>
            </div>

            <!-- Text Formatting -->
            <div class="signature-form-section">
              <div class="signature-section-title">Text Formatting</div>
              
              <div class="signature-form-group">
                <label class="signature-form-label">Apply Formatting To</label>
                <select class="signature-form-input" id="formatField" onchange="loadFieldFormatting()">
                  <option value="firstName">First Name</option>
                  <option value="lastName">Last Name</option>
                  <option value="title">Job Title</option>
                  <option value="nmls">NMLS #</option>
                  <option value="company">Company Name</option>
                  <option value="email">Email</option>
                  <option value="phone">Phone</option>
                  <option value="website">Website</option>
                </select>
              </div>

              <div class="signature-form-row">
                <div class="signature-form-group">
                  <label class="signature-form-label">Font Family</label>
                  <select class="signature-form-input" id="sigFont" onchange="applyFieldFormatting()">
                    <option value="Arial, sans-serif">Arial</option>
                    <option value="Helvetica, sans-serif">Helvetica</option>
                    <option value="Georgia, serif">Georgia</option>
                    <option value="Times New Roman, serif">Times New Roman</option>
                    <option value="Courier New, monospace">Courier New</option>
                    <option value="Verdana, sans-serif">Verdana</option>
                    <option value="Tahoma, sans-serif">Tahoma</option>
                  </select>
                </div>
                <div class="signature-form-group">
                  <label class="signature-form-label">Font Size</label>
                  <select class="signature-form-input" id="sigFontSize" onchange="applyFieldFormatting()">
                    <option value="12">12px</option>
                    <option value="13">13px</option>
                    <option value="14" selected>14px</option>
                    <option value="15">15px</option>
                    <option value="16">16px</option>
                    <option value="18">18px</option>
                    <option value="20">20px</option>
                  </select>
                </div>
              </div>

              <div class="signature-form-group">
                <label class="signature-form-label">Text Color</label>
                <div class="signature-color-picker-wrapper">
                  <div class="signature-color-swatch" id="textColorSwatch" style="background: #1e293b;" onclick="document.getElementById('sigTextColor').click()"></div>
                  <input type="color" id="sigTextColor" class="signature-color-input" value="#1e293b" oninput="updateFieldTextColor(this.value)">
                  <span style="color: #94a3b8; font-size: 0.8125rem;">Choose text color</span>
                </div>
              </div>

              <div class="signature-form-group">
                <label class="signature-form-label">Text Style</label>
                <div class="signature-settings-grid" style="grid-template-columns: repeat(4, 1fr);">
                  <div class="signature-checkbox-card" id="boldBtn" onclick="toggleFieldTextStyle(this, 'bold')">
                    <div class="signature-checkbox">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                        <polyline points="20 6 9 17 4 12"></polyline>
                      </svg>
                    </div>
                    <span class="signature-checkbox-label"><strong>B</strong></span>
                  </div>

                  <div class="signature-checkbox-card" id="italicBtn" onclick="toggleFieldTextStyle(this, 'italic')">
                    <div class="signature-checkbox">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                        <polyline points="20 6 9 17 4 12"></polyline>
                      </svg>
                    </div>
                    <span class="signature-checkbox-label"><em>I</em></span>
                  </div>

                  <div class="signature-checkbox-card" id="underlineBtn" onclick="toggleFieldTextStyle(this, 'underline')">
                    <div class="signature-checkbox">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                        <polyline points="20 6 9 17 4 12"></polyline>
                      </svg>
                    </div>
                    <span class="signature-checkbox-label"><u>U</u></span>
                  </div>

                  <div class="signature-checkbox-card" id="highlightBtn" onclick="toggleFieldTextStyle(this, 'highlight')">
                    <div class="signature-checkbox">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                        <polyline points="20 6 9 17 4 12"></polyline>
                      </svg>
                    </div>
                    <span class="signature-checkbox-label">H</span>
                  </div>
                </div>
              </div>

              <div class="signature-form-group" id="highlightColorGroup" style="display: none;">
                <label class="signature-form-label">Highlight Color</label>
                <div class="signature-color-picker-wrapper">
                  <div class="signature-color-swatch" id="highlightColorSwatch" style="background: #fef08a;" onclick="document.getElementById('sigHighlightColor').click()"></div>
                  <input type="color" id="sigHighlightColor" class="signature-color-input" value="#fef08a" oninput="updateFieldHighlightColor(this.value)">
                  <span style="color: #94a3b8; font-size: 0.8125rem;">Choose highlight color</span>
                </div>
              </div>
            </div>

            <!-- Visual Elements -->
            <div class="signature-form-section">
              <div class="signature-section-title">Visual Elements</div>
              
              <div class="signature-form-group">
                <label class="signature-form-label">Photo</label>
                <div style="display: flex; gap: 0.5rem;">
                  <div class="signature-upload-btn" onclick="document.getElementById('sigPhoto').click()" style="flex: 1; margin: 0;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                      <circle cx="8.5" cy="8.5" r="1.5"></circle>
                      <polyline points="21 15 16 10 5 21"></polyline>
                    </svg>
                    <span id="photoUploadText">Upload Photo</span>
                    <input type="file" id="sigPhoto" style="display: none;" accept="image/*">
                  </div>
                  <button class="signature-btn signature-btn-secondary" onclick="removePhoto()" id="removePhotoBtn" style="display: none; padding: 0.75rem;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                  </button>
                </div>
              </div>

              <div class="signature-form-group">
                <label class="signature-form-label">Logo</label>
                <div style="display: flex; gap: 0.5rem;">
                  <div class="signature-upload-btn" onclick="document.getElementById('sigLogo').click()" style="flex: 1; margin: 0;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                      <polyline points="14 2 14 8 20 8"></polyline>
                    </svg>
                    <span id="logoUploadText">Upload Logo</span>
                    <input type="file" id="sigLogo" style="display: none;" accept="image/*">
                  </div>
                  <button class="signature-btn signature-btn-secondary" onclick="removeLogo()" id="removeLogoBtn" style="display: none; padding: 0.75rem;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                  </button>
                </div>
              </div>

              <div class="signature-form-group">
                <label class="signature-form-label">Accent Color</label>
                <div class="signature-color-picker-wrapper">
                  <div class="signature-color-swatch" style="background: #6366f1;" onclick="document.getElementById('sigColor').click()"></div>
                  <input type="color" id="sigColor" class="signature-color-input" value="#6366f1" oninput="updateAccentColor(this.value)">
                  <span style="color: #94a3b8; font-size: 0.8125rem;">Choose your brand color</span>
                </div>
              </div>
            </div>

            <!-- Meeting Scheduler & CTA -->
            <div class="signature-form-section" style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid rgba(168, 85, 247, 0.3);">
              <div class="signature-section-title">Meeting Scheduler & CTA</div>
              
              <div class="signature-form-group">
                <label class="signature-form-label">Scheduler Type</label>
                <select class="signature-form-input" id="schedulerType" onchange="updateSchedulerFields()">
                  <option value="none">None - Custom CTA</option>
                  <option value="calendly">Calendly</option>
                  <option value="cal">Cal.com</option>
                  <option value="microsoft">Microsoft Bookings</option>
                  <option value="custom">Custom Scheduler</option>
                </select>
              </div>

              <div id="schedulerFields" style="display: none;">
                <div class="signature-form-group">
                  <label class="signature-form-label">Your Scheduler Username</label>
                  <input type="text" class="signature-form-input" id="schedulerUsername" placeholder="yourname" oninput="updateSchedulerUrl()">
                  <div style="font-size: 0.75rem; color: #94a3b8; margin-top: 0.25rem;">
                    <span id="schedulerUrlPreview">Enter username to see full URL</span>
                  </div>
                </div>

                <div class="signature-form-group">
                  <label class="signature-form-label">Button Text</label>
                  <select class="signature-form-input" id="schedulerButtonText" onchange="updateCtaText()">
                    <option value="Schedule a Meeting">Schedule a Meeting</option>
                    <option value="Book a Call">Book a Call</option>
                    <option value="Book Time with Me">Book Time with Me</option>
                    <option value="Let's Connect">Let's Connect</option>
                    <option value="Schedule a Call">Schedule a Call</option>
                    <option value="custom">Custom Text...</option>
                  </select>
                </div>

                <div class="signature-form-group" id="customTextGroup" style="display: none;">
                  <label class="signature-form-label">Custom Button Text</label>
                  <input type="text" class="signature-form-input" id="customCtaText" placeholder="Custom text" oninput="updateCustomCtaText()">
                </div>

                <div class="signature-form-group">
                  <label class="signature-form-label">Badge Style</label>
                  <div class="signature-settings-grid" style="grid-template-columns: repeat(3, 1fr);">
                    <div class="signature-checkbox-card active" onclick="selectBadgeStyle(this, 'button')">
                      <div class="signature-checkbox">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                          <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                      </div>
                      <span class="signature-checkbox-label">Button</span>
                    </div>

                    <div class="signature-checkbox-card" onclick="selectBadgeStyle(this, 'badge')">
                      <div class="signature-checkbox">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                          <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                      </div>
                      <span class="signature-checkbox-label">Badge</span>
                    </div>

                    <div class="signature-checkbox-card" onclick="selectBadgeStyle(this, 'link')">
                      <div class="signature-checkbox">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                          <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                      </div>
                      <span class="signature-checkbox-label">Link</span>
                    </div>
                  </div>
                </div>
              </div>

              <div id="customCtaFields">
                <div class="signature-cta-builder">
                  <div class="signature-form-group" style="margin: 0;">
                    <label class="signature-form-label">Button Text</label>
                    <input type="text" class="signature-form-input" id="sigCtaText" placeholder="Book a Meeting" oninput="updateSignaturePreview()">
                  </div>
                  <div class="signature-form-group" style="margin: 0;">
                    <label class="signature-form-label">Button URL</label>
                    <input type="url" class="signature-form-input" id="sigCtaUrl" placeholder="https://your-link.com" oninput="updateSignaturePreview()">
                  </div>
                </div>
              </div>

              <div class="signature-cta-preview" id="ctaPreview" style="display: none;">
                <div style="margin-bottom: 0.5rem; font-size: 0.75rem; color: #94a3b8;">Preview:</div>
                <div id="ctaButtonContainer"></div>
              </div>
            </div>

            <!-- Auto-Apply Settings -->
            <div class="signature-form-section">
              <div class="signature-section-title">Auto-Apply Settings</div>
              
              <div class="signature-settings-grid">
                <div class="signature-checkbox-card active" onclick="toggleSetting(this, 'all')">
                  <div class="signature-checkbox">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                      <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                  </div>
                  <span class="signature-checkbox-label">All Emails</span>
                </div>

                <div class="signature-checkbox-card" onclick="toggleSetting(this, 'new')">
                  <div class="signature-checkbox">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                      <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                  </div>
                  <span class="signature-checkbox-label">New Only</span>
                </div>

                <div class="signature-checkbox-card" onclick="toggleSetting(this, 'reply')">
                  <div class="signature-checkbox">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                      <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                  </div>
                  <span class="signature-checkbox-label">Replies Only</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="signature-modal-footer">
        <div class="signature-footer-left">
          <button class="signature-btn signature-btn-danger" onclick="deleteSignature()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
            Delete
          </button>
          <button class="signature-btn signature-btn-secondary" onclick="duplicateSignature()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
            Duplicate
          </button>
        </div>
        <div class="signature-footer-right">
          <button class="signature-btn signature-btn-secondary" onclick="closeSignatureManager()">
            Cancel
          </button>
          <button class="signature-btn signature-btn-primary" onclick="saveSignature()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
              <polyline points="17 21 17 13 7 13 7 21"></polyline>
              <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
            Save Signature
          </button>
        </div>
      </div>
    </div>
  </div>




</body>


  <script>
// ==========================================
// MAIN APPLICATION FUNCTIONS
// ==========================================

/* 
    ==========================================
    MICROSOFT GRAPH API INTEGRATION - SPAM/BLOCK FEATURES
    ==========================================
    
    TO ENABLE SPAM & BLOCK WITH OUTLOOK API:
    
    1. Uncomment production code in markAsSpam() and blockSender() functions
    2. Remove demo alert() calls
    3. Update email click handler to call: setCurrentEmail(emailId, senderEmail, senderName)
    4. Add data-email-id attributes to email items
    5. Required Azure AD permissions: Mail.ReadWrite, MailboxSettings.ReadWrite
    
    API Endpoints: POST /me/messages/{id}/move, POST /me/mailFolders/inbox/messageRules
    */

    // Set current date
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    const today = new Date().toLocaleDateString('en-US', options);
    document.getElementById('currentDate').textContent = today;
    document.getElementById('currentDate2').textContent = today;
    document.getElementById('currentDate3').textContent = today;

    // File input handler
    document.getElementById('fileInput').addEventListener('change', function(e) {
      const fileName = e.target.files[0]?.name || '';
      document.getElementById('fileName').textContent = fileName ? ' ' + fileName : '';
    });

    // Document colors for stacking
    const documentColors = [
      { name: 'blue', gradient: 'linear-gradient(to bottom, #3b82f6, #2563eb)', color: '#3b82f6', shadow: 'rgba(59, 130, 246, 0.5)' },
      { name: 'purple', gradient: 'linear-gradient(to bottom, #8b5cf6, #7c3aed)', color: '#8b5cf6', shadow: 'rgba(168, 85, 247, 0.5)' },
      { name: 'emerald', gradient: 'linear-gradient(to bottom, #10b981, #059669)', color: '#10b981', shadow: 'rgba(16, 185, 129, 0.5)' },
      { name: 'amber', gradient: 'linear-gradient(to bottom, #f59e0b, #d97706)', color: '#f59e0b', shadow: 'rgba(245, 158, 11, 0.5)' },
      { name: 'rose', gradient: 'linear-gradient(to bottom, #f43f5e, #e11d48)', color: '#f43f5e', shadow: 'rgba(244, 63, 94, 0.5)' },
      { name: 'cyan', gradient: 'linear-gradient(to bottom, #06b6d4, #0891b2)', color: '#06b6d4', shadow: 'rgba(6, 182, 212, 0.5)' },
      { name: 'orange', gradient: 'linear-gradient(to bottom, #fb923c, #f97316)', color: '#fb923c', shadow: 'rgba(251, 146, 60, 0.5)' },
      { name: 'pink', gradient: 'linear-gradient(to bottom, #ec4899, #db2777)', color: '#ec4899', shadow: 'rgba(236, 72, 153, 0.5)' },
      { name: 'lime', gradient: 'linear-gradient(to bottom, #84cc16, #65a30d)', color: '#84cc16', shadow: 'rgba(132, 204, 22, 0.5)' },
      { name: 'indigo', gradient: 'linear-gradient(to bottom, #6366f1, #4f46e5)', color: '#6366f1', shadow: 'rgba(99, 102, 241, 0.5)' }
    ];

    let documents = [
      { 
        name: 'Pay Stubs', 
        subtitle: 'Requested By: Perry Paul', 
        colorIndex: 0,
        status: 'pending',
        tableData: [
          { requestDate: '10/15/2025', documentRequested: 'Pay Stub Oct 2025', loanCategory: 'Income', loanPurpose: 'Purchase', loanStage: 'Pre-Approval', requestedBy: 'Perry Paul', clearedBy: 'Sarah Johnson', attachedDoc: 'paystub_oct.pdf' },
          { requestDate: '10/01/2025', documentRequested: 'Pay Stub Sep 2025', loanCategory: 'Income', loanPurpose: 'Purchase', loanStage: 'Pre-Approval', requestedBy: 'Perry Paul', clearedBy: '-', attachedDoc: '-' },
          { requestDate: '09/15/2025', documentRequested: 'Pay Stub Aug 2025', loanCategory: 'Income', loanPurpose: 'Purchase', loanStage: 'Pre-Approval', requestedBy: 'Perry Paul', clearedBy: 'Sarah Johnson', attachedDoc: 'paystub_aug.pdf' },
          { requestDate: '09/01/2025', documentRequested: 'Pay Stub Jul 2025', loanCategory: 'Income', loanPurpose: 'Purchase', loanStage: 'Pre-Approval', requestedBy: 'Perry Paul', clearedBy: 'Sarah Johnson', attachedDoc: 'paystub_jul.pdf' },
          { requestDate: '08/15/2025', documentRequested: 'Pay Stub Jun 2025', loanCategory: 'Income', loanPurpose: 'Purchase', loanStage: 'Pre-Approval', requestedBy: 'Perry Paul', clearedBy: '-', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Income Verification', 
        subtitle: 'Requested By: Perry Paul',
        colorIndex: 1,
        status: 'pending',
        tableData: [
          { requestDate: '10/16/2025', documentRequested: 'W2 Form 2024', loanCategory: 'Income', loanPurpose: 'Purchase', loanStage: 'Initial Approval', requestedBy: 'Perry Paul', clearedBy: 'Michael Chen', attachedDoc: 'w2_2024.pdf' },
          { requestDate: '10/16/2025', documentRequested: 'Employment Letter', loanCategory: 'Income', loanPurpose: 'Purchase', loanStage: 'Initial Approval', requestedBy: 'Perry Paul', clearedBy: '-', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Ins. Replace Cost', 
        subtitle: 'Requested By: Perry Paul', 
        colorIndex: 2,
        status: 'pending',
        tableData: [
          { requestDate: '10/17/2025', documentRequested: 'Home Insurance Quote', loanCategory: 'Insurance', loanPurpose: 'Purchase', loanStage: 'Final Approval', requestedBy: 'Perry Paul', clearedBy: 'Emily Davis', attachedDoc: 'insurance_quote.pdf' }
        ]
      },
      { 
        name: 'Bank Statements', 
        subtitle: 'Requested By: Perry Paul', 
        colorIndex: 3,
        status: 'pending',
        tableData: [
          { requestDate: '10/18/2025', documentRequested: 'Bank Statement Oct 2025', loanCategory: 'Assets', loanPurpose: 'Purchase', loanStage: 'Pre-Approval', requestedBy: 'Perry Paul', clearedBy: '-', attachedDoc: '-' },
          { requestDate: '10/18/2025', documentRequested: 'Bank Statement Sep 2025', loanCategory: 'Assets', loanPurpose: 'Purchase', loanStage: 'Pre-Approval', requestedBy: 'Perry Paul', clearedBy: 'Sarah Johnson', attachedDoc: 'bank_sep.pdf' }
        ]
      },
      { 
        name: 'Tax Returns', 
        subtitle: 'Requested By: Perry Paul', 
        colorIndex: 4,
        status: 'cleared',
        tableData: [
          { requestDate: '10/19/2025', documentRequested: '2024 Tax Return', loanCategory: 'Income', loanPurpose: 'Purchase', loanStage: 'Initial Approval', requestedBy: 'Perry Paul', clearedBy: 'Michael Chen', attachedDoc: 'tax_2024.pdf' },
          { requestDate: '10/19/2025', documentRequested: '2023 Tax Return', loanCategory: 'Income', loanPurpose: 'Purchase', loanStage: 'Initial Approval', requestedBy: 'Perry Paul', clearedBy: 'Michael Chen', attachedDoc: 'tax_2023.pdf' }
        ]
      },
      { 
        name: 'Purchase Agreement', 
        subtitle: 'Requested By: Perry Paul', 
        colorIndex: 5,
        status: 'cleared',
        tableData: [
          { requestDate: '10/20/2025', documentRequested: 'Signed Purchase Contract', loanCategory: 'Property', loanPurpose: 'Purchase', loanStage: 'Initial Approval', requestedBy: 'Perry Paul', clearedBy: 'Emily Davis', attachedDoc: 'purchase_agreement.pdf' }
        ]
      },
      { 
        name: 'Home Insurance', 
        subtitle: 'Requested By: Perry Paul', 
        colorIndex: 6,
        status: 'cleared',
        tableData: [
          { requestDate: '10/21/2025', documentRequested: 'Insurance Binder', loanCategory: 'Insurance', loanPurpose: 'Purchase', loanStage: 'Final Approval', requestedBy: 'Perry Paul', clearedBy: '-', attachedDoc: '-' }
        ]
      }
    ];

    let services = [
      { 
        name: 'Appraisal', 
        subtitle: 'Requested By: Perry Paul', 
        colorIndex: 0, 
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Property Appraisal', loanCategory: 'Appraisal', loanPurpose: 'Purchase', loanStage: 'Initial Approval', requestedBy: 'Perry Paul', clearedBy: 'Tom Anderson', attachedDoc: 'appraisal_report.pdf' },
          { requestDate: '09/28/2025', documentRequested: 'Appraisal Review', loanCategory: 'Appraisal', loanPurpose: 'Purchase', loanStage: 'Initial Approval', requestedBy: 'Perry Paul', clearedBy: '-', attachedDoc: '-' }
        ]
      },
      { 
        name: 'WDO Inspection', 
        subtitle: 'Requested By: Perry Paul', 
        colorIndex: 1, 
        tableData: [
          { requestDate: '10/12/2025', documentRequested: 'Termite Inspection', loanCategory: 'Inspection', loanPurpose: 'Purchase', loanStage: 'Final Approval', requestedBy: 'Perry Paul', clearedBy: 'Lisa Brown', attachedDoc: 'wdo_report.pdf' },
          { requestDate: '10/12/2025', documentRequested: 'WDO Certification', loanCategory: 'Inspection', loanPurpose: 'Purchase', loanStage: 'Final Approval', requestedBy: 'Perry Paul', clearedBy: '-', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Water Test Inspection', 
        subtitle: 'Requested By: Perry Paul', 
        colorIndex: 2, 
        tableData: [
          { requestDate: '10/14/2025', documentRequested: 'Water Quality Test', loanCategory: 'Inspection', loanPurpose: 'Purchase', loanStage: 'Final Approval', requestedBy: 'Perry Paul', clearedBy: 'John Smith', attachedDoc: 'water_test.pdf' }
        ]
      },
      { 
        name: 'Title Services', 
        subtitle: 'Requested By: Perry Paul', 
        colorIndex: 3, 
        tableData: [
          { requestDate: '10/15/2025', documentRequested: 'Title Search', loanCategory: 'Title', loanPurpose: 'Purchase', loanStage: 'Initial Approval', requestedBy: 'Perry Paul', clearedBy: 'Jennifer Lee', attachedDoc: 'title_search.pdf' },
          { requestDate: '10/16/2025', documentRequested: 'Title Insurance', loanCategory: 'Title', loanPurpose: 'Purchase', loanStage: 'Initial Approval', requestedBy: 'Perry Paul', clearedBy: '-', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Notary Services', 
        subtitle: 'Requested By: Perry Paul', 
        colorIndex: 4, 
        tableData: [
          { requestDate: '10/20/2025', documentRequested: 'Document Notarization', loanCategory: 'Notary', loanPurpose: 'Purchase', loanStage: 'Final Approval', requestedBy: 'Perry Paul', clearedBy: 'Robert Martinez', attachedDoc: 'notary_doc.pdf' }
        ]
      }
    ];

    let rateLock = [
      { 
        name: 'Locked', 
        subtitle: 'Rate Lock Status', 
        colorIndex: 0,
        customLabel: 'Lock Date',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Rate Lock Confirmation', loanCategory: 'Rate Lock', loanPurpose: 'Purchase', loanStage: 'Initial Approval', requestedBy: 'Perry Paul', clearedBy: 'System', attachedDoc: 'rate_lock.pdf' }
        ]
      },
      { 
        name: '18 days', 
        subtitle: 'Lock Expires', 
        colorIndex: 1,
        customLabel: 'Locked Expiration',
        tableData: [
          { requestDate: '11/11/2025', documentRequested: 'Rate Lock Expiration', loanCategory: 'Rate Lock', loanPurpose: 'Purchase', loanStage: 'Initial Approval', requestedBy: 'Perry Paul', clearedBy: '-', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Perry Paul', 
        subtitle: 'Locked By', 
        colorIndex: 2,
        customLabel: 'Lock Request',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Rate Lock Request', loanCategory: 'Rate Lock', loanPurpose: 'Purchase', loanStage: 'Initial Approval', requestedBy: 'Perry Paul', clearedBy: 'Approved', attachedDoc: 'lock_request.pdf' }
        ]
      },
      { 
        name: 'Lock Extension', 
        subtitle: 'Extension Available', 
        colorIndex: 3,
        customLabel: 'Extension Option',
        tableData: [
          { requestDate: '10/25/2025', documentRequested: 'Lock Extension Request', loanCategory: 'Rate Lock', loanPurpose: 'Purchase', loanStage: 'Initial Approval', requestedBy: 'Perry Paul', clearedBy: '-', attachedDoc: '-' },
          { requestDate: '10/25/2025', documentRequested: 'Extension Fee Quote', loanCategory: 'Rate Lock', loanPurpose: 'Purchase', loanStage: 'Initial Approval', requestedBy: 'Perry Paul', clearedBy: '-', attachedDoc: '-' }
        ]
      }
    ];

    let team = [
      { 
        name: 'Perry Paul', 
        subtitle: 'Loan Agent', 
        colorIndex: 0,  // Blue
        customLabel: 'Loan Initiation',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Loan Application', loanCategory: 'Origination', loanPurpose: 'Purchase', loanStage: 'Loan Prep', requestedBy: 'Perry Paul', clearedBy: 'Approved', attachedDoc: 'application.pdf' }
        ]
      },
      { 
        name: 'Tina Jones', 
        subtitle: 'Processor', 
        colorIndex: 1,  // Purple
        customLabel: 'Submit to UW',
        tableData: [
          { requestDate: '10/15/2025', documentRequested: 'Processing Complete', loanCategory: 'Processing', loanPurpose: 'Purchase', loanStage: 'Initial Approval', requestedBy: 'Tina Jones', clearedBy: '-', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Frank Moss', 
        subtitle: 'Underwriter', 
        colorIndex: 2,  // Emerald (Green)
        customLabel: 'Initial Approval',
        tableData: [
          { requestDate: '10/20/2025', documentRequested: 'Underwriting Review', loanCategory: 'Underwriting', loanPurpose: 'Purchase', loanStage: 'Initial Approval', requestedBy: 'Frank Moss', clearedBy: 'Approved', attachedDoc: 'uw_report.pdf' }
        ]
      },
      { 
        name: 'Sarah Chen', 
        subtitle: 'Closing Coordinator', 
        colorIndex: 3,  // Amber (Yellow/Orange)
        customLabel: 'Clear to Close',
        tableData: [
          { requestDate: '10/22/2025', documentRequested: 'Closing Docs Prep', loanCategory: 'Closing', loanPurpose: 'Purchase', loanStage: 'Final Approval', requestedBy: 'Sarah Chen', clearedBy: 'In Progress', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Marcus Williams', 
        subtitle: 'Compliance Officer', 
        colorIndex: 4,  // Rose (Red/Pink)
        customLabel: 'Compliance Review',
        tableData: [
          { requestDate: '10/12/2025', documentRequested: 'Compliance Check', loanCategory: 'Compliance', loanPurpose: 'Purchase', loanStage: 'Loan Prep', requestedBy: 'Marcus Williams', clearedBy: 'Approved', attachedDoc: 'compliance.pdf' }
        ]
      },
      { 
        name: 'Jennifer Lee', 
        subtitle: 'Title Officer', 
        colorIndex: 5,  // Cyan (Light Blue)
        customLabel: 'Title Search',
        tableData: [
          { requestDate: '10/14/2025', documentRequested: 'Title Report', loanCategory: 'Title', loanPurpose: 'Purchase', loanStage: 'Initial Approval', requestedBy: 'Jennifer Lee', clearedBy: 'Complete', attachedDoc: 'title_report.pdf' }
        ]
      },
      { 
        name: 'David Martinez', 
        subtitle: 'Appraisal Coordinator', 
        colorIndex: 6,  // Orange
        customLabel: 'Appraisal Order',
        tableData: [
          { requestDate: '10/11/2025', documentRequested: 'Appraisal Report', loanCategory: 'Appraisal', loanPurpose: 'Purchase', loanStage: 'Loan Prep', requestedBy: 'David Martinez', clearedBy: 'Complete', attachedDoc: 'appraisal.pdf' }
        ]
      },
      { 
        name: 'Amanda Rodriguez', 
        subtitle: 'Quality Control', 
        colorIndex: 7,  // Pink
        customLabel: 'QC Review',
        tableData: [
          { requestDate: '10/18/2025', documentRequested: 'QC Audit', loanCategory: 'Quality Control', loanPurpose: 'Purchase', loanStage: 'Initial Approval', requestedBy: 'Amanda Rodriguez', clearedBy: 'Passed', attachedDoc: 'qc_report.pdf' }
        ]
      },
      { 
        name: 'Robert Taylor', 
        subtitle: 'Funder', 
        colorIndex: 8,  // Lime (Yellow-Green)
        customLabel: 'Funding Date',
        tableData: [
          { requestDate: '10/25/2025', documentRequested: 'Funding Package', loanCategory: 'Funding', loanPurpose: 'Purchase', loanStage: 'Clear to Close', requestedBy: 'Robert Taylor', clearedBy: 'Pending', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Lisa Anderson', 
        subtitle: 'Post-Closing Specialist', 
        colorIndex: 9,  // Indigo (Deep Blue)
        customLabel: 'Post-Close',
        tableData: [
          { requestDate: '10/26/2025', documentRequested: 'Post-Closing Review', loanCategory: 'Post-Closing', loanPurpose: 'Purchase', loanStage: 'Funded', requestedBy: 'Lisa Anderson', clearedBy: 'Pending', attachedDoc: '-' }
        ]
      }
    ];

    let figures = [
      { 
        name: 'Initial LE', 
        subtitle: '$450,000', 
        colorIndex: 0,  // Blue
        customLabel: 'Amount',
        category: 'le',  // Category for filtering
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Initial Loan Estimate', loanCategory: 'Figures', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Issued', attachedDoc: 'initial_le.pdf' }
        ]
      },
      { 
        name: 'Updated LE', 
        subtitle: '$465,000', 
        colorIndex: 1,  // Purple
        customLabel: 'Amount',
        category: 'le',  // Category for filtering
        tableData: [
          { requestDate: '10/15/2025', documentRequested: 'Updated Loan Estimate', loanCategory: 'Figures', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Issued', attachedDoc: 'updated_le.pdf' }
        ]
      },
      { 
        name: 'Initial CD', 
        subtitle: '$465,000', 
        colorIndex: 2,  // Emerald
        customLabel: 'Amount',
        category: 'cd',  // Category for filtering
        tableData: [
          { requestDate: '10/18/2025', documentRequested: 'Initial Closing Disclosure', loanCategory: 'Figures', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Issued', attachedDoc: 'initial_cd.pdf' }
        ]
      },
      { 
        name: 'Updated CD', 
        subtitle: '$470,000', 
        colorIndex: 3,  // Amber
        customLabel: 'Amount',
        category: 'cd',  // Category for filtering
        tableData: [
          { requestDate: '10/22/2025', documentRequested: 'Updated Closing Disclosure', loanCategory: 'Figures', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Issued', attachedDoc: 'updated_cd.pdf' }
        ]
      },
      { 
        name: 'Final CD', 
        subtitle: '$473,000', 
        colorIndex: 4,  // Rose
        customLabel: 'Amount',
        category: 'cd',  // Category for filtering
        tableData: [
          { requestDate: '10/24/2025', documentRequested: 'Final Closing Disclosure', loanCategory: 'Figures', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Issued', attachedDoc: 'final_cd.pdf' }
        ]
      },
      { 
        name: 'Closing CD', 
        subtitle: '$475,000', 
        colorIndex: 5,  // Cyan
        customLabel: 'Amount',
        category: 'cd',  // Category for filtering
        tableData: [
          { requestDate: '10/26/2025', documentRequested: 'Closing CD', loanCategory: 'Figures', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Issued', attachedDoc: 'closing_cd.pdf' }
        ]
      }
    ];

    let activity = [
      { 
        name: 'Uploaded Pay Stub', 
        subtitle: 'Perry Paul', 
        colorIndex: 0,  // Blue
        customLabel: 'Activity Date',
        tableData: [
          { requestDate: '10/24/2025', documentRequested: 'Pay Stub Upload', loanCategory: 'Activity', loanPurpose: 'Purchase', loanStage: 'Loan Prep', requestedBy: 'Perry Paul', clearedBy: 'Uploaded', attachedDoc: 'paystub.pdf' }
        ]
      },
      { 
        name: 'Reviewed Appraisal', 
        subtitle: 'Tina Jones', 
        colorIndex: 1,  // Purple
        customLabel: 'Activity Date',
        tableData: [
          { requestDate: '10/24/2025', documentRequested: 'Appraisal Review', loanCategory: 'Activity', loanPurpose: 'Purchase', loanStage: 'Initial Approval', requestedBy: 'Tina Jones', clearedBy: 'Reviewed', attachedDoc: 'appraisal.pdf' }
        ]
      },
      { 
        name: 'Uploaded WDO', 
        subtitle: 'Frank Moss', 
        colorIndex: 2,  // Emerald (Green)
        customLabel: 'Activity Date',
        tableData: [
          { requestDate: '10/24/2025', documentRequested: 'WDO Report Upload', loanCategory: 'Activity', loanPurpose: 'Purchase', loanStage: 'Initial Approval', requestedBy: 'Frank Moss', clearedBy: 'Uploaded', attachedDoc: 'wdo.pdf' }
        ]
      },
      { 
        name: 'Uploaded Water Test', 
        subtitle: 'Perry Paul', 
        colorIndex: 3,  // Amber
        customLabel: 'Activity Date',
        tableData: [
          { requestDate: '10/23/2025', documentRequested: 'Water Test Upload', loanCategory: 'Activity', loanPurpose: 'Purchase', loanStage: 'Initial Approval', requestedBy: 'Perry Paul', clearedBy: 'Uploaded', attachedDoc: 'watertest.pdf' }
        ]
      },
      { 
        name: 'Uploaded ID Copy', 
        subtitle: 'Tina Jones', 
        colorIndex: 4,  // Rose
        customLabel: 'Activity Date',
        tableData: [
          { requestDate: '10/23/2025', documentRequested: 'ID Copy Upload', loanCategory: 'Activity', loanPurpose: 'Purchase', loanStage: 'Loan Prep', requestedBy: 'Tina Jones', clearedBy: 'Uploaded', attachedDoc: 'id_copy.pdf' }
        ]
      }
    ];

    let loandetails = [
      { 
        name: 'LTV - Back End', 
        subtitle: '85.5%', 
        colorIndex: 0,  // Blue
        customLabel: 'Detail',
        category: 'percentage',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'LTV - Back End', loanCategory: 'Loan Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      },
      { 
        name: 'LTV - Front End', 
        subtitle: '78.2%', 
        colorIndex: 1,  // Purple
        customLabel: 'Detail',
        category: 'percentage',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'LTV - Front End', loanCategory: 'Loan Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      },
      { 
        name: 'DTI Ratio', 
        subtitle: '42%', 
        colorIndex: 2,  // Emerald
        customLabel: 'Detail',
        category: 'percentage',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'DTI Ratio', loanCategory: 'Loan Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Cash Out Amount', 
        subtitle: '$0', 
        colorIndex: 3,  // Amber
        customLabel: 'Detail',
        category: 'dollar',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Cash Out Amount', loanCategory: 'Loan Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Loan Amount', 
        subtitle: '$450,000', 
        colorIndex: 0,  // Blue
        customLabel: 'Detail',
        category: 'dollar',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Loan Amount', loanCategory: 'Loan Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Interest Rate', 
        subtitle: '6.5%', 
        colorIndex: 1,  // Purple
        customLabel: 'Detail',
        category: 'general',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Interest Rate', loanCategory: 'Loan Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Down Payment', 
        subtitle: '$90,000', 
        colorIndex: 2,  // Emerald
        customLabel: 'Detail',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Down Payment', loanCategory: 'Loan Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Loan Term', 
        subtitle: '30 Years', 
        colorIndex: 3,  // Amber
        customLabel: 'Detail',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Loan Term', loanCategory: 'Loan Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Monthly Payment', 
        subtitle: '$2,847', 
        colorIndex: 4,  // Rose
        customLabel: 'Detail',
        category: 'dollar',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Monthly Payment', loanCategory: 'Loan Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Property Value', 
        subtitle: '$540,000', 
        colorIndex: 5,  // Cyan
        customLabel: 'Detail',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Property Value', loanCategory: 'Property Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      },
      { 
        name: 'LTV Ratio', 
        subtitle: '83.3%', 
        colorIndex: 6,  // Orange
        customLabel: 'Detail',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'LTV Ratio', loanCategory: 'Loan Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Closing Costs', 
        subtitle: '$13,500', 
        colorIndex: 7,  // Pink
        customLabel: 'Detail',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Closing Costs', loanCategory: 'Loan Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Property Tax', 
        subtitle: '$450/month', 
        colorIndex: 8,  // Lime
        customLabel: 'Detail',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Property Tax', loanCategory: 'Property Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      },
      { 
        name: 'HOA Fees', 
        subtitle: '$250/month', 
        colorIndex: 9,  // Indigo
        customLabel: 'Detail',
        category: 'dollar',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'HOA Fees', loanCategory: 'Property Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Appraised Value', 
        subtitle: '$485,000', 
        colorIndex: 5,  // Cyan
        customLabel: 'Detail',
        category: 'home',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Appraised Value', loanCategory: 'Property Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Estimated Value', 
        subtitle: '$495,000', 
        colorIndex: 6,  // Orange
        customLabel: 'Detail',
        category: 'home',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Estimated Value', loanCategory: 'Property Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Property Use', 
        subtitle: 'Primary Residence', 
        colorIndex: 7,  // Pink
        customLabel: 'Detail',
        category: 'home',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Property Use', loanCategory: 'Property Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Property Type', 
        subtitle: 'Single Family', 
        colorIndex: 8,  // Lime
        customLabel: 'Detail',
        category: 'home',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Property Type', loanCategory: 'Property Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Mid FICO Score', 
        subtitle: '742', 
        colorIndex: 0,  // Blue
        customLabel: 'Detail',
        category: 'info',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Mid FICO Score', loanCategory: 'Credit Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Borrower Scores', 
        subtitle: '750 / 738 / 742', 
        colorIndex: 1,  // Purple
        customLabel: 'Detail',
        category: 'info',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Borrower Scores', loanCategory: 'Credit Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Co-Borrower Scores', 
        subtitle: '728 / 715 / 720', 
        colorIndex: 2,  // Emerald
        customLabel: 'Detail',
        category: 'info',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Co-Borrower Scores', loanCategory: 'Credit Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Loan Purpose', 
        subtitle: 'Purchase', 
        colorIndex: 3,  // Amber
        customLabel: 'Detail',
        category: 'wrench',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Loan Purpose', loanCategory: 'Loan Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Loan Program', 
        subtitle: 'VA', 
        colorIndex: 4,  // Rose
        customLabel: 'Detail',
        category: 'wrench',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Loan Program', loanCategory: 'Loan Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Loan Category', 
        subtitle: 'Conventional', 
        colorIndex: 5,  // Cyan
        customLabel: 'Detail',
        category: 'wrench',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Loan Category', loanCategory: 'Loan Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Lender', 
        subtitle: 'First National Bank', 
        colorIndex: 6,  // Orange
        customLabel: 'Detail',
        category: 'wrench',
        tableData: [
          { requestDate: '10/10/2025', documentRequested: 'Lender', loanCategory: 'Loan Info', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'System', clearedBy: 'Confirmed', attachedDoc: '-' }
        ]
      }
    ];

    let notes = [
      { 
        name: 'Loan', 
        subtitle: '5 Notes', 
        colorIndex: 0,  // Blue
        customLabel: 'Note Date',
        tableData: [
          { requestDate: '10/24/2025', documentRequested: 'Loan Note 1', loanCategory: 'Loan Notes', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'Perry Paul', clearedBy: 'Added', attachedDoc: '-' },
          { requestDate: '10/23/2025', documentRequested: 'Loan Note 2', loanCategory: 'Loan Notes', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'Tina Jones', clearedBy: 'Added', attachedDoc: '-' },
          { requestDate: '10/22/2025', documentRequested: 'Loan Note 3', loanCategory: 'Loan Notes', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'Frank Moss', clearedBy: 'Added', attachedDoc: '-' },
          { requestDate: '10/21/2025', documentRequested: 'Loan Note 4', loanCategory: 'Loan Notes', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'Perry Paul', clearedBy: 'Added', attachedDoc: '-' },
          { requestDate: '10/20/2025', documentRequested: 'Loan Note 5', loanCategory: 'Loan Notes', loanPurpose: 'Purchase', loanStage: 'Active', requestedBy: 'Tina Jones', clearedBy: 'Added', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Loan Prep', 
        subtitle: '4 Notes', 
        colorIndex: 1,  // Purple
        customLabel: 'Note Date',
        tableData: [
          { requestDate: '10/24/2025', documentRequested: 'Prep Note 1', loanCategory: 'Loan Prep Notes', loanPurpose: 'Purchase', loanStage: 'Loan Prep', requestedBy: 'Perry Paul', clearedBy: 'Added', attachedDoc: '-' },
          { requestDate: '10/23/2025', documentRequested: 'Prep Note 2', loanCategory: 'Loan Prep Notes', loanPurpose: 'Purchase', loanStage: 'Loan Prep', requestedBy: 'Tina Jones', clearedBy: 'Added', attachedDoc: '-' },
          { requestDate: '10/22/2025', documentRequested: 'Prep Note 3', loanCategory: 'Loan Prep Notes', loanPurpose: 'Purchase', loanStage: 'Loan Prep', requestedBy: 'Frank Moss', clearedBy: 'Added', attachedDoc: '-' },
          { requestDate: '10/21/2025', documentRequested: 'Prep Note 4', loanCategory: 'Loan Prep Notes', loanPurpose: 'Purchase', loanStage: 'Loan Prep', requestedBy: 'Perry Paul', clearedBy: 'Added', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Quote', 
        subtitle: '3 Notes', 
        colorIndex: 2,  // Emerald (Green)
        customLabel: 'Note Date',
        tableData: [
          { requestDate: '10/24/2025', documentRequested: 'Quote Note 1', loanCategory: 'Quote Notes', loanPurpose: 'Purchase', loanStage: 'Quote', requestedBy: 'Tina Jones', clearedBy: 'Added', attachedDoc: '-' },
          { requestDate: '10/23/2025', documentRequested: 'Quote Note 2', loanCategory: 'Quote Notes', loanPurpose: 'Purchase', loanStage: 'Quote', requestedBy: 'Frank Moss', clearedBy: 'Added', attachedDoc: '-' },
          { requestDate: '10/22/2025', documentRequested: 'Quote Note 3', loanCategory: 'Quote Notes', loanPurpose: 'Purchase', loanStage: 'Quote', requestedBy: 'Perry Paul', clearedBy: 'Added', attachedDoc: '-' }
        ]
      },
      { 
        name: 'Lead', 
        subtitle: '7 Notes', 
        colorIndex: 3,  // Amber
        customLabel: 'Note Date',
        tableData: [
          { requestDate: '10/24/2025', documentRequested: 'Lead Note 1', loanCategory: 'Lead Notes', loanPurpose: 'Purchase', loanStage: 'Lead', requestedBy: 'Perry Paul', clearedBy: 'Added', attachedDoc: '-' },
          { requestDate: '10/23/2025', documentRequested: 'Lead Note 2', loanCategory: 'Lead Notes', loanPurpose: 'Purchase', loanStage: 'Lead', requestedBy: 'Tina Jones', clearedBy: 'Added', attachedDoc: '-' },
          { requestDate: '10/22/2025', documentRequested: 'Lead Note 3', loanCategory: 'Lead Notes', loanPurpose: 'Purchase', loanStage: 'Lead', requestedBy: 'Frank Moss', clearedBy: 'Added', attachedDoc: '-' },
          { requestDate: '10/21/2025', documentRequested: 'Lead Note 4', loanCategory: 'Lead Notes', loanPurpose: 'Purchase', loanStage: 'Lead', requestedBy: 'Perry Paul', clearedBy: 'Added', attachedDoc: '-' },
          { requestDate: '10/20/2025', documentRequested: 'Lead Note 5', loanCategory: 'Lead Notes', loanPurpose: 'Purchase', loanStage: 'Lead', requestedBy: 'Tina Jones', clearedBy: 'Added', attachedDoc: '-' },
          { requestDate: '10/19/2025', documentRequested: 'Lead Note 6', loanCategory: 'Lead Notes', loanPurpose: 'Purchase', loanStage: 'Lead', requestedBy: 'Frank Moss', clearedBy: 'Added', attachedDoc: '-' },
          { requestDate: '10/18/2025', documentRequested: 'Lead Note 7', loanCategory: 'Lead Notes', loanPurpose: 'Purchase', loanStage: 'Lead', requestedBy: 'Perry Paul', clearedBy: 'Added', attachedDoc: '-' }
        ]
      }
    ];

    let currentTab = null; // No tab selected by default // Track current tab: 'docs' or 'services' or 'ratelock' or 'team' or 'activity' or 'loandetails'
    let currentData = documents; // Current data to display
    let loanDetailsFilter = null; // Track if loan details is filtered
    let figuresFilter = null; // Track if figures is filtered
    let docsFilter = null; // Track if docs is filtered
    let vendorsFilter = null; // Track if vendors is filtered
    let rateLockFilter = null; // Track if rate lock is filtered

    function filterDocs(status) {
      // Only works on docs tab
      if (currentTab !== 'docs') return;
      
      // Handle 'all' - always show all documents
      if (status === 'all') {
        docsFilter = null;
        currentData = documents;
      } else {
        // Set filter and filter data
        docsFilter = status;
        currentData = documents.filter(item => {
          if (status === 'underreview') {
            return item.status === 'under review';
          }
          return item.status === status;
        });
      }
      
      // Get current items
      const docItems = document.querySelectorAll('.doc-item');
      const docsList = document.getElementById('docsList');
      
      // SMOOTH BUTTERY SLOW-MOTION ROLL UP
      docItems.forEach((item, index) => {
        setTimeout(() => {
          item.classList.add('rolling-up');
        }, index * 80);
      });
      
      // After roll up completes, update the list and roll down smoothly
      setTimeout(() => {
        updateDocumentsList();
        
        // SMOOTH BUTTERY SLOW-MOTION ROLL DOWN
        const newDocItems = document.querySelectorAll('.doc-item');
        newDocItems.forEach((item, index) => {
          item.style.opacity = '0';
          setTimeout(() => {
            item.classList.add('rolling-down');
          }, index * 80);
        });
        
      }, docItems.length * 80 + 600);
    }

    function filterVendors(status) {
      // Only works on services tab
      if (currentTab !== 'services') return;
      
      // Handle 'all' - always show all services
      if (status === 'all') {
        vendorsFilter = null;
        currentData = services;
      } else {
        // Set filter and filter data
        vendorsFilter = status;
        if (status === 'cleared') {
          currentData = services.filter(item => item.name === 'Title services');
        } else if (status === 'pending') {
          currentData = services.filter(item => item.name !== 'Title services');
        } else if (status === 'underreview') {
          currentData = services.filter(item => item.status === 'under review');
        }
      }
      
      // Get current items
      const docItems = document.querySelectorAll('.doc-item');
      const docsList = document.getElementById('docsList');
      
      // SMOOTH BUTTERY SLOW-MOTION ROLL UP
      docItems.forEach((item, index) => {
        setTimeout(() => {
          item.classList.add('rolling-up');
        }, index * 80);
      });
      
      // After roll up completes, update the list and roll down smoothly
      setTimeout(() => {
        updateDocumentsList();
        
        // SMOOTH BUTTERY SLOW-MOTION ROLL DOWN
        const newDocItems = document.querySelectorAll('.doc-item');
        newDocItems.forEach((item, index) => {
          item.style.opacity = '0';
          setTimeout(() => {
            item.classList.add('rolling-down');
          }, index * 80);
        });
        
      }, docItems.length * 80 + 600);
    }

    function filterRateLock(status) {
      // Only works on ratelock tab
      if (currentTab !== 'ratelock') return;
      
      // Toggle filter - if already filtering by this status, show all
      if (rateLockFilter === status) {
        rateLockFilter = null;
        currentData = rateLock;
      } else {
        rateLockFilter = status;
        // For now, show all items for both locked/unlocked
        // You can customize the filter logic later
        currentData = rateLock;
      }
      
      // Get current items
      const docItems = document.querySelectorAll('.doc-item');
      const docsList = document.getElementById('docsList');
      
      // SMOOTH BUTTERY SLOW-MOTION ROLL UP
      docItems.forEach((item, index) => {
        setTimeout(() => {
          item.classList.add('rolling-up');
        }, index * 80);
      });
      
      // After roll up completes, update the list and roll down smoothly
      setTimeout(() => {
        updateDocumentsList();
        
        // SMOOTH BUTTERY SLOW-MOTION ROLL DOWN
        const newDocItems = document.querySelectorAll('.doc-item');
        newDocItems.forEach((item, index) => {
          item.style.opacity = '0';
          setTimeout(() => {
            item.classList.add('rolling-down');
          }, index * 80);
        });
        
      }, docItems.length * 80 + 600);
    }

    function filterFigures(category) {
      // Only works on figures tab
      if (currentTab !== 'figures') return;
      
      // Toggle filter - if already filtering by this category, show all
      if (figuresFilter === category) {
        figuresFilter = null;
        currentData = figures;
      } else {
        figuresFilter = category;
        currentData = figures.filter(item => item.category === category);
      }
      
      // Get current items
      const docItems = document.querySelectorAll('.doc-item');
      const docsList = document.getElementById('docsList');
      
      // SMOOTH BUTTERY SLOW-MOTION ROLL UP
      docItems.forEach((item, index) => {
        setTimeout(() => {
          item.classList.add('rolling-up');
        }, index * 80);
      });
      
      // After roll up completes, update the list and roll down smoothly
      setTimeout(() => {
        updateDocumentsList();
        
        // SMOOTH BUTTERY SLOW-MOTION ROLL DOWN
        const newDocItems = document.querySelectorAll('.doc-item');
        newDocItems.forEach((item, index) => {
          item.style.opacity = '0';
          setTimeout(() => {
            item.classList.add('rolling-down');
          }, index * 80);
        });
        
      }, docItems.length * 80 + 600);
    }

    function filterLoanDetails(category) {
      // Only works on loandetails tab
      if (currentTab !== 'loandetails') return;
      
      // Handle 'all' - always show all loan details
      if (category === 'all') {
        loanDetailsFilter = null;
        currentData = loandetails;
      } else {
        // Set filter
        loanDetailsFilter = category;
        currentData = loandetails.filter(item => item.category === category);
      }
      
      // Get current items
      const docItems = document.querySelectorAll('.doc-item');
      const docsList = document.getElementById('docsList');
      
      // SMOOTH BUTTERY SLOW-MOTION ROLL UP
      docItems.forEach((item, index) => {
        setTimeout(() => {
          item.classList.add('rolling-up');
        }, index * 80);
      });
      
      // After roll up completes, update the list and roll down smoothly
      setTimeout(() => {
        updateDocumentsList();
        
        // SMOOTH BUTTERY SLOW-MOTION ROLL DOWN
        const newDocItems = document.querySelectorAll('.doc-item');
        newDocItems.forEach((item, index) => {
          item.style.opacity = '0';
          setTimeout(() => {
            item.classList.add('rolling-down');
          }, index * 80);
        });
        
      }, docItems.length * 80 + 600);
    }


    // ==========================================

    // ==========================================

    // ==========================================
    // HOVER CLOSE FOR DROPDOWNS
    // ==========================================

    function setupHoverCloseForDropdown(containerId) {
      const container = document.getElementById(containerId);
      if (!container) return;
      
      let isMouseInside = false;
      
      container.addEventListener('mouseenter', () => {
        isMouseInside = true;
      });
      
      container.addEventListener('mouseleave', () => {
        isMouseInside = false;
        setTimeout(() => {
          if (!isMouseInside) {
            const menu = container.querySelector('.docs-dropdown-menu, .vendors-dropdown-menu, .ratelock-dropdown-menu, .figures-dropdown-menu, .team-dropdown-menu, .loandetails-dropdown-menu, .activity-dropdown-menu, .notes-dropdown-menu');
            if (menu) {
              menu.classList.remove('show');
              container.classList.remove('open');
              
              // Remove active state from button if this isn't the current tab
              const button = container.querySelector('.nav-pill');
              if (button) {
                const buttonId = button.id;
                let isCurrentTab = false;
                
                // Check if this button corresponds to the current tab
                if ((buttonId === 'docsTabButton' && currentTab === 'docs') ||
                    (buttonId === 'vendorsTabButton' && currentTab === 'services') ||
                    (buttonId === 'figuresTabButton' && currentTab === 'figures') ||
                    (buttonId === 'teamTabButton' && currentTab === 'team') ||
                    (buttonId === 'loandetailsTabButton' && currentTab === 'loandetails') ||
                    (buttonId === 'activityTabButton' && currentTab === 'activity') ||
                    (buttonId === 'notesTabButton' && currentTab === 'notes')) {
                  isCurrentTab = true;
                }
                
                // Only keep active class if this is the current tab
                if (!isCurrentTab) {
                  button.classList.remove('active');
                }
              }
            }
          }
        }, 200); // Small delay to prevent accidental closes
      });
    }

    // Setup hover close for all dropdowns
    document.addEventListener('DOMContentLoaded', function() {
      setupHoverCloseForDropdown('docsDropdownContainer');
      setupHoverCloseForDropdown('vendorsDropdownContainer');
      setupHoverCloseForDropdown('ratelockDropdownContainer');
      setupHoverCloseForDropdown('figuresDropdownContainer');
      setupHoverCloseForDropdown('teamDropdownContainer');
      setupHoverCloseForDropdown('loandetailsDropdownContainer');
      setupHoverCloseForDropdown('activityDropdownContainer');
      setupHoverCloseForDropdown('notesDropdownContainer');
    });
    // CLOSE ALL DROPDOWNS UTILITY
    // ==========================================

    function closeAllDropdowns() {
      // Close all dropdown menus
      const dropdowns = [
        'docsDropdownMenu',
        'vendorsDropdownMenu',
        'ratelockDropdownMenu',
        'figuresDropdownMenu',
        'teamDropdownMenu',
        'loandetailsDropdownMenu',
        'activityDropdownMenu',
        'notesDropdownMenu'
      ];
      
      const containers = [
        'docsDropdownContainer',
        'vendorsDropdownContainer',
        'ratelockDropdownContainer',
        'figuresDropdownContainer',
        'teamDropdownContainer',
        'loandetailsDropdownContainer',
        'activityDropdownContainer',
        'notesDropdownContainer'
      ];
      
      dropdowns.forEach(id => {
        const menu = document.getElementById(id);
        if (menu) menu.classList.remove('show');
      });
      
      containers.forEach(id => {
        const container = document.getElementById(id);
        if (container) container.classList.remove('open');
      });
    }

    // Show cards with animation
    function showCards() {
      const leftCard = document.getElementById('leftCard');
      const rightCard = document.getElementById('rightCard');
      
      if (leftCard && leftCard.classList.contains('hidden')) {
        leftCard.classList.remove('hidden');
        leftCard.style.opacity = '0';
        leftCard.style.transform = 'translateY(-20px)';
        
        setTimeout(() => {
          leftCard.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
          leftCard.style.opacity = '1';
          leftCard.style.transform = 'translateY(0)';
        }, 50);
      }
      
      if (rightCard && rightCard.classList.contains('hidden')) {
        rightCard.classList.remove('hidden');
        rightCard.style.opacity = '0';
        rightCard.style.transform = 'translateY(-20px)';
        
        setTimeout(() => {
          rightCard.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
          rightCard.style.opacity = '1';
          rightCard.style.transform = 'translateY(0)';
        }, 150);
      }
    }
    // DOCUMENTS DROPDOWN FUNCTIONALITY
    // ==========================================

    function toggleDocsDropdown(e) {
      closeAllDropdowns();
      e.stopPropagation();
      const menu = document.getElementById('docsDropdownMenu');
      const container = document.getElementById('docsDropdownContainer');
      
      menu.classList.toggle('show');
      container.classList.toggle('open');
      
      // Don't switch tab until user selects an option

    }
    // ==========================================
    // VENDORS DROPDOWN FUNCTIONALITY
    // ==========================================

    function toggleVendorsDropdown(e) {
      closeAllDropdowns();
      e.stopPropagation();
      const menu = document.getElementById('vendorsDropdownMenu');
      const container = document.getElementById('vendorsDropdownContainer');
      
      menu.classList.toggle('show');
      container.classList.toggle('open');
      
      // Don't switch tab until user selects an option
    }

    function selectVendorsFilter(e, filter) {
      e.stopPropagation();
      
      // Remove all selected states
      document.querySelectorAll('#vendorsDropdownMenu .dropdown-option').forEach(opt => {
        opt.classList.remove('selected');
      });
      
      // Add selected state to clicked option
      e.currentTarget.classList.add('selected');
      
      // Close dropdown
      document.getElementById('vendorsDropdownMenu').classList.remove('show');
      document.getElementById('vendorsDropdownContainer').classList.remove('open');
      
      // Apply filter based on selection
      if (filter === 'all') {
        filterVendors('all');
      } else if (filter === 'pending') {
        filterVendors('pending');
      } else if (filter === 'underreview') {
        filterVendors('underreview');
      } else if (filter === 'cleared') {
        filterVendors('cleared');
      } else if (filter === 'search') {
        openSearchModal('vendors');
      } else if (filter === 'updatevendors') {
        openModal();
        return;
      }
      
      // Switch to services tab and show cards
      if (currentTab !== 'services') {
        switchTab('services');
      }
      showCards();
      document.getElementById('vendorsTabButton').classList.add('active');
      
      console.log('Vendors filter selected:', filter);
    }

    // Close vendors dropdown when clicking outside
    document.addEventListener('click', function(e) {
      const dropdown = document.getElementById('vendorsDropdownContainer');
      const menu = document.getElementById('vendorsDropdownMenu');
      if (dropdown && !dropdown.contains(e.target)) {
        menu.classList.remove('show');
        dropdown.classList.remove('open');
      }
    });

    function selectDocsFilter(e, filter) {
      e.stopPropagation();
      
      // Remove all selected states
      document.querySelectorAll('.dropdown-option').forEach(opt => {
        opt.classList.remove('selected');
      });
      
      // Add selected state to clicked option
      e.currentTarget.classList.add('selected');
      
      // Close dropdown
      document.getElementById('docsDropdownMenu').classList.remove('show');
      document.getElementById('docsDropdownContainer').classList.remove('open');
      
      // Apply filter based on selection
      if (filter === 'all') {
        filterDocs('all');
      } else if (filter === 'pending') {
        filterDocs('pending');
      } else if (filter === 'underreview') {
        filterDocs('underreview');
      } else if (filter === 'cleared') {
        filterDocs('cleared');
      } else if (filter === 'search') {
        openSearchModal('docs');
      } else if (filter === 'updatedocs') {
        openModal();
        return;
      }
      // Switch to docs tab and show cards
      if (currentTab !== 'docs') {
        switchTab('docs');
      }
      showCards();
      document.getElementById('docsTabButton').classList.add('active');
      
      console.log('Documents filter selected:', filter);
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function(e) {
      const dropdown = document.getElementById('docsDropdownContainer');
      const menu = document.getElementById('docsDropdownMenu');

      if (dropdown && !dropdown.contains(e.target)) {
        menu.classList.remove('show');
        dropdown.classList.remove('open');
      }
    });
    // ==========================================
    // RATE LOCK DROPDOWN FUNCTIONALITY
    // ==========================================

    function toggleRatelockDropdown(e) {
      closeAllDropdowns();
      e.stopPropagation();
      const menu = document.getElementById('ratelockDropdownMenu');
      const container = document.getElementById('ratelockDropdownContainer');
      
      menu.classList.toggle('show');
      container.classList.toggle('open');
      
      // Switch to ratelock tab if not already there
      if (currentTab !== 'ratelock') {
        switchTab('ratelock');
      }
    }

    function selectRatelockFilter(e, filter) {
      e.stopPropagation();
      
      // Remove all selected states
      document.querySelectorAll('#ratelockDropdownMenu .dropdown-option').forEach(opt => {
        opt.classList.remove('selected');
      });
      
      // Add selected state to clicked option
      e.currentTarget.classList.add('selected');
      
      // Close dropdown
      document.getElementById('ratelockDropdownMenu').classList.remove('show');
      document.getElementById('ratelockDropdownContainer').classList.remove('open');
      
      // Apply filter based on selection
      if (filter === 'lock') {
        filterRateLock('locked');
      } else if (filter === 'search') {
        openSearchModal('ratelock');
      } else if (filter === 'updatelock') {
        openModal();
        return;
      }
      
      // Show cards and activate tab button
      showCards();
      document.getElementById('ratelockTabButton').classList.add('active');
      
      console.log('Rate Lock filter selected:', filter);
    }

    // Close ratelock dropdown when clicking outside
    document.addEventListener('click', function(e) {
      const dropdown = document.getElementById('ratelockDropdownContainer');
      const menu = document.getElementById('ratelockDropdownMenu');
      if (dropdown && !dropdown.contains(e.target)) {
        menu.classList.remove('show');
        dropdown.classList.remove('open');
      }
    });

    // ==========================================
    // SEARCH MODAL FUNCTIONALITY

    // ==========================================
    // FIGURES DROPDOWN FUNCTIONALITY
    // ==========================================

    function toggleFiguresDropdown(e) {
      closeAllDropdowns();
      e.stopPropagation();
      const menu = document.getElementById('figuresDropdownMenu');
      const container = document.getElementById('figuresDropdownContainer');
      
      menu.classList.toggle('show');
      container.classList.toggle('open');
      
      // Don't switch tab until user selects an option
    }

    function selectFiguresFilter(e, filter) {
      e.stopPropagation();
      
      // Remove all selected states
      document.querySelectorAll('#figuresDropdownMenu .dropdown-option').forEach(opt => {
        opt.classList.remove('selected');
      });
      
      // Add selected state to clicked option
      e.currentTarget.classList.add('selected');
      
      // Close dropdown
      document.getElementById('figuresDropdownMenu').classList.remove('show');
      document.getElementById('figuresDropdownContainer').classList.remove('open');
      
      // Apply filter based on selection
      if (filter === 'all') {
        filterFigures('all');
      } else if (filter === 'le') {
        filterFigures('le');
      } else if (filter === 'cd') {
        filterFigures('cd');
      } else if (filter === 'search') {
        openSearchModal('figures');
      } else if (filter === 'updatefigures') {
        openModal();
        return;
      }
      
      // Switch to figures tab and show cards
      if (currentTab !== 'figures') {
        switchTab('figures');
      }
      showCards();
      document.getElementById('figuresTabButton').classList.add('active');
      
      console.log('Figures filter selected:', filter);
    }

    // Close figures dropdown when clicking outside
    document.addEventListener('click', function(e) {
      const dropdown = document.getElementById('figuresDropdownContainer');
      const menu = document.getElementById('figuresDropdownMenu');
      if (dropdown && !dropdown.contains(e.target)) {
        menu.classList.remove('show');
        dropdown.classList.remove('open');
      }
    });
    // ==========================================

    function openSearchModal(tabType) {
      console.log('Opening search modal for:', tabType);
      alert('Search Modal\n\nSearch functionality for ' + tabType + ' will be implemented here.\n\nFeatures:\n Search by keyword\n Filter results\n Quick navigation');
      // In production: Open a search modal with input field and results
    }
    function switchTab(tab) {
      // Don't switch if already on this tab
      if (currentTab === tab) return;
      
      const oldTab = currentTab;
      currentTab = tab;
      
      // Update navigation pill active state
      document.querySelectorAll('.nav-pill').forEach(pill => {
        pill.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // Get all current doc items
      const docItems = document.querySelectorAll('.doc-item');
      const stackIcon = document.getElementById('stackedIcon');
      
      // Rotate and fade out the stack icon - slower and smoother
      stackIcon.style.transition = 'all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
      stackIcon.style.transform = 'rotate(180deg) scale(0.85)';
      stackIcon.style.opacity = '0';
      
      // Roll up existing items with staggered delay
      docItems.forEach((item, index) => {
        setTimeout(() => {
          item.classList.add('rolling-up');
        }, index * 80);
      });
      
      // Wait for roll-up to complete, then switch data and roll down
      setTimeout(() => {
        // Update data source and button text
        if (tab === 'docs') {
          docsFilter = null; // Reset filter when entering docs tab
          currentData = documents;
          
        } else if (tab === 'services') {
          currentData = services;
          
        } else if (tab === 'ratelock') {
          currentData = rateLock;
          
        } else if (tab === 'figures') {
          currentData = figures;
          
        } else if (tab === 'team') {
          currentData = team;
          
        } else if (tab === 'figures') {
          figuresFilter = null; // Reset filter when entering figures tab
          currentData = figures;
          
        } else if (tab === 'activity') {
          currentData = activity;
          
        } else if (tab === 'loandetails') {
          loanDetailsFilter = null; // Reset filter when entering loan details tab
          currentData = loandetails;
          
        } else if (tab === 'notes') {
          currentData = notes;
          
        }
        
        // Update list and roll down
        updateDocumentsList();
        
        setTimeout(() => {
          const newItems = document.querySelectorAll('.doc-item');
          newItems.forEach((item, index) => {
            setTimeout(() => {
              item.classList.remove('rolling-up');
              item.classList.add('rolling-down');
            }, index * 80);
          });
        }, 100);
        
        // Rotate back and fade in the stack icon
        setTimeout(() => {
          stackIcon.style.transform = 'rotate(0deg) scale(1)';
          stackIcon.style.opacity = '1';
          updateStackIcon();
        }, docItems.length * 80 + 300);
      }, docItems.length * 80 + 600);
      
      // Show/hide draggable filters based on tab
      // toggleDraggableFilters(tab === 'docs'); // Disabled - using dropdown instead
    }

    // ==========================================
    // TEAM DROPDOWN FUNCTIONALITY
    // ==========================================

    function toggleTeamDropdown(e) {
      closeAllDropdowns();
      e.stopPropagation();
      const menu = document.getElementById('teamDropdownMenu');
      const container = document.getElementById('teamDropdownContainer');
      
      menu.classList.toggle('show');
      container.classList.toggle('open');
      
      // Don't switch tab until user selects an option
    }

    function selectTeamFilter(e, filter) {
      e.stopPropagation();
      
      // Remove all selected states
      document.querySelectorAll('#teamDropdownMenu .dropdown-option').forEach(opt => {
        opt.classList.remove('selected');
      });
      
      // Add selected state to clicked option
      e.currentTarget.classList.add('selected');
      
      // Close dropdown
      document.getElementById('teamDropdownMenu').classList.remove('show');
      document.getElementById('teamDropdownContainer').classList.remove('open');
      
      // Apply filter based on selection
      if (filter === 'all') {
        filterTeam('all');
      } else if (filter === 'origination') {
        filterTeam('origination');
      } else if (filter === 'processing') {
        filterTeam('processing');
      } else if (filter === 'underwriting') {
        filterTeam('underwriting');
      } else if (filter === 'closing') {
        filterTeam('closing');
      } else if (filter === 'audit') {
        filterTeam('audit');
      } else if (filter === 'funding') {
        filterTeam('funding');
      } else if (filter === 'search') {
        openSearchModal('team');
      } else if (filter === 'updateteam') {
        openModal();
        return;
      }
      
      // Switch to team tab and show cards
      if (currentTab !== 'team') {
        switchTab('team');
      }
      showCards();
      document.getElementById('teamTabButton').classList.add('active');
      
      console.log('Team filter selected:', filter);
    }

    // Close team dropdown when clicking outside
    document.addEventListener('click', function(e) {
      const dropdown = document.getElementById('teamDropdownContainer');
      const menu = document.getElementById('teamDropdownMenu');
      if (dropdown && !dropdown.contains(e.target)) {
        menu.classList.remove('show');
        dropdown.classList.remove('open');
      }
    });

    function filterTeam(department) {
      // Only works on team tab
      // Filter by department
      currentData = team.filter(item => {
        return item.department && item.department.toLowerCase() === department.toLowerCase();
      });
      
      // Refresh the list
      updateDocumentsList();
    }

    // Screen Share function

    // ==========================================
    // LOAN DETAILS DROPDOWN FUNCTIONALITY
    // ==========================================

    function toggleLoanDetailsDropdown(e) {
      closeAllDropdowns();
      e.stopPropagation();
      const menu = document.getElementById('loandetailsDropdownMenu');
      const container = document.getElementById('loandetailsDropdownContainer');
      
      menu.classList.toggle('show');
      container.classList.toggle('open');
      
      // Don't switch tab until user selects an option
    }

    function selectLoanDetailsFilter(e, filter) {
      e.stopPropagation();
      
      // Remove all selected states
      document.querySelectorAll('#loandetailsDropdownMenu .dropdown-option').forEach(opt => {
        opt.classList.remove('selected');
      });
      
      // Add selected state to clicked option
      e.currentTarget.classList.add('selected');
      
      // Close dropdown
      document.getElementById('loandetailsDropdownMenu').classList.remove('show');
      document.getElementById('loandetailsDropdownContainer').classList.remove('open');
      
      // Apply filter based on selection
      if (filter === 'all') {
        filterLoanDetails('all');
      } else if (filter === 'ratio') {
        filterLoanDetails('ratio');
      } else if (filter === 'amount') {
        filterLoanDetails('amount');
      } else if (filter === 'property') {
        filterLoanDetails('property');
      } else if (filter === 'credit') {
        filterLoanDetails('credit');
      } else if (filter === 'loan') {
        filterLoanDetails('loan');
      } else if (filter === 'search') {
        openSearchModal('loandetails');
      } else if (filter === 'updateloan') {
        openModal();
        return;
      }
      
      // Switch to loandetails tab and show cards
      if (currentTab !== 'loandetails') {
        switchTab('loandetails');
      }
      showCards();
      document.getElementById('loandetailsTabButton').classList.add('active');
      
      console.log('Loan Details filter selected:', filter);
    }

    // Close loandetails dropdown when clicking outside
    document.addEventListener('click', function(e) {
      const dropdown = document.getElementById('loandetailsDropdownContainer');
      const menu = document.getElementById('loandetailsDropdownMenu');
      if (dropdown && !dropdown.contains(e.target)) {
        menu.classList.remove('show');
        dropdown.classList.remove('open');
      }
    });
    function startScreenShare() {
      console.log('Screen Share initiated');
      alert('Screen Share feature will be implemented here.\n\nThis will allow users to share their screen with others for collaboration.');
      // Future implementation:
      // - WebRTC screen sharing
      // - User selection for who to share with
      // - Screen share controls (stop/pause)
      // - Recording options
    }

    // Modal navigation functions
    function openModal() {
      document.getElementById('modalOverlay').classList.add('active');
      
      // Get button elements
      const requestBtn = document.getElementById('requestBtn');
      const clearBtn = document.getElementById('clearBtn');
      
      // Update modal text based on current tab
      if (currentTab === 'docs') {
        document.getElementById('modalTitle').textContent = 'Update Documents';
        requestBtn.innerHTML = '<br><span id="requestBtnText">Request Docs</span>';
        clearBtn.innerHTML = '<br><span id="clearBtnText">Clear Docs</span>';
        requestBtn.style.display = 'block';
        clearBtn.style.display = 'block';
      } else if (currentTab === 'services') {
        document.getElementById('modalTitle').textContent = 'Update Vendors';

        requestBtn.innerHTML = '<br><span id="requestBtnText">Request Vendors</span>';
        clearBtn.innerHTML = '<br><span id="clearBtnText">Clear Vendors</span>';
        requestBtn.style.display = 'block';
        clearBtn.style.display = 'block';
      }
    }
    // ==========================================
    // ACTIVITY DROPDOWN FUNCTIONALITY
    // ==========================================

    function toggleActivityDropdown(e) {
      closeAllDropdowns();
      e.stopPropagation();
      const menu = document.getElementById('activityDropdownMenu');
      const container = document.getElementById('activityDropdownContainer');
      
      menu.classList.toggle('show');
      container.classList.toggle('open');
      
      // Don't switch tab until user selects an option
    }

    function selectActivityFilter(e, filter) {
      e.stopPropagation();
      
      // Remove all selected states
      document.querySelectorAll('#activityDropdownMenu .dropdown-option').forEach(opt => {
        opt.classList.remove('selected');
      });
      
      // Add selected state to clicked option
      e.currentTarget.classList.add('selected');
      
      // Close dropdown
      document.getElementById('activityDropdownMenu').classList.remove('show');
      document.getElementById('activityDropdownContainer').classList.remove('open');
      
      // Apply filter based on selection
      if (filter === 'all') {
        filterActivity('all');
      } else if (filter === 'calls') {
        filterActivity('calls');
      } else if (filter === 'emails') {
        filterActivity('emails');
      } else if (filter === 'notes') {
        filterActivity('notes');
      } else if (filter === 'search') {
        openSearchModal('activity');
      } else if (filter === 'updateactivity') {
        openModal();
        return;
      }
      
      // Switch to activity tab and show cards
      if (currentTab !== 'activity') {
        switchTab('activity');
      }
      showCards();
      document.getElementById('activityTabButton').classList.add('active');
      
      console.log('Activity filter selected:', filter);
    }

    // Close activity dropdown when clicking outside
    document.addEventListener('click', function(e) {
      const dropdown = document.getElementById('activityDropdownContainer');
      const menu = document.getElementById('activityDropdownMenu');
      if (dropdown && !dropdown.contains(e.target)) {
        menu.classList.remove('show');
        dropdown.classList.remove('open');
      }
    });
        requestBtn.innerHTML = '<br><span id="requestBtnText">Request Services</span>';
        clearBtn.innerHTML = '<br><span id="clearBtnText">Clear Services</span>';

    function filterActivity(type) {
      // Only works on activity tab
      if (currentTab !== 'activity') return;
      
      // Handle 'all' - always show all activities
      if (type === 'all') {
        currentData = activity;
      } else {
        // Filter by type
        currentData = activity.filter(item => {
          return item.type && item.type.toLowerCase() === type.toLowerCase();
        });
      }
      
      // Refresh the list
      updateDocumentsList();
    }

    // ==========================================
    // NOTES DROPDOWN FUNCTIONALITY
    // ==========================================

    function toggleNotesDropdown(e) {
      closeAllDropdowns();
      e.stopPropagation();
      const menu = document.getElementById('notesDropdownMenu');
      const container = document.getElementById('notesDropdownContainer');
      
      menu.classList.toggle('show');
      container.classList.toggle('open');
      
      // Don't switch tab until user selects an option
    }

    function selectNotesFilter(e, filter) {
      e.stopPropagation();
      
      // Remove all selected states
      document.querySelectorAll('#notesDropdownMenu .dropdown-option').forEach(opt => {
        opt.classList.remove('selected');
      });
      
      // Add selected state to clicked option
      e.currentTarget.classList.add('selected');
      
      // Close dropdown
      document.getElementById('notesDropdownMenu').classList.remove('show');
      document.getElementById('notesDropdownContainer').classList.remove('open');
      
      // Apply filter based on selection
      if (filter === 'all') {
        filterNotes('all');
      } else if (filter === 'lead') {
        filterNotes('lead');
      } else if (filter === 'quote') {
        filterNotes('quote');
      } else if (filter === 'loanprep') {
        filterNotes('loan prep');
      } else if (filter === 'loan') {
        filterNotes('loan');
      } else if (filter === 'funding') {
        filterNotes('funding');
      } else if (filter === 'audit') {
        filterNotes('audit');
      } else if (filter === 'closing') {
        filterNotes('closing');
      } else if (filter === 'search') {
        openSearchModal('notes');
      } else if (filter === 'updatenotes') {
        openModal();
        return;
      }
      
      // Switch to notes tab and show cards
      if (currentTab !== 'notes') {
        switchTab('notes');
      }
      showCards();
      document.getElementById('notesTabButton').classList.add('active');
      
      console.log('Notes filter selected:', filter);
    }

    // Close notes dropdown when clicking outside
    document.addEventListener('click', function(e) {
      const dropdown = document.getElementById('notesDropdownContainer');
      const menu = document.getElementById('notesDropdownMenu');
      if (dropdown && !dropdown.contains(e.target)) {
        menu.classList.remove('show');
        dropdown.classList.remove('open');
      }
    });

    function showActivityFilter() {
      document.getElementById('choiceStep').style.display = 'none';
      document.getElementById('requestStep').style.display = 'none';
      document.getElementById('clearStep').style.display = 'none';

    function filterNotes(stage) {
      // Only works on notes tab
      if (currentTab !== 'notes') return;
      
      // Handle 'all' - always show all notes
      if (stage === 'all') {
        currentData = notes;
      } else {
        // Filter by stage
        currentData = notes.filter(item => {
          return item.stage && item.stage.toLowerCase() === stage.toLowerCase();
        });
      }
      
      // Refresh the list
      updateDocumentsList();
    }
      document.getElementById('activityFilterStep').style.display = 'block';
    }

    function closeModal() {
      document.getElementById('modalOverlay').classList.remove('active');
    }

    function closeModalOnOverlay(event) {
      if (event.target === document.getElementById('modalOverlay')) {
        closeModal();
      }
    }

    function openTeamPopup() {
      // For services tab, show vendor choice popup instead
      if (currentTab === 'services') {
        openVendorChoice();
        return;
      }
      
      // For team tab, show team popup
      const overlay = document.getElementById('teamPopupOverlay');
      const title = document.getElementById('teamPopupTitle');
      const content = document.getElementById('teamPopupContent');
      
      title.textContent = 'Team Directory';
      
      // Clear existing content
      content.innerHTML = '';
      
      // Color palette for avatars
      const avatarColors = [
        '#3b82f6', // Blue
        '#8b5cf6', // Purple
        '#10b981', // Emerald
        '#f59e0b', // Amber
        '#ec4899', // Pink
        '#06b6d4', // Cyan
        '#f97316', // Orange
        '#a855f7', // Violet
        '#84cc16', // Lime
        '#6366f1'  // Indigo
      ];
      
      // Determine which data to display
      const dataToDisplay = currentTab === 'team' ? team : services;
      
      // Generate cards
      dataToDisplay.forEach((item, index) => {
        const initials = item.name.split(' ').map(n => n[0]).join('');
        const avatarColor = avatarColors[item.colorIndex % avatarColors.length];
        
        const card = document.createElement('div');
        card.className = 'team-member-card';
        
        if (currentTab === 'team') {
          // Team member card
          card.innerHTML = `
            <div class="team-member-header">
              <div class="team-member-avatar" style="background: ${avatarColor};">
                ${initials}
              </div>
              <div class="team-member-info">
                <div class="team-member-name">${item.name}</div>
                <div class="team-member-role">${item.subtitle}</div>
              </div>
            </div>
            <div class="team-member-label">${item.customLabel}</div>
          `;
        } else if (currentTab === 'services') {
          // Vendor card with contact info
          const vendorContacts = {
            'Appraisal': { phone: '(555) 123-4567', email: 'contact@appraisalco.com', company: 'Premier Appraisal Services' },
            'WDO Inspection': { phone: '(555) 234-5678', email: 'info@wdoinspect.com', company: 'SafeHome Inspections' },
            'Water Test Inspection': { phone: '(555) 345-6789', email: 'service@watertest.com', company: 'AquaClear Testing' },
            'Title Services': { phone: '(555) 456-7890', email: 'title@titleco.com', company: 'Secure Title Company' },
            'Notary Services': { phone: '(555) 567-8901', email: 'notary@notaryservices.com', company: 'Professional Notary Group' }
          };
          
          const contact = vendorContacts[item.name] || { phone: '(555) 000-0000', email: 'info@vendor.com', company: 'Vendor Company' };
          
          card.innerHTML = `
            <div class="team-member-header">
              <div class="team-member-avatar" style="background: ${avatarColor};">
                ${initials}
              </div>
              <div class="team-member-info">
                <div class="team-member-name">${item.name}</div>
                <div class="team-member-role">${contact.company}</div>
              </div>
            </div>
            <div style="margin-top: 0.75rem; color: #94a3b8; font-size: 0.875rem;">
              <div style="margin-bottom: 0.25rem;"> ${contact.phone}</div>
              <div> ${contact.email}</div>
            </div>
            <div class="team-member-label">${item.subtitle}</div>
          `;
        }
        
        content.appendChild(card);
      });
      
      // Show overlay
      overlay.classList.add('active');
    }

    function closeTeamPopup() {
      document.getElementById('teamPopupOverlay').classList.remove('active');
    }

    function closeTeamPopupOnOverlay(event) {
      if (event.target === document.getElementById('teamPopupOverlay')) {
        closeTeamPopup();
      }
    }

    // Store the clicked vendor index for later use
    let clickedVendorIndex = null;

    function openVendorChoice() {
      const overlay = document.getElementById('vendorChoiceOverlay');
      overlay.classList.add('active');
    }

    function closeVendorChoice() {
      document.getElementById('vendorChoiceOverlay').classList.remove('active');
      // Don't reset clickedVendorIndex here - we need it for showVendorChart
    }

    function closeVendorChoiceOnOverlay(event) {
      if (event.target === document.getElementById('vendorChoiceOverlay')) {
        closeVendorChoice();
      }
    }

    function showVendorInfo() {
      // Close choice popup
      closeVendorChoice();
      
      // Open the full vendor info popup (existing team popup functionality)
      const overlay = document.getElementById('teamPopupOverlay');
      const content = document.getElementById('teamPopupContent');
      const title = document.querySelector('.team-popup-title');
      
      title.textContent = 'All Vendors';
      content.innerHTML = '';
      
      const avatarColors = [
        '#3b82f6', '#8b5cf6', '#10b981', '#f59e0b', '#ec4899',
        '#06b6d4', '#f97316', '#a855f7', '#84cc16', '#6366f1'
      ];
      
      const vendorContacts = {
        'Appraisal': { phone: '(555) 123-4567', email: 'contact@appraisalco.com', company: 'Premier Appraisal Services' },
        'WDO Inspection': { phone: '(555) 234-5678', email: 'info@wdoinspect.com', company: 'SafeHome Inspections' },
        'Water Test Inspection': { phone: '(555) 345-6789', email: 'service@watertest.com', company: 'AquaClear Testing' },
        'Title Services': { phone: '(555) 456-7890', email: 'title@titleco.com', company: 'Secure Title Company' },
        'Notary Services': { phone: '(555) 567-8901', email: 'notary@notaryservices.com', company: 'Professional Notary Group' }
      };
      
      services.forEach((item, index) => {
        const initials = item.name.split(' ').map(n => n[0]).join('');
        const avatarColor = avatarColors[item.colorIndex % avatarColors.length];
        const contact = vendorContacts[item.name] || { phone: '(555) 000-0000', email: 'info@vendor.com', company: 'Vendor Company' };
        
        const card = document.createElement('div');
        card.className = 'team-member-card';
        card.innerHTML = `
          <div class="team-member-header">
            <div class="team-member-avatar" style="background: ${avatarColor};">
              ${initials}
            </div>
            <div class="team-member-info">
              <div class="team-member-name">${item.name}</div>
              <div class="team-member-role">${contact.company}</div>
            </div>
          </div>
          <div style="margin-top: 0.75rem; color: #94a3b8; font-size: 0.875rem;">
            <div style="margin-bottom: 0.25rem;"> ${contact.phone}</div>
            <div> ${contact.email}</div>
          </div>
          <div class="team-member-label">${item.subtitle}</div>
        `;
        content.appendChild(card);
      });
      
      overlay.classList.add('active');
    }

    function showVendorChart() {
      // Close choice popup
      closeVendorChoice();
      
      console.log('=== VENDOR CHART DEBUG ===');
      console.log('clickedVendorIndex:', clickedVendorIndex);
      console.log('currentTab:', currentTab);
      console.log('currentData length:', currentData.length);
      
      // Toggle the table for the clicked vendor
      if (clickedVendorIndex !== null) {
        // Small delay to ensure popup is closed before opening table
        setTimeout(() => {
          console.log('About to toggle table for index:', clickedVendorIndex);
          
          const tableElement = document.getElementById(`table-${clickedVendorIndex}`);
          console.log('Table element found:', tableElement);
          
          if (tableElement) {
            console.log('Table current classes:', tableElement.className);
            console.log('Table innerHTML length:', tableElement.innerHTML.length);
            console.log('Table offsetHeight:', tableElement.offsetHeight);
            console.log('Table style.maxHeight:', tableElement.style.maxHeight);
            
            // Get computed styles
            const computedStyle = window.getComputedStyle(tableElement);
            console.log('Computed maxHeight:', computedStyle.maxHeight);
            console.log('Computed opacity:', computedStyle.opacity);
            console.log('Computed display:', computedStyle.display);
            
            // Force expand the table with inline styles
            tableElement.classList.add('expanded');
            tableElement.style.maxHeight = '600px';
            tableElement.style.opacity = '1';
            tableElement.style.marginTop = '0';
            
            currentOpenTable = clickedVendorIndex; // Track the open table
            console.log('Table classes after adding expanded:', tableElement.className);
            
            // Check styles after forcing expansion
            setTimeout(() => {
              const computedStyleAfter = window.getComputedStyle(tableElement);
              console.log('After - Computed maxHeight:', computedStyleAfter.maxHeight);
              console.log('After - Computed opacity:', computedStyleAfter.opacity);
              console.log('After - Table offsetHeight:', tableElement.offsetHeight);
            }, 50);
            
            
            // Scroll the table into view
            setTimeout(() => {
              console.log('Scrolling table into view');
              console.log('Final offsetHeight:', tableElement.offsetHeight);
              tableElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 500);
          } else {
            console.log('ERROR: Table element not found for index:', clickedVendorIndex);
            console.log('Checking all table elements in DOM...');
            const allTables = document.querySelectorAll('.table-container');
            console.log('Found', allTables.length, 'table containers');
            allTables.forEach((table, i) => {
              console.log(`Table ${i} id:`, table.id);
            });
          }
          
          // Reset after use
          clickedVendorIndex = null;
        }, 100);
      } else {
        console.log('ERROR: clickedVendorIndex is null!');
      }
    }

    function showVendorTracker() {
      // Close choice popup
      closeVendorChoice();
      
      // Show the inline service tracker
      showTrackServices();
    }

    function closeVendorTracker() {
      document.getElementById('vendorTrackerOverlay').classList.remove('active');
    }

    function closeVendorTrackerOnOverlay(event) {
      if (event.target === document.getElementById('vendorTrackerOverlay')) {
        closeVendorTracker();
      }
    }

    function showChoice() {
      document.getElementById('choiceStep').style.display = 'block';
      document.getElementById('requestStep').style.display = 'none';
      document.getElementById('clearStep').style.display = 'none';
      document.getElementById('activityFilterStep').style.display = 'none';
    }

    function showRequestDocs() {
      document.getElementById('choiceStep').style.display = 'none';
      document.getElementById('requestStep').style.display = 'block';
      document.getElementById('clearStep').style.display = 'none';
      document.getElementById('activityFilterStep').style.display = 'none';
    }

    function showClearDocs() {
      document.getElementById('choiceStep').style.display = 'none';
      document.getElementById('requestStep').style.display = 'none';
      document.getElementById('clearStep').style.display = 'block';
      document.getElementById('activityFilterStep').style.display = 'none';
      populateClearDocsList();
    }

    function toggleCustomDateRange() {
      const period = document.getElementById('activityPeriod').value;
      const customGroup = document.getElementById('customDateRangeGroup');
      const fromDate = document.getElementById('fromDate');
      const toDate = document.getElementById('toDate');
      
      if (period === 'custom') {
        customGroup.style.display = 'block';
        fromDate.required = true;
        toDate.required = true;
      } else {
        customGroup.style.display = 'none';
        fromDate.required = false;
        toDate.required = false;
      }
    }

    function handleActivityFilter(event) {
      event.preventDefault();
      const period = document.getElementById('activityPeriod').value;
      const fromDate = document.getElementById('fromDate').value;
      const toDate = document.getElementById('toDate').value;
      
      console.log('Activity Filter:', { period, fromDate, toDate });
      
      // In a real app, this would filter the activity data
      closeModal();
      return false;
    }

    function showTrackServices() {
      closeModal();
      const trackerContainer = document.getElementById('serviceTrackerContainer');
      trackerContainer.classList.add('active');
      
      // Scroll to tracker
      setTimeout(() => {
        trackerContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 100);
      
      // Populate tracker data
      renderServiceTrackers();
    }

    function renderServiceTrackers() {
      const trackersContent = document.getElementById('serviceTrackersContent');
      
      const serviceTrackers = [
        {
          name: 'Appraisal',
          milestones: [
            { label: 'Service Ordered', completed: true },
            { label: 'Service Completed', completed: true },
            { label: 'Report Reviewed', completed: true },
            { label: 'Report Cleared', completed: true }
          ]
        },
        {
          name: 'WDO Inspection',
          milestones: [
            { label: 'Service Ordered', completed: true },
            { label: 'Service Completed', completed: true },
            { label: 'Report Reviewed', completed: false },
            { label: 'Report Cleared', completed: false }
          ]
        },
        {
          name: 'Water Test Inspection',
          milestones: [
            { label: 'Service Ordered', completed: true },
            { label: 'Service Completed', completed: false },
            { label: 'Report Reviewed', completed: false },
            { label: 'Report Cleared', completed: false }
          ]
        }
      ];
      
      trackersContent.innerHTML = serviceTrackers.map(service => {
        const completedMilestones = service.milestones.filter(m => m.completed);
        const totalMilestones = service.milestones.length;
        const progressPercent = (completedMilestones.length / totalMilestones) * 100;
        const isComplete = progressPercent === 100;
        
        // Padding percentages - start 8% in, end 8% before the end
        const startPadding = 8;
        const endPadding = 8;
        const usableRange = 100 - startPadding - endPadding; // 84%
        
        // Calculate where the last completed milestone is
        const lastCompletedIndex = completedMilestones.length > 0 
          ? service.milestones.findIndex(m => m.label === completedMilestones[completedMilestones.length - 1].label)
          : -1;
        
        // Progress bar extends to the last completed milestone position
        let progressBarWidth;
        if (isComplete) {
          progressBarWidth = 'calc(100% - 3.5rem)'; // Full width for 100%
        } else if (lastCompletedIndex >= 0) {
          const positionInRange = (lastCompletedIndex / (totalMilestones - 1)) * usableRange;
          const endPosition = startPadding + positionInRange;
          progressBarWidth = `calc((100% - 3.5rem) * ${endPosition / 100})`;
        } else {
          progressBarWidth = '0';
        }
        
        return `
          <div class="service-wrapper">
            <div class="service-name">${service.name}</div>
            <div class="progress-timeline">
              <div class="progress-line-background"></div>
              <div class="progress-line" style="width: ${progressBarWidth};"></div>
              <div class="milestones-container" style="width: calc(100% - 3.5rem);">
                ${completedMilestones.map((milestone, index) => {
                  // Find the original index of this milestone in the full list
                  const originalIndex = service.milestones.findIndex(m => m.label === milestone.label);
                  // Calculate position based on original index, not completed index
                  const positionInRange = (originalIndex / (totalMilestones - 1)) * usableRange;
                  const position = startPadding + positionInRange;
                  return `
                    <div class="milestone" style="position: absolute; left: ${position}%; transform: translateX(-50%);">
                      <div class="milestone-circle"></div>
                      <div class="milestone-label">${milestone.label}</div>
                      <div class="milestone-date">10/24/2025</div>
                    </div>
                  `;
                }).join('')}
              </div>
              <div class="progress-percentage ${isComplete ? 'complete' : ''}">${Math.round(progressPercent)}%</div>
            </div>
          </div>
        `;
      }).join('');
    }

    function toggleTrackerDropdown() {
      const dropdown = document.getElementById('trackerDropdown');
      dropdown.classList.toggle('active');
    }

    function selectTrackerFilter(filter) {
      const trackerTitle = document.querySelector('.tracker-title');
      
      if (filter === 'pending') {
        trackerTitle.childNodes[0].textContent = 'Pending Services ';
      } else if (filter === 'completed') {
        trackerTitle.childNodes[0].textContent = 'Completed Services ';
      } else {
        trackerTitle.childNodes[0].textContent = 'See All ';
      }
      
      document.getElementById('trackerDropdown').classList.remove('active');
    }

    function closeServiceTracker() {
      const trackerContainer = document.getElementById('serviceTrackerContainer');
      trackerContainer.classList.remove('active');
    }

    function toggleLoanTimeline() {
      const timelineContainer = document.getElementById('loanTimelineContainer');
      
      if (timelineContainer.classList.contains('active')) {
        timelineContainer.classList.remove('active');
      } else {
        timelineContainer.classList.add('active');
        
        // Scroll to timeline
        setTimeout(() => {
          timelineContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);
        
        // Populate timeline data
        renderLoanTimeline();
      }
    }

    function closeLoanTimeline() {
      const timelineContainer = document.getElementById('loanTimelineContainer');
      timelineContainer.classList.remove('active');
    }

    function renderLoanTimeline() {
      const timelineContent = document.getElementById('loanTimelineContent');
      
      const loanMilestones = [
        { label: 'Quote', completed: true },
        { label: 'Loan Prep', completed: true },
        { label: 'Loan Start', completed: true },
        { label: 'Initial Approval', completed: true },
        { label: 'Appraisal Ordered', completed: true },
        { label: 'Final Approval', completed: false },
        { label: 'Clear to Close', completed: false },
        { label: 'Funding', completed: false }
      ];
      
      const completedMilestones = loanMilestones.filter(m => m.completed);
      const totalMilestones = loanMilestones.length;
      const progressPercent = (completedMilestones.length / totalMilestones) * 100;
      const isComplete = progressPercent === 100;
      
      // Padding percentages
      const startPadding = 8;
      const endPadding = 8;
      const usableRange = 100 - startPadding - endPadding;
      
      // Calculate where the last completed milestone is
      const lastCompletedIndex = completedMilestones.length > 0 
        ? loanMilestones.findIndex(m => m.label === completedMilestones[completedMilestones.length - 1].label)
        : -1;
      
      // Progress bar extends to the last completed milestone position
      let progressBarWidth;
      if (isComplete) {
        progressBarWidth = 'calc(100% - 3.5rem)';
      } else if (lastCompletedIndex >= 0) {
        const positionInRange = (lastCompletedIndex / (totalMilestones - 1)) * usableRange;
        const endPosition = startPadding + positionInRange;
        progressBarWidth = `calc((100% - 3.5rem) * ${endPosition / 100})`;
      } else {
        progressBarWidth = '0';
      }
      
      timelineContent.innerHTML = `
        <div class="service-wrapper">
          <div class="progress-timeline">
            <div class="progress-line-background"></div>
            <div class="progress-line" style="width: ${progressBarWidth};"></div>
            <div class="milestones-container" style="width: calc(100% - 3.5rem);">
              ${completedMilestones.map((milestone, index) => {
                const originalIndex = loanMilestones.findIndex(m => m.label === milestone.label);
                const positionInRange = (originalIndex / (totalMilestones - 1)) * usableRange;
                const position = startPadding + positionInRange;
                return `
                  <div class="milestone" style="position: absolute; left: ${position}%; transform: translateX(-50%);">
                    <div class="milestone-circle"></div>
                    <div class="milestone-label">${milestone.label}</div>
                    <div class="milestone-date">10/24/2025</div>
                  </div>
                `;
              }).join('')}
            </div>
            <div class="progress-percentage ${isComplete ? 'complete' : ''}">${Math.round(progressPercent)}%</div>
          </div>
        </div>
      `;
    }

    function populateClearDocsList() {
      const list = document.getElementById('clearDocsList');
      list.innerHTML = '';
      
      documents.forEach((doc, index) => {
        const item = document.createElement('label');
        item.className = 'doc-checkbox-item';
        item.innerHTML = `
          <input type="checkbox" value="${index}" name="clearDoc">
          <span class="doc-checkbox-label">${doc.name}</span>
        `;
        list.appendChild(item);
      });
    }

    // Request Docs Submit
    function handleRequestSubmit(event) {
      event.preventDefault();
      
      try {
        const form = event.target;
        const documentName = form.querySelector('input[type="text"]').value;
        const categorySelect = form.querySelectorAll('.form-select')[1];
        const category = categorySelect.options[categorySelect.selectedIndex].text;
        
        const newColorIndex = documents.length % documentColors.length;
        documents.push({
          name: documentName,
          subtitle: category,
          colorIndex: newColorIndex
        });
        
        updateDocumentsList();
        updateStackIcon();
        
        form.reset();
        closeModal();
        
        setTimeout(() => {
          alert('Document "' + documentName + '" requested successfully!');
        }, 100);
      } catch (error) {
        console.error('Error adding document:', error);
        alert('Error adding document. Please try again.');
      }
      
      return false;
    }

    // Clear Docs Submit
    function handleClearSubmit(event) {
      event.preventDefault();
      
      try {
        const checkboxes = document.querySelectorAll('input[name="clearDoc"]:checked');
        const indicesToRemove = Array.from(checkboxes).map(cb => parseInt(cb.value)).sort((a, b) => b - a);
        
        if (indicesToRemove.length === 0) {
          alert('Please select at least one document to clear.');
          return false;
        }
        
        // Remove documents in reverse order to maintain correct indices
        indicesToRemove.forEach(index => {
          documents.splice(index, 1);
        });
        
        updateDocumentsList();
        updateStackIcon();
        
        event.target.reset();
        closeModal();
        
        setTimeout(() => {
          alert(indicesToRemove.length + ' document(s) cleared successfully!');
        }, 100);
      } catch (error) {
        console.error('Error clearing documents:', error);
        alert('Error clearing documents. Please try again.');
      }
      
      return false;
    }

    let sortConfigs = {}; // Track sort config for each table
    let currentOpenTable = null;

    function updateDocumentsList() {
      const docsList = document.querySelector('.docs-list');
      const tablesContainer = document.getElementById('tablesContainer');
      docsList.innerHTML = '';
      tablesContainer.innerHTML = '';
      
      // Check if we need scrolling (more than 3 items)
      const needsScroll = currentData.length > 3;
      
      // Create container for items
      const itemsContainer = needsScroll ? document.createElement('div') : docsList;
      if (needsScroll) {
        itemsContainer.className = 'docs-list-scrollable';
      }
      
      currentData.forEach((doc, index) => {
        const color = documentColors[doc.colorIndex];
        const docItem = document.createElement('div');
        docItem.className = 'doc-item';
        docItem.onclick = () => toggleTable(index);
        
        // Eye icon functionality - only for team and services tabs
        const eyeIconOnclick = (currentTab === 'team' || currentTab === 'services') 
          ? `onclick="event.stopPropagation(); clickedVendorIndex = ${index}; openTeamPopup();"` 
          : '';
        
        docItem.innerHTML = `
          <svg class="magnify-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" onclick="event.stopPropagation(); console.log('Search clicked for index:', ${index});">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
            <span class="icon-tooltip">Search</span>
          </svg>
          <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" ${eyeIconOnclick}>
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
            <span class="icon-tooltip">See Chart</span>
          </svg>
          <div class="doc-item-content">
            <div class="accent-line" style="background: ${color.gradient}; box-shadow: 0 0 10px ${color.shadow};"></div>
            <div class="doc-content">
              <div class="doc-title">${doc.name}</div>
              <div class="doc-subtitle">${doc.subtitle}</div>
            </div>
          </div>
          ${doc.customLabel ? 
            '<div class="doc-date custom-label-date">' + doc.customLabel + ': 10/24/2025</div>' 
          : 
            '<div class="doc-date">10/24/2025</div>'
          }
          <div class="doc-count-badge">${doc.tableData.length}</div>
        `;
        itemsContainer.appendChild(docItem);
        
        
        // Add table container to the separate tables container
        const tablesContainer = document.getElementById('tablesContainer');
        const tableContainer = document.createElement('div');
        tableContainer.className = 'table-container';
        tableContainer.id = `table-${index}`;
        tableContainer.innerHTML = `
          <div class="table-wrapper">
            <div class="table-header">
              <div class="table-title-dropdown-wrapper">
                <h3 class="table-title clickable-title" onclick="toggleTitleDropdown(${index})">
                  ${currentTab === 'docs' ? 'Documents Pending' : currentTab === 'services' ? 'Vendor Chart' : currentTab === 'ratelock' ? 'Rate Lock Details' : currentTab === 'team' ? 'Team Member Details' : 'notes' ? 'Note Records' : 'Activity Details'}
                  <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="m6 9 6 6 6-6"/>
                  </svg>
                </h3>
                <div class="title-dropdown-menu" id="title-dropdown-${index}">
                  <div class="dropdown-option" onclick="selectFilter(${index}, 'pending')">${currentTab === 'docs' ? 'Documents Pending' : currentTab === 'services' ? 'Vendor Chart' : currentTab === 'ratelock' ? 'Rate Lock Details' : currentTab === 'team' ? 'Team Member Details' : 'notes' ? 'Note Records' : 'Activity Details'}</div>
                  <div class="dropdown-option" onclick="selectFilter(${index}, 'received')">${currentTab === 'docs' ? 'Documents Received' : currentTab === 'services' ? 'Completed Services' : currentTab === 'ratelock' ? 'Rate Lock History' : currentTab === 'team' ? 'Team History' : 'Activity History'}</div>
                  <div class="dropdown-option" onclick="selectFilter(${index}, 'all')">Show All</div>
                </div>
              </div>
              <button class="close-table-btn" onclick="event.stopPropagation(); closeTable(${index})"></button>
            </div>
            
            <div class="scroll-track" id="scroll-track-${index}">
              <div class="scroll-indicator" id="scroll-indicator-${index}" style="width: 30%"></div>
            </div>
            
            <div class="scrollbar-custom" id="table-scroll-${index}" style="overflow-x: auto;">
              <div class="table-scroll-wrapper">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th onclick="sortTable(${index}, 'requestDate')">
                        Request Date
                        <svg class="sort-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="m7 15 5 5 5-5M7 9l5-5 5 5"/>
                        </svg>
                      </th>
                      <th onclick="sortTable(${index}, 'status')">
                        Status
                        <svg class="sort-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="m7 15 5 5 5-5M7 9l5-5 5 5"/>
                        </svg>
                      </th>
                      <th onclick="sortTable(${index}, 'documentRequested')">
                        Document Requested
                        <svg class="sort-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="m7 15 5 5 5-5M7 9l5-5 5 5"/>
                        </svg>
                      </th>
                      <th onclick="sortTable(${index}, 'loanCategory')">
                        Loan Category
                        <svg class="sort-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="m7 15 5 5 5-5M7 9l5-5 5 5"/>
                        </svg>
                      </th>
                      <th onclick="sortTable(${index}, 'loanPurpose')">
                        Loan Purpose
                        <svg class="sort-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="m7 15 5 5 5-5M7 9l5-5 5 5"/>
                        </svg>
                      </th>
                      <th onclick="sortTable(${index}, 'loanStage')">
                        Loan Stage
                        <svg class="sort-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="m7 15 5 5 5-5M7 9l5-5 5 5"/>
                        </svg>
                      </th>
                      <th onclick="sortTable(${index}, 'requestedBy')">
                        Requested By
                        <svg class="sort-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="m7 15 5 5 5-5M7 9l5-5 5 5"/>
                        </svg>
                      </th>
                      <th onclick="sortTable(${index}, 'clearedBy')">
                        Cleared By
                        <svg class="sort-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="m7 15 5 5 5-5M7 9l5-5 5 5"/>
                        </svg>
                      </th>
                      <th onclick="sortTable(${index}, 'attachedDoc')">
                        Attached Doc
                        <svg class="sort-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="m7 15 5 5 5-5M7 9l5-5 5 5"/>
                        </svg>
                      </th>
                    </tr>
                  </thead>
                  <tbody id="table-body-${index}">
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        `;
        tablesContainer.appendChild(tableContainer);
        
        // Initialize sort config
        sortConfigs[index] = { key: null, direction: 'asc' };
        
        // Render initial table data
        renderTableData(index);
        
        // Setup scroll sync
        setupScrollSync(index);
      });
      
      // If scrollable, add the container
      if (needsScroll) {
        docsList.appendChild(itemsContainer);
      }
    }

    function renderTableData(index) {
      const tbody = document.getElementById(`table-body-${index}`);
      const doc = currentData[index];
      const sortConfig = sortConfigs[index];
      
      let sortedData = [...doc.tableData];
      
      if (sortConfig.key) {
        sortedData.sort((a, b) => {
          const aValue = a[sortConfig.key];
          const bValue = b[sortConfig.key];
          
          if (aValue < bValue) return sortConfig.direction === 'asc' ? -1 : 1;
          if (aValue > bValue) return sortConfig.direction === 'asc' ? 1 : -1;
          return 0;
        });
      }
      
      tbody.innerHTML = sortedData.map(row => `
        <tr>
          <td>${row.requestDate}</td>
          <td><span class="status-pending">Pending</span></td>
          <td>${row.documentRequested}</td>
          <td>${row.loanCategory}</td>
          <td>${row.loanPurpose}</td>
          <td>${row.loanStage}</td>
          <td>${row.requestedBy}</td>
          <td>${row.clearedBy}</td>
          <td>${row.attachedDoc}</td>
        </tr>
      `).join('');
    }

    function sortTable(index, key) {
      const sortConfig = sortConfigs[index];
      
      if (sortConfig.key === key) {
        sortConfig.direction = sortConfig.direction === 'asc' ? 'desc' : 'asc';
      } else {
        sortConfig.key = key;
        sortConfig.direction = 'asc';
      }
      
      renderTableData(index);
    }

    function setupScrollSync(index) {
      const scrollContainer = document.getElementById(`table-scroll-${index}`);
      const indicator = document.getElementById(`scroll-indicator-${index}`);
      const track = document.getElementById(`scroll-track-${index}`);
      
      scrollContainer.addEventListener('scroll', () => {
        const scrollPercentage = scrollContainer.scrollLeft / (scrollContainer.scrollWidth - scrollContainer.clientWidth);
        const thumbWidth = (scrollContainer.clientWidth / scrollContainer.scrollWidth) * 100;
        indicator.style.width = `${Math.max(thumbWidth, 10)}%`;
        indicator.style.transform = `translateX(${scrollPercentage * (100 / Math.max(thumbWidth, 10) - 1) * 100}%)`;
      });
      
      // Draggable indicator
      indicator.addEventListener('mousedown', (e) => {
        e.stopPropagation();
        const startX = e.clientX;
        const startScrollLeft = scrollContainer.scrollLeft;
        const trackWidth = track.offsetWidth;
        const scrollWidth = scrollContainer.scrollWidth - scrollContainer.clientWidth;
        
        const handleMouseMove = (e) => {
          const deltaX = e.clientX - startX;
          const scrollDelta = (deltaX / trackWidth) * scrollWidth;
          scrollContainer.scrollLeft = startScrollLeft + scrollDelta;
        };
        
        const handleMouseUp = () => {
          document.removeEventListener('mousemove', handleMouseMove);
          document.removeEventListener('mouseup', handleMouseUp);
        };
        
        document.addEventListener('mousemove', handleMouseMove);
        document.addEventListener('mouseup', handleMouseUp);
      });
      
      // Click on track to jump
      track.addEventListener('click', (e) => {
        const rect = track.getBoundingClientRect();
        const clickX = e.clientX - rect.left;
        const percentage = clickX / rect.width;
        scrollContainer.scrollLeft = percentage * (scrollContainer.scrollWidth - scrollContainer.clientWidth);
      });
    }

    function toggleTable(index) {
      const tableContainer = document.getElementById(`table-${index}`);
      
      if (currentOpenTable !== null && currentOpenTable !== index) {
        closeTable(currentOpenTable);
      }
      
      if (tableContainer.classList.contains('expanded')) {
        closeTable(index);
      } else {
        tableContainer.classList.add('expanded');
        currentOpenTable = index;
      }
    }

    function toggleTitleDropdown(index) {
      const dropdown = document.getElementById(`title-dropdown-${index}`);
      const wasActive = dropdown.classList.contains('active');
      
      // Close all dropdowns first
      document.querySelectorAll('.title-dropdown-menu').forEach(menu => {
        menu.classList.remove('active');
      });
      
      // Toggle the clicked one
      if (!wasActive) {
        dropdown.classList.add('active');
      }
    }

    function selectFilter(index, filterValue) {
      // Update the title based on selection
      const tableTitle = document.querySelector(`#table-${index} .clickable-title`);
      const dropdownArrow = tableTitle.querySelector('.dropdown-arrow');
      
      if (filterValue === 'pending') {
        if (currentTab === 'docs') {
          tableTitle.childNodes[0].textContent = 'Documents Pending ';
        } else if (currentTab === 'services') {
          tableTitle.childNodes[0].textContent = 'Pending Services ';
        } else if (currentTab === 'ratelock') {
          tableTitle.childNodes[0].textContent = 'Rate Lock Details ';
        } else if (currentTab === 'team') {
          tableTitle.childNodes[0].textContent = 'Team Member Details ';
        } else if (currentTab === 'activity') {
          tableTitle.childNodes[0].textContent = 'Activity Details ';
        }
      } else if (filterValue === 'received') {
        if (currentTab === 'docs') {
          tableTitle.childNodes[0].textContent = 'Documents Received ';
        } else if (currentTab === 'services') {
          tableTitle.childNodes[0].textContent = 'Completed Services ';
        } else if (currentTab === 'ratelock') {
          tableTitle.childNodes[0].textContent = 'Rate Lock History ';
        } else if (currentTab === 'team') {
          tableTitle.childNodes[0].textContent = 'Team History ';
        } else if (currentTab === 'activity') {
          tableTitle.childNodes[0].textContent = 'Activity History ';
        }
      } else {
        tableTitle.childNodes[0].textContent = 'Show All ';
      }
      
      // Close the dropdown
      document.getElementById(`title-dropdown-${index}`).classList.remove('active');
      
      // Re-render table data (in future this would actually filter)
      renderTableData(index);
    }

    // Close dropdowns when clicking outside
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.table-title-dropdown-wrapper')) {
        document.querySelectorAll('.title-dropdown-menu').forEach(menu => {
          menu.classList.remove('active');
        });
      }
    });

    function closeTable(index) {
      const tableContainer = document.getElementById(`table-${index}`);
      if (tableContainer) {
        tableContainer.classList.remove('expanded');
        // Remove inline styles that were added by showVendorChart
        tableContainer.style.maxHeight = '';
        tableContainer.style.opacity = '';
        tableContainer.style.marginTop = '';
        if (currentOpenTable === index) {
          currentOpenTable = null;
        }
      }
    }

    function updateStackIcon() {
      const svg = document.getElementById('stackedIcon');
      
      console.log('Updating stack icon, currentTab:', currentTab);
      svg.innerHTML = '';
      
      
      // Handle no tab selected
      if (!currentTab) {
        svg.style.display = 'none';
        return;
      }
      // Show all icon boxes only on loandetails tab, but also show the main SVG
      if (currentTab === 'loandetails') {
        svg.style.display = 'block'; // Show the main stack icon for loandetails too
      } else if (currentTab === 'figures') {
        svg.style.display = 'block'; // Show the main stack icon
      } else if (currentTab === 'docs') {
        svg.style.display = 'block'; // Show the main stack icon
      } else {
        svg.style.display = 'block'; // Show the main stack icon
      }
      
      if (currentTab === 'ratelock') {
        // Show lock icon matching the uploaded image style
        // Show locked/unlocked filter icons
        // Lock body (rounded rectangle with gradient)
        const lockBody = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
        lockBody.setAttribute('x', '5');
        lockBody.setAttribute('y', '13');
        lockBody.setAttribute('width', '14');
        lockBody.setAttribute('height', '10');
        lockBody.setAttribute('rx', '2');
        lockBody.setAttribute('fill', '#10b981');
        lockBody.setAttribute('stroke', '#475569');
        lockBody.setAttribute('stroke-width', '1.5');
        
        // Shackle (rounded U-shape)
        const shackle = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        shackle.setAttribute('d', 'M8.5 13V9.5C8.5 7.5 9.8 6 12 6C14.2 6 15.5 7.5 15.5 9.5V13');
        shackle.setAttribute('stroke', '#475569');
        shackle.setAttribute('stroke-width', '2.5');
        shackle.setAttribute('fill', 'none');
        shackle.setAttribute('stroke-linecap', 'round');
        
        // Keyhole - circle part
        const keyholeCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        keyholeCircle.setAttribute('cx', '12');
        keyholeCircle.setAttribute('cy', '17');
        keyholeCircle.setAttribute('r', '1.5');
        keyholeCircle.setAttribute('fill', '#475569');
        
        // Keyhole - slot part
        const keyholeSlot = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
        keyholeSlot.setAttribute('x', '11.3');
        keyholeSlot.setAttribute('y', '17.5');
        keyholeSlot.setAttribute('width', '1.4');
        keyholeSlot.setAttribute('height', '2.5');
        keyholeSlot.setAttribute('rx', '0.3');
        keyholeSlot.setAttribute('fill', '#475569');
        
        svg.appendChild(shackle);
        svg.appendChild(lockBody);
        svg.appendChild(keyholeCircle);
        svg.appendChild(keyholeSlot);
      } else if (currentTab === 'services') {
        // Show clipboard checklist icon for Services
        console.log('Drawing services checklist icon');
        // Show vendor filter icons
        // Clipboard board (outer rounded rectangle)
        const clipboardBoard = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
        clipboardBoard.setAttribute('x', '4');
        clipboardBoard.setAttribute('y', '6');
        clipboardBoard.setAttribute('width', '16');
        clipboardBoard.setAttribute('height', '16');
        clipboardBoard.setAttribute('rx', '2');
        clipboardBoard.setAttribute('fill', 'none');
        clipboardBoard.setAttribute('stroke', '#3b82f6');
        clipboardBoard.setAttribute('stroke-width', '1.5');
        
        // Clipboard clip (top)
        const clip = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
        clip.setAttribute('x', '9');
        clip.setAttribute('y', '4');
        clip.setAttribute('width', '6');
        clip.setAttribute('height', '3');
        clip.setAttribute('rx', '1');
        clip.setAttribute('fill', '#f59e0b');
        clip.setAttribute('stroke', '#3b82f6');
        clip.setAttribute('stroke-width', '1.5');
        
        // Checkmark 1
        const check1 = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        check1.setAttribute('d', 'M7 11L9 13L13 9');
        check1.setAttribute('stroke', '#3b82f6');
        check1.setAttribute('stroke-width', '1.5');
        check1.setAttribute('fill', 'none');
        check1.setAttribute('stroke-linecap', 'round');
        check1.setAttribute('stroke-linejoin', 'round');
        
        // Checkmark 2
        const check2 = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        check2.setAttribute('d', 'M7 15L9 17L13 13');
        check2.setAttribute('stroke', '#3b82f6');
        check2.setAttribute('stroke-width', '1.5');
        check2.setAttribute('fill', 'none');
        check2.setAttribute('stroke-linecap', 'round');
        check2.setAttribute('stroke-linejoin', 'round');
        
        // Line 1
        const line1 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        line1.setAttribute('x1', '14');
        line1.setAttribute('y1', '11');
        line1.setAttribute('x2', '17');
        line1.setAttribute('y2', '11');
        line1.setAttribute('stroke', '#3b82f6');
        line1.setAttribute('stroke-width', '1.5');
        line1.setAttribute('stroke-linecap', 'round');
        
        // Line 2
        const line2 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        line2.setAttribute('x1', '14');
        line2.setAttribute('y1', '15');
        line2.setAttribute('x2', '17');
        line2.setAttribute('y2', '15');
        line2.setAttribute('stroke', '#3b82f6');
        line2.setAttribute('stroke-width', '1.5');
        line2.setAttribute('stroke-linecap', 'round');
        
        svg.appendChild(clipboardBoard);
        svg.appendChild(clip);
        svg.appendChild(check1);
        svg.appendChild(check2);
        svg.appendChild(line1);
        svg.appendChild(line2);
      } else if (currentTab === 'team') {
        // Show static stacked papers icon for Team (not dynamic)
        const baseY = 8;
        const spacing = 4;
        const colors = [
          documentColors[0], // Blue
          documentColors[1], // Purple
          documentColors[2]  // Green
        ];
        
        colors.forEach((color, index) => {
          const yPos = baseY + (index * spacing);
          
          const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
          if (index === 0) {
            path.setAttribute('d', `M3 ${yPos}L12 ${yPos - 5}L21 ${yPos}L12 ${yPos + 5}L3 ${yPos}Z`);
          } else {
            path.setAttribute('d', `M3 ${yPos}L12 ${yPos + 5}L21 ${yPos}`);
          }
          path.setAttribute('stroke', color.color);
          path.setAttribute('stroke-width', '1.5');
          path.setAttribute('stroke-linecap', 'round');
          path.setAttribute('stroke-linejoin', 'round');
          path.setAttribute('fill', 'none');
          
          svg.appendChild(path);
        });
      } else if (currentTab === 'activity') {
        // Show phone and paper icons for Activity tab
        // Show static stacked papers icon for Activity (not dynamic)
        const baseY = 8;
        const spacing = 4;
        const colors = [
          documentColors[0], // Blue
          documentColors[1], // Purple
          documentColors[2]  // Green
        ];
        
        colors.forEach((color, index) => {
          const yPos = baseY + (index * spacing);
          
          const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
          if (index === 0) {
            path.setAttribute('d', `M3 ${yPos}L12 ${yPos - 5}L21 ${yPos}L12 ${yPos + 5}L3 ${yPos}Z`);
          } else {
            path.setAttribute('d', `M3 ${yPos}L12 ${yPos + 5}L21 ${yPos}`);
          }
          path.setAttribute('stroke', color.color);
          path.setAttribute('stroke-width', '1.5');
          path.setAttribute('stroke-linecap', 'round');
          path.setAttribute('stroke-linejoin', 'round');
          path.setAttribute('fill', 'none');
          
          svg.appendChild(path);
        });
      } else if (currentTab === 'loandetails') {
        // Show static stacked papers icon for Loan Details (not dynamic)
        const baseY = 8;
        const spacing = 4;
        const colors = [
          documentColors[0], // Blue
          documentColors[1], // Purple
          documentColors[2]  // Green
        ];
        
        colors.forEach((color, index) => {
          const yPos = baseY + (index * spacing);
          
          const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
          if (index === 0) {
            path.setAttribute('d', `M3 ${yPos}L12 ${yPos - 5}L21 ${yPos}L12 ${yPos + 5}L3 ${yPos}Z`);
          } else {
            path.setAttribute('d', `M3 ${yPos}L12 ${yPos + 5}L21 ${yPos}`);
          }
          path.setAttribute('stroke', color.color);
          path.setAttribute('stroke-width', '1.5');
          path.setAttribute('stroke-linecap', 'round');
          path.setAttribute('stroke-linejoin', 'round');
          path.setAttribute('fill', 'none');
          
          svg.appendChild(path);
        });
      } else if (currentTab === 'docs') {
        // Show static stacked papers icon for Docs Pending (not dynamic)
        const baseY = 8;
        const spacing = 4;
        const colors = [
          documentColors[0], // Blue
          documentColors[1], // Purple
          documentColors[2]  // Green
        ];
        
        colors.forEach((color, index) => {
          const yPos = baseY + (index * spacing);
          
          const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
          if (index === 0) {
            path.setAttribute('d', `M3 ${yPos}L12 ${yPos - 5}L21 ${yPos}L12 ${yPos + 5}L3 ${yPos}Z`);
          } else {
            path.setAttribute('d', `M3 ${yPos}L12 ${yPos + 5}L21 ${yPos}`);
          }
          path.setAttribute('stroke', color.color);
          path.setAttribute('stroke-width', '1.5');
          path.setAttribute('stroke-linecap', 'round');
          path.setAttribute('stroke-linejoin', 'round');
          path.setAttribute('fill', 'none');
          
          svg.appendChild(path);
        });
      } else if (currentTab === 'figures') {
        // Show static stacked papers icon for Figures (not dynamic)
        const baseY = 8;
        const spacing = 4;
        const colors = [
          documentColors[0], // Blue
          documentColors[1], // Purple
          documentColors[2]  // Green
        ];
        
        colors.forEach((color, index) => {
          const yPos = baseY + (index * spacing);
          
          const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
          if (index === 0) {
            path.setAttribute('d', `M3 ${yPos}L12 ${yPos - 5}L21 ${yPos}L12 ${yPos + 5}L3 ${yPos}Z`);
          } else {
            path.setAttribute('d', `M3 ${yPos}L12 ${yPos + 5}L21 ${yPos}`);
          }
          path.setAttribute('stroke', color.color);
          path.setAttribute('stroke-width', '1.5');
          path.setAttribute('stroke-linecap', 'round');
          path.setAttribute('stroke-linejoin', 'round');
          path.setAttribute('fill', 'none');
          
          svg.appendChild(path);
        });
      } else if (currentTab === 'notes') {
        // Show static stacked papers icon for Notes (not dynamic)
        const baseY = 8;
        const spacing = 4;
        const colors = [
          documentColors[0], // Blue
          documentColors[1], // Purple
          documentColors[2], // Green
          documentColors[3]  // Amber
        ];
        
        colors.forEach((color, index) => {
          const yPos = baseY + (index * spacing);
          
          const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
          if (index === 0) {
            path.setAttribute('d', `M3 ${yPos}L12 ${yPos - 5}L21 ${yPos}L12 ${yPos + 5}L3 ${yPos}Z`);
          } else {
            path.setAttribute('d', `M3 ${yPos}L12 ${yPos + 5}L21 ${yPos}`);
          }
          path.setAttribute('stroke', color.color);
          path.setAttribute('stroke-width', '1.5');
          path.setAttribute('stroke-linecap', 'round');
          path.setAttribute('stroke-linejoin', 'round');
          path.setAttribute('fill', 'none');
          
          svg.appendChild(path);
        });
      } else {
        // Show stacked papers for other tabs
        const baseY = 8;
        const spacing = 4;
        
        currentData.forEach((doc, index) => {
          const color = documentColors[doc.colorIndex];
          const yPos = baseY + (index * spacing);
          
          console.log(`Creating layer ${index} for ${doc.name} with color ${color.color}`);
          
          const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
          if (index === 0) {
            path.setAttribute('d', `M3 ${yPos}L12 ${yPos - 5}L21 ${yPos}L12 ${yPos + 5}L3 ${yPos}Z`);
          } else {
            path.setAttribute('d', `M3 ${yPos}L12 ${yPos + 5}L21 ${yPos}`);
          }
          path.setAttribute('stroke', color.color);
          path.setAttribute('stroke-width', '1.5');
          path.setAttribute('stroke-linecap', 'round');
          path.setAttribute('stroke-linejoin', 'round');
          path.setAttribute('fill', 'none');
          
          svg.appendChild(path);
        });
      }
      
      console.log('Stack icon updated, SVG children:', svg.children.length);
    }

    let isOverviewMode = false;

    function generateStageCards() {
      const stageCards = document.getElementById('stageCards');
      stageCards.innerHTML = '';
      
      if (currentTab === 'ratelock') {
        // Rate Lock stage cards
        const rateLockStages = [
          { title: 'Locked', count: 'Rate Locked', color: '#3b82f6' },
          { title: '18 Days', count: 'Until Expiration', color: '#8b5cf6' },
          { title: 'Perry Paul', count: 'Locked By', color: '#10b981' }
        ];
        
        rateLockStages.forEach(stage => {
          const card = document.createElement('div');
          card.className = 'stage-card';
          card.setAttribute('data-color', stage.color);
          card.innerHTML = `
            <div class="stage-title">${stage.title}</div>
            <div class="stage-count">${stage.count}</div>
          `;
          stageCards.appendChild(card);
        });
      } else if (currentTab === 'services') {
        // Services stage cards
        const servicesStages = [
          { title: 'Appraisal', count: 'Completed', color: '#3b82f6' },
          { title: 'WDO Inspection', count: 'In Progress', color: '#8b5cf6' },
          { title: 'Water Test', count: 'Pending', color: '#10b981' }
        ];
        
        servicesStages.forEach(stage => {
          const card = document.createElement('div');
          card.className = 'stage-card';
          card.setAttribute('data-color', stage.color);
          card.innerHTML = `
            <div class="stage-title">${stage.title}</div>
            <div class="stage-count">${stage.count}</div>
          `;
          stageCards.appendChild(card);
        });
      } else if (currentTab === 'team') {
        // Team stage cards
        const teamStages = [
          { title: '10 Members', count: 'Active Team', color: '#3b82f6' },
          { title: '8 Roles', count: 'Specialists', color: '#8b5cf6' },
          { title: '100%', count: 'On Track', color: '#10b981' }
        ];
        
        teamStages.forEach(stage => {
          const card = document.createElement('div');
          card.className = 'stage-card';
          card.setAttribute('data-color', stage.color);
          card.innerHTML = `
            <div class="stage-title">${stage.title}</div>
            <div class="stage-count">${stage.count}</div>
          `;
          stageCards.appendChild(card);
        });
      } else if (currentTab === 'activity') {
        // Activity stage cards
        const activityStages = [
          { title: '6 Activities', count: 'Recent', color: '#3b82f6' },
          { title: '3 Uploads', count: 'Documents', color: '#8b5cf6' },
          { title: '3 Reviews', count: 'Completed', color: '#10b981' }
        ];
        
        activityStages.forEach(stage => {
          const card = document.createElement('div');
          card.className = 'stage-card';
          card.setAttribute('data-color', stage.color);
          card.innerHTML = `
            <div class="stage-title">${stage.title}</div>
            <div class="stage-count">${stage.count}</div>
          `;
          stageCards.appendChild(card);
        });
      } else if (currentTab === 'notes') {
        // Show notepad icon for Notes tab
        // Notepad/paper with lines
        const notepadRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
        notepadRect.setAttribute('x', '6');
        notepadRect.setAttribute('y', '4');
        notepadRect.setAttribute('width', '12');
        notepadRect.setAttribute('height', '16');
        notepadRect.setAttribute('rx', '1');
        notepadRect.setAttribute('fill', 'none');
        notepadRect.setAttribute('stroke', '#f59e0b');
        notepadRect.setAttribute('stroke-width', '1.5');
        
        // Note lines
        for (let i = 0; i < 4; i++) {
          const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
          line.setAttribute('x1', '8');
          line.setAttribute('y1', String(8 + i * 3));
          line.setAttribute('x2', '16');
          line.setAttribute('y2', String(8 + i * 3));
          line.setAttribute('stroke', '#f59e0b');
          line.setAttribute('stroke-width', '1');
          line.setAttribute('stroke-linecap', 'round');
          svg.appendChild(line);
        }
        
        svg.appendChild(notepadRect);
      } else {
        // Docs stage cards
        const stages = [
          { title: 'Loan Prep', count: '8 Docs Requested', color: '#3b82f6' },
          { title: 'Initial Approval', count: '4 Docs Requested', color: '#8b5cf6' },
          { title: 'Final Approval', count: '2 Docs Requested', color: '#10b981' }
        ];
        
        stages.forEach(stage => {
          const card = document.createElement('div');
          card.className = 'stage-card';
          card.setAttribute('data-color', stage.color);
          card.innerHTML = `
            <div class="stage-title">${stage.title}</div>
            <div class="stage-count">${stage.count}</div>
          `;
          stageCards.appendChild(card);
        });
      }
    }

    function toggleView() {
      // Special handling for Loan Details tab
      if (currentTab === 'loandetails') {
        isOverviewMode = !isOverviewMode;
        
        const toggleBtn = document.getElementById('viewToggle');
        const toggleIcon = document.getElementById('toggleIcon');
        
        if (isOverviewMode) {
          // Show all loan details (reset filter)
          loanDetailsFilter = null;
          currentData = loandetails;
          
          // Update the list
          const docItems = document.querySelectorAll('.doc-item');
          docItems.forEach((item, index) => {
            setTimeout(() => {
              item.classList.add('rolling-up');
            }, index * 30);
          });
          
          setTimeout(() => {
            updateDocumentsList();
            
            const newDocItems = document.querySelectorAll('.doc-item');
            newDocItems.forEach((item, index) => {
              item.style.opacity = '0';
              setTimeout(() => {
                item.classList.add('rolling-down');
              }, index * 30);
            });
          }, docItems.length * 30 + 200);
          
          // Update toggle icon to show it's active
          toggleIcon.innerHTML = `
            <path d="M4 8h16M4 16h16"/>
          `;
          toggleBtn.classList.add('active');
          
        } else {
          // Return to default filtered state (show first category or all)
          loanDetailsFilter = null;
          currentData = loandetails;
          
          const docItems = document.querySelectorAll('.doc-item');
          docItems.forEach((item, index) => {
            setTimeout(() => {
              item.classList.add('rolling-up');
            }, index * 30);
          });
          
          setTimeout(() => {
            updateDocumentsList();
            
            const newDocItems = document.querySelectorAll('.doc-item');
            newDocItems.forEach((item, index) => {
              item.style.opacity = '0';
              setTimeout(() => {
                item.classList.add('rolling-down');
              }, index * 30);
            });
          }, docItems.length * 30 + 200);
          
          // Update toggle icon back to default
          toggleIcon.innerHTML = `
            <path d="M3 8L12 3L21 8L12 13L3 8Z"/>
            <path d="M3 12L12 17L21 12"/>
            <path d="M3 16L12 21L21 16"/>
          `;
          toggleBtn.classList.remove('active');
        }
        
        return; // Exit early for loan details tab
      }
      
      // Original behavior for other tabs
      isOverviewMode = !isOverviewMode;
      
      const docsList = document.getElementById('docsList');
      const stageCards = document.getElementById('stageCards');
      const stackedIcon = document.getElementById('stackedIcon');
      const pieChartContainer = document.getElementById('pieChartContainer');
      const toggleBtn = document.getElementById('viewToggle');
      const toggleIcon = document.getElementById('toggleIcon');
      
      if (isOverviewMode) {
        // Switch to overview mode
        // Fade out detail view
        docsList.classList.add('fade-out');
        
        setTimeout(() => {
          docsList.style.display = 'none';
          
          // Generate stage cards based on current tab
          generateStageCards();
          
          // Show overview view
          stageCards.style.display = 'flex';
          
          setTimeout(() => {
            stageCards.classList.remove('fade-out');
            stageCards.classList.add('fade-in');
            stageCards.style.opacity = '1';
          }, 50);
        }, 300);
        
        // Morph stack icon into pie chart
        stackedIcon.style.opacity = '0';
        stackedIcon.style.transform = 'scale(0.8) rotate(180deg)';
        
        setTimeout(() => {
          pieChartContainer.style.display = 'flex';
          setTimeout(() => {
            pieChartContainer.style.opacity = '1';
            pieChartContainer.style.transform = 'scale(1) rotate(0deg)';
          }, 50);
        }, 300);
        
        // Update toggle icon to pie chart
        toggleIcon.innerHTML = `
          <circle cx="12" cy="12" r="10"/>
          <path d="M12 2a10 10 0 0 1 10 10L12 12Z"/>
        `;
        toggleBtn.classList.add('active');
        
        // Generate pie chart
        generatePieChart();
        
      } else {
        // Switch back to detail view
        // Fade out overview
        stageCards.classList.add('fade-out');
        
        setTimeout(() => {
          stageCards.style.display = 'none';
          
          // Show detail view
          docsList.style.display = 'flex';
          
          setTimeout(() => {
            docsList.classList.remove('fade-out');
            docsList.classList.add('fade-in');
          }, 50);
        }, 300);
        
        // Morph pie chart back to stack icon
        pieChartContainer.style.opacity = '0';
        pieChartContainer.style.transform = 'scale(0.8) rotate(-180deg)';
        
        setTimeout(() => {
          pieChartContainer.style.display = 'none';
          stackedIcon.style.opacity = '1';
          stackedIcon.style.transform = 'scale(1) rotate(0deg)';
        }, 300);
        
        // Update toggle icon back to stack
        toggleIcon.innerHTML = `
          <path d="M3 8L12 3L21 8L12 13L3 8Z"/>
          <path d="M3 12L12 17L21 12"/>
          <path d="M3 16L12 21L21 16"/>
        `;
        toggleBtn.classList.remove('active');
      }
    }

    function generatePieChart() {
      const pieChart = document.getElementById('pieChart');
      pieChart.innerHTML = '';
      
      if (currentTab === 'ratelock') {
        // Rate Lock pie chart - show time remaining (18 days out of ~24 days = 75%)
        const daysRemaining = 18;
        const totalDays = 24;
        const percentComplete = (daysRemaining / totalDays) * 100;
        
        const centerX = 140;
        const centerY = 140;
        const radius = 110;
        
        // Background circle (gray - expired portion)
        const bgCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        bgCircle.setAttribute('cx', centerX);
        bgCircle.setAttribute('cy', centerY);
        bgCircle.setAttribute('r', radius);
        bgCircle.setAttribute('fill', 'rgba(148, 163, 184, 0.2)');
        pieChart.appendChild(bgCircle);
        
        // Green arc for remaining time (starting from top, going clockwise)
        const angle = (percentComplete / 100) * 360;
        const endAngle = -90 + angle;
        const startX = centerX + radius * Math.cos((-90 * Math.PI) / 180);
        const startY = centerY + radius * Math.sin((-90 * Math.PI) / 180);
        const endX = centerX + radius * Math.cos((endAngle * Math.PI) / 180);
        const endY = centerY + radius * Math.sin((endAngle * Math.PI) / 180);
        const largeArc = angle > 180 ? 1 : 0;
        
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('d', `M ${centerX} ${centerY} L ${startX} ${startY} A ${radius} ${radius} 0 ${largeArc} 1 ${endX} ${endY} Z`);
        path.setAttribute('fill', '#10b981');
        path.setAttribute('stroke', 'rgba(16, 185, 129, 0.3)');
        path.setAttribute('stroke-width', '2');
        pieChart.appendChild(path);
        
        // Center circle (white background for text)
        const centerCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        centerCircle.setAttribute('cx', centerX);
        centerCircle.setAttribute('cy', centerY);
        centerCircle.setAttribute('r', radius * 0.65);
        centerCircle.setAttribute('fill', 'rgba(30, 41, 59, 0.95)');
        centerCircle.setAttribute('stroke', 'rgba(16, 185, 129, 0.3)');
        centerCircle.setAttribute('stroke-width', '2');
        pieChart.appendChild(centerCircle);
        
        // Center text - days remaining
        const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        text.setAttribute('x', centerX);
        text.setAttribute('y', centerY - 10);
        text.setAttribute('text-anchor', 'middle');
        text.setAttribute('fill', '#10b981');
        text.setAttribute('font-size', '42');
        text.setAttribute('font-weight', 'bold');
        text.textContent = daysRemaining;
        pieChart.appendChild(text);
        
        const subtext = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        subtext.setAttribute('x', centerX);
        subtext.setAttribute('y', centerY + 20);
        subtext.setAttribute('text-anchor', 'middle');
        subtext.setAttribute('fill', '#94a3b8');
        subtext.setAttribute('font-size', '16');
        subtext.textContent = 'days left';
        pieChart.appendChild(subtext);
        
      } else {
        // Original pie chart for Docs/Services
        const data = [
          { label: 'Loan Prep', value: 8, color: '#3b82f6' },
          { label: 'Initial Approval', value: 4, color: '#8b5cf6' },
          { label: 'Final Approval', value: 2, color: '#10b981' }
        ];
        
        const total = data.reduce((sum, item) => sum + item.value, 0);
        const centerX = 140;
        const centerY = 140;
        const radius = 110;
        
        let currentAngle = -90; // Start at top
      
      data.forEach((item, index) => {
        const percentage = item.value / total;
        const angle = percentage * 360;
        const endAngle = currentAngle + angle;
        
        // Convert angles to radians
        const startRad = (currentAngle * Math.PI) / 180;
        const endRad = (endAngle * Math.PI) / 180;
        
        // Calculate arc points
        const x1 = centerX + radius * Math.cos(startRad);
        const y1 = centerY + radius * Math.sin(startRad);
        const x2 = centerX + radius * Math.cos(endRad);
        const y2 = centerY + radius * Math.sin(endRad);
        
        // Large arc flag
        const largeArc = angle > 180 ? 1 : 0;
        
        // Create path
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        const pathData = `
          M ${centerX} ${centerY}
          L ${x1} ${y1}
          A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2}
          Z
        `;
        
        path.setAttribute('d', pathData);
        path.setAttribute('fill', item.color);
        path.setAttribute('stroke', 'rgba(255, 255, 255, 0.1)');
        path.setAttribute('stroke-width', '2');
        path.setAttribute('opacity', '0');
        path.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
        path.style.transitionDelay = `${index * 0.1}s`;
        
        pieChart.appendChild(path);
        
        // Animate in
        setTimeout(() => {
          path.setAttribute('opacity', '0.9');
        }, 50);
        
        // Add subtle hover effect - just brighten and slightly scale
        path.addEventListener('mouseenter', () => {
          path.setAttribute('opacity', '1');
          path.style.filter = 'brightness(1.2)';
          path.style.transform = 'scale(1.02)';
          path.style.transformOrigin = 'center';
        });
        
        path.addEventListener('mouseleave', () => {
          path.setAttribute('opacity', '0.9');
          path.style.filter = 'brightness(1)';
          path.style.transform = 'scale(1)';
        });
        
        // Add percentage label in the middle of each segment
        const midAngle = (currentAngle + endAngle) / 2;
        const midRad = (midAngle * Math.PI) / 180;
        const labelRadius = radius * 0.7; // Position label 70% out from center
        const labelX = centerX + labelRadius * Math.cos(midRad);
        const labelY = centerY + labelRadius * Math.sin(midRad);
        
        const percentText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        percentText.setAttribute('x', labelX);
        percentText.setAttribute('y', labelY);
        percentText.setAttribute('text-anchor', 'middle');
        percentText.setAttribute('dominant-baseline', 'middle');
        percentText.setAttribute('fill', 'white');
        percentText.setAttribute('font-size', '16');
        percentText.setAttribute('font-weight', 'bold');
        percentText.setAttribute('opacity', '0');
        percentText.style.pointerEvents = 'none';
        percentText.style.transition = 'opacity 0.3s ease';
        percentText.textContent = `${Math.round(percentage * 100)}%`;
        
        pieChart.appendChild(percentText);
        
        // Fade in percentage after segment animation
        setTimeout(() => {
          percentText.setAttribute('opacity', '1');
        }, 600 + (index * 100));
        
        currentAngle = endAngle;
      });
      
      // Add center circle for donut effect
      const centerCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
      centerCircle.setAttribute('cx', centerX);
      centerCircle.setAttribute('cy', centerY);
      centerCircle.setAttribute('r', '55');
      centerCircle.setAttribute('fill', 'rgba(30, 41, 59, 0.95)');
      pieChart.appendChild(centerCircle);
      
      // Add total count in center
      const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
      text.setAttribute('x', centerX);
      text.setAttribute('y', centerY - 5);
      text.setAttribute('text-anchor', 'middle');
      text.setAttribute('fill', 'white');
      text.setAttribute('font-size', '32');
      text.setAttribute('font-weight', 'bold');
      text.textContent = total;
      pieChart.appendChild(text);
      
      const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
      label.setAttribute('x', centerX);
      label.setAttribute('y', centerY + 20);
      label.setAttribute('text-anchor', 'middle');
      label.setAttribute('fill', '#94a3b8');
      label.setAttribute('font-size', '14');
      label.textContent = 'Total Docs';
      pieChart.appendChild(label);
      }
    }

    // Initialize
    updateDocumentsList();
    updateStackIcon();


    // Email Window State
    let emailWindowState = {
      isDragging: false,
      isMaximized: false,
      currentX: 0,
      currentY: 0,
      initialX: 0,
      initialY: 0,
      xOffset: 0,
      yOffset: 0,
      beforeMaximize: {
      beforeMinimize: null,
        top: '10%',
        left: '15%',
        width: '1200px',
        height: '700px'
      }
    };

    // Email Modal Functions
    function openEmailModal() {
      const modal = document.getElementById('emailModal');
      const container = document.querySelector('.email-container');
      modal.classList.add('active');
      
      // Don't prevent scrolling on main content
      // document.body.style.overflow = 'hidden';
      
      // Initialize drag listeners
      initializeDragging();
      
      // Initialize sidebar resize
      initSidebarResize();
      
      // Simulate connecting to Outlook 365
      console.log('Connecting to Outlook 365...');
    }

    function closeEmailModal() {
      const modal = document.getElementById('emailModal');
      const container = document.querySelector('.email-container');
      modal.classList.remove('active');
      container.classList.remove('minimized', 'dragging');
      
      // Reset window state
      emailWindowState.isMaximized = false;
      emailWindowState.isDragging = false;
      
      // document.body.style.overflow = 'auto';
    }

    function minimizeEmail() {
      const container = document.querySelector('.email-container');
      const isMinimized = container.classList.contains('minimized');
      const minimizeBtn = document.querySelector('.email-control-btn.minimize');
      
      if (isMinimized) {
        // Restore from minimized
        container.classList.remove('minimized');
        // Restore previous size if it was saved
        if (emailWindowState.beforeMinimize) {
          container.style.width = emailWindowState.beforeMinimize.width;
          container.style.height = emailWindowState.beforeMinimize.height;
        }
        // Change icon back to minimize
        minimizeBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"></path></svg>';
        minimizeBtn.title = 'Minimize';
      } else {
        // Save current size before minimizing
        emailWindowState.beforeMinimize = {
          width: container.style.width || '1200px',
          height: container.style.height || '700px'
        };
        // Minimize
        container.classList.add('minimized');
        // Force the minimized size
        container.style.width = '300px';
        container.style.height = '60px';
        // Change icon to expand/restore
        minimizeBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"></path></svg>';
        minimizeBtn.title = 'Restore';
      }
    }

    function toggleMaximizeEmail() {
      const container = document.querySelector('.email-container');
      
      if (emailWindowState.isMaximized) {
        // Restore to previous size and position
        container.style.top = emailWindowState.beforeMaximize.top;
        container.style.left = emailWindowState.beforeMaximize.left;
        container.style.width = emailWindowState.beforeMaximize.width;
        container.style.height = emailWindowState.beforeMaximize.height;
        container.style.transform = 'none';
        emailWindowState.isMaximized = false;
      } else {
        // Save current size and position
        emailWindowState.beforeMaximize = {
          top: container.style.top || '10%',
          left: container.style.left || '15%',
          width: container.style.width || '1200px',
          height: container.style.height || '700px'
        };
        
        // Maximize
        container.style.top = '2.5%';
        container.style.left = '2.5%';
        container.style.width = '95vw';
        container.style.height = '95vh';
        container.style.transform = 'none';
        emailWindowState.isMaximized = true;
      }
    }

    // Dragging functionality
    function initializeDragging() {
      const container = document.querySelector('.email-container');
      const header = document.querySelector('.email-header');
      
      if (!header || !container) return;
      
      header.addEventListener('mousedown', dragStart);
      document.addEventListener('mousemove', drag);
      document.addEventListener('mouseup', dragEnd);
    }

    function dragStart(e) {
      // Don't drag if clicking on buttons
      if (e.target.closest('button')) return;
      
      const container = document.querySelector('.email-container');
      
      // Don't drag if maximized
      if (emailWindowState.isMaximized) return;

      
      emailWindowState.isDragging = true;
      container.classList.add('dragging');
      
      // Get current position
      const rect = container.getBoundingClientRect();
      emailWindowState.initialX = e.clientX - rect.left;
      emailWindowState.initialY = e.clientY - rect.top;
    }

    function drag(e) {
      if (!emailWindowState.isDragging) return;
      
      e.preventDefault();
      
      const container = document.querySelector('.email-container');
      
      emailWindowState.currentX = e.clientX - emailWindowState.initialX;
      emailWindowState.currentY = e.clientY - emailWindowState.initialY;
      
      // Constrain to viewport
      const maxX = window.innerWidth - container.offsetWidth;
      const maxY = window.innerHeight - container.offsetHeight;
      
      emailWindowState.currentX = Math.max(0, Math.min(emailWindowState.currentX, maxX));
      emailWindowState.currentY = Math.max(0, Math.min(emailWindowState.currentY, maxY));
      
      container.style.left = emailWindowState.currentX + 'px';
      container.style.top = emailWindowState.currentY + 'px';
      container.style.right = 'auto';
      container.style.bottom = 'auto';
    }

    function dragEnd(e) {
      if (!emailWindowState.isDragging) return;
      
      emailWindowState.isDragging = false;
      
      const container = document.querySelector('.email-container');
      container.classList.remove('dragging');
    }

    // Close modal when clicking outside (only on overlay, not window)
    document.addEventListener('click', function(event) {
      const modal = document.getElementById('emailModal');
      const container = document.querySelector('.email-container');
      
      // Only close if clicking directly on overlay, not on container
      if (event.target === modal && !container.contains(event.target)) {
        // Optionally enable this to close on outside click
        // closeEmailModal();
      }
    });

    // Close modal with Escape key
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        const modal = document.getElementById('emailModal');
        if (modal && modal.classList.contains('active')) {
          closeEmailModal();
        }
      }
    });

    // Double-click header to maximize/restore
    document.addEventListener('DOMContentLoaded', function() {
      const header = document.querySelector('.email-header');
      if (header) {
        header.addEventListener('dblclick', function(e) {
          if (!e.target.closest('button')) {
            toggleMaximizeEmail();
          }
        });
      }
    });

    function switchFolder(folderName) {
      // Remove active class from all folders
      document.querySelectorAll('.email-folder').forEach(folder => {
        folder.classList.remove('active');
      });
      // Add active class to clicked folder
      event.currentTarget.classList.add('active');
      
      // Update folder title
      const folderTitle = folderName.charAt(0).toUpperCase() + folderName.slice(1);
      document.querySelector('.email-list-header h3').textContent = folderTitle;
      
      console.log('Switched to folder:', folderName);
    }

    function viewEmail(emailId) {
      // Remove active class from all email items
      document.querySelectorAll('.email-item').forEach(item => {
        item.classList.remove('active');
      });
      // Add active class to clicked email
      event.currentTarget.classList.add('active');
      // Remove unread status
      event.currentTarget.classList.remove('unread');
      
      console.log('Viewing email:', emailId);
    }

    function refreshEmails() {
      console.log('Refreshing emails...');
      const refreshBtn = event.currentTarget;
      const svg = refreshBtn.querySelector('svg');
      if (svg) {
        svg.style.transform = 'rotate(360deg)';
        svg.style.transition = 'transform 0.5s ease';
        setTimeout(() => {
          svg.style.transform = 'rotate(0deg)';
        }, 500);
      }
    }

    // Email Search Functions
    function handleEmailSearch(searchTerm) {
      console.log('Searching emails for:', searchTerm);
      
      if (!searchTerm || searchTerm.trim() === '') {
        // Show all emails if search is empty
        showAllEmails();
        return;
      }
      
      // Filter email items based on search term
      const emailItems = document.querySelectorAll('.email-item');
      const searchLower = searchTerm.toLowerCase();
      
      emailItems.forEach(item => {
        const sender = item.querySelector('.email-item-sender')?.textContent || '';
        const subject = item.querySelector('.email-item-subject')?.textContent || '';
        const preview = item.querySelector('.email-item-preview')?.textContent || '';
        
        const matches = 
          sender.toLowerCase().includes(searchLower) ||
          subject.toLowerCase().includes(searchLower) ||
          preview.toLowerCase().includes(searchLower);
        
        if (matches) {
          item.style.display = 'block';
          // Highlight matching text (optional enhancement)
        } else {


          item.style.display = 'none';
        }
      });
      
      // In production, this would search via Microsoft Graph API
      /*
      const response = await fetch(
        `https://graph.microsoft.com/v1.0/me/messages?$search="${searchTerm}"`,
        {
          headers: {
            'Authorization': `Bearer ${accessToken}`
          }
        }
      );
      */
    }

    function showAllEmails() {
      const emailItems = document.querySelectorAll('.email-item');
      emailItems.forEach(item => {
        item.style.display = 'block';
      });
    }

    function clearEmailSearch() {
      const searchInput = document.getElementById('emailSearchInput');
      if (searchInput) {
        searchInput.value = '';
        showAllEmails();
        searchInput.focus();
      }
    }

    // Add keyboard shortcut for search (Ctrl/Cmd + K)
    document.addEventListener('keydown', function(event) {
      if ((event.ctrlKey || event.metaKey) && event.key === 'k') {
        event.preventDefault();
        const modal = document.getElementById('emailModal');
        if (modal && modal.classList.contains('active')) {
          const searchInput = document.getElementById('emailSearchInput');
          if (searchInput) {
            searchInput.focus();
            searchInput.select();
          }
        }
      }
    });



    // Outlook 365 Integration (placeholder for MSAL authentication)
    // This is where you would initialize Microsoft Authentication Library
    /*
    const msalConfig = {
      auth: {
        clientId: 'YOUR_CLIENT_ID',
        authority: 'https://login.microsoftonline.com/common',
        redirectUri: window.location.origin
      }
    };
    
    const msalInstance = new msal.PublicClientApplication(msalConfig);
    
    async function connectOutlook365() {
      try {
        const loginRequest = {
          scopes: ['Mail.Read', 'Mail.Send']
        };
        const loginResponse = await msalInstance.loginPopup(loginRequest);
        console.log('Outlook 365 connected:', loginResponse);
        // Fetch emails after successful authentication
        await fetchEmails();
      } catch (error) {
        console.error('Outlook 365 connection failed:', error);
      }
    }
    
    async function fetchEmails() {
      const accounts = msalInstance.getAllAccounts();
      if (accounts.length > 0) {
        const accessTokenRequest = {
          scopes: ['Mail.Read'],
          account: accounts[0]
        };
        const accessTokenResponse = await msalInstance.acquireTokenSilent(accessTokenRequest);
        const accessToken = accessTokenResponse.accessToken;
        
        // Fetch emails using Microsoft Graph API
        const response = await fetch('https://graph.microsoft.com/v1.0/me/messages', {
          headers: {
            'Authorization': `Bearer ${accessToken}`
          }
        });
        const data = await response.json();
        console.log('Emails:', data);
        // Render emails in the UI
      }
    }
    */


    /*
    ==========================================
    FOLDER MANAGEMENT - MICROSOFT GRAPH API INTEGRATION
    ==========================================
    
    FEATURES IMPLEMENTED:
    1.  Create new custom folders
    2.  Create subfolders within custom folders
    3.  Rename custom folders
    4.  Delete custom folders (and their subfolders)
    5.  Collapse/expand folders with subfolders
    
    MICROSOFT GRAPH API ENDPOINTS:
    - GET /me/mailFolders - List all folders
    - POST /me/mailFolders - Create root folder
    - POST /me/mailFolders/{id}/childFolders - Create subfolder
    - PATCH /me/mailFolders/{id} - Rename folder
    - DELETE /me/mailFolders/{id} - Delete folder
    
    REQUIRED PERMISSIONS:
    - Mail.ReadWrite (for folder management)
    - MailboxSettings.ReadWrite (for custom folder settings)
    
    PRODUCTION SETUP:
    1. Uncomment all PRODUCTION CODE sections in:
       - createNewFolder()
       - renameFolder()
       - deleteFolder()
       - loadCustomFolders()
    2. Remove DEMO MODE alert() calls
    3. The folder structure will automatically sync with Outlook
    4. Subfolders are created using /childFolders endpoint
    5. System folders (Inbox, Sent, etc.) cannot be renamed/deleted
    
    DATA STRUCTURE:
    customFolders = [{
      id: string,                  // Graph API folder ID
      displayName: string,         // Folder name
      parentFolderId: string,      // Parent folder ID (null for root)
      childFolderCount: number,    // Number of subfolders
      unreadItemCount: number,     // Unread email count
      totalItemCount: number       // Total email count
    }]
    */


    // ==========================================
    // FOLDER MANAGEMENT FUNCTIONS
    // Microsoft Graph API Ready
    // ==========================================

    /**
     * Custom folders data structure
     * In production, this will be fetched from Microsoft Graph API
     */
    let customFolders = [];

    /**
     * Show new folder input
     */
    function showNewFolderInput(parentFolderId = null) {
      const inputWrapper = document.getElementById('newFolderInput');
      const input = document.getElementById('folderNameInput');
      
      inputWrapper.style.display = 'flex';
      input.focus();
      input.dataset.parentFolderId = parentFolderId || '';
      
      // If creating subfolder, show it near parent
      if (parentFolderId) {
        const parentFolder = document.querySelector(`[data-folder-id="${parentFolderId}"]`);
        if (parentFolder) {
          parentFolder.after(inputWrapper);
        }
      }
    }

    /**
     * Cancel folder input
     */
    function cancelFolderInput() {
      const inputWrapper = document.getElementById('newFolderInput');
      const input = document.getElementById('folderNameInput');
      
      inputWrapper.style.display = 'none';
      input.value = '';
      input.dataset.parentFolderId = '';
    }

    /**
     * Create new folder
     * Microsoft Graph API: POST /me/mailFolders
     */
    async function createNewFolder() {
      const input = document.getElementById('folderNameInput');
      const folderName = input.value.trim();
      const parentFolderId = input.dataset.parentFolderId;
      
      console.log('Creating folder:', folderName);
      
      if (!folderName) {
        alert('Please enter a folder name');
        return;
      }

      try {
        /* PRODUCTION CODE - Uncomment when Microsoft Graph API is connected:
        
        // Get access token
        const accessTokenResponse = await msalInstance.acquireTokenSilent(accessTokenRequest);
        const accessToken = accessTokenResponse.accessToken;
        
        // Determine API endpoint based on whether it's a subfolder
        const endpoint = parentFolderId 
          ? `https://graph.microsoft.com/v1.0/me/mailFolders/${parentFolderId}/childFolders`
          : 'https://graph.microsoft.com/v1.0/me/mailFolders';
        
        // Create folder via API
        const response = await fetch(endpoint, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${accessToken}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            displayName: folderName
          })
        });
        
        if (!response.ok) {
          throw new Error('Failed to create folder');
        }
        
        const newFolder = await response.json();
        
        // Add to local data structure
        customFolders.push({
          id: newFolder.id,
          displayName: newFolder.displayName,
          parentFolderId: newFolder.parentFolderId,
          childFolderCount: 0,
          unreadItemCount: 0,
          totalItemCount: 0
        });
        
        // Refresh folder list
        renderCustomFolders();
        
        alert(`Folder "${folderName}" created successfully`);
        */
        
        // DEMO MODE - Remove in production
        const newFolderId = 'custom_' + Date.now();
        customFolders.push({
          id: newFolderId,
          displayName: folderName,
          parentFolderId: parentFolderId || null,
          childFolderCount: 0,
          unreadItemCount: 0,
          totalItemCount: 0
        });
        
        console.log('Folder added to array:', customFolders);
        renderCustomFolders();
        alert(` Folder "${folderName}" created (Demo mode)`);
        console.log('Created folder:', { id: newFolderId, name: folderName, parentId: parentFolderId });
        
      } catch (error) {
        console.error('Error creating folder:', error);
        alert('Failed to create folder. Please try again.');
      }
      
      cancelFolderInput();
    }

    /**
     * Rename folder
     * Microsoft Graph API: PATCH /me/mailFolders/{id}
     */
    async function renameFolder(folderId, currentName) {
      const newName = prompt('Enter new folder name:', currentName);
      
      if (!newName || newName === currentName) {
        return;
      }

      try {
        /* PRODUCTION CODE - Uncomment when Microsoft Graph API is connected:
        
        const accessTokenResponse = await msalInstance.acquireTokenSilent(accessTokenRequest);
        const accessToken = accessTokenResponse.accessToken;
        
        const response = await fetch(`https://graph.microsoft.com/v1.0/me/mailFolders/${folderId}`, {
          method: 'PATCH',
          headers: {
            'Authorization': `Bearer ${accessToken}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            displayName: newName
          })
        });
        
        if (!response.ok) {
          throw new Error('Failed to rename folder');
        }
        
        // Update local data
        const folder = customFolders.find(f => f.id === folderId);
        if (folder) {
          folder.displayName = newName;
        }
        
        renderCustomFolders();
        alert(`Folder renamed to "${newName}"`);
        */
        
        // DEMO MODE
        const folder = customFolders.find(f => f.id === folderId);
        if (folder) {
          folder.displayName = newName;
          renderCustomFolders();
          alert(` Folder renamed to "${newName}" (Demo mode)`);
          console.log('Renamed folder:', { id: folderId, newName });
        }
        
      } catch (error) {
        console.error('Error renaming folder:', error);
        alert('Failed to rename folder. Please try again.');
      }
    }

    /**
     * Delete folder
     * Microsoft Graph API: DELETE /me/mailFolders/{id}
     */
    async function deleteFolder(folderId, folderName) {
      if (!confirm(`Delete folder "${folderName}"? This action cannot be undone.`)) {
        return;
      }

      try {
        /* PRODUCTION CODE - Uncomment when Microsoft Graph API is connected:
        
        const accessTokenResponse = await msalInstance.acquireTokenSilent(accessTokenRequest);
        const accessToken = accessTokenResponse.accessToken;
        
        const response = await fetch(`https://graph.microsoft.com/v1.0/me/mailFolders/${folderId}`, {
          method: 'DELETE',
          headers: {
            'Authorization': `Bearer ${accessToken}`
          }
        });
        
        if (!response.ok) {
          throw new Error('Failed to delete folder');
        }
        
        // Remove from local data (including subfolders)
        customFolders = customFolders.filter(f => 
          f.id !== folderId && f.parentFolderId !== folderId
        );
        
        renderCustomFolders();
        alert(`Folder "${folderName}" deleted`);
        */
        
        // DEMO MODE
        customFolders = customFolders.filter(f => 
          f.id !== folderId && f.parentFolderId !== folderId
        );
        
        renderCustomFolders();
        alert(` Folder "${folderName}" deleted (Demo mode)`);
        console.log('Deleted folder:', { id: folderId, name: folderName });
        
      } catch (error) {
        console.error('Error deleting folder:', error);
        alert('Failed to delete folder. Please try again.');
      }
    }

    /**
     * Toggle folder collapse/expand (for folders with subfolders)
     */
    function toggleFolderCollapse(folderId) {
      const folder = document.querySelector(`[data-folder-id="${folderId}"]`);
      if (folder) {
        folder.classList.toggle('collapsed');
      }
    }

    /**
     * Render custom folders
     */
    function renderCustomFolders() {
      const container = document.getElementById('customFolders');
      
      if (customFolders.length === 0) {
        container.innerHTML = '<div style="color: #64748b; font-size: 0.75rem; padding: 0.5rem 0.75rem;">No custom folders</div>';
        return;
      }
      
      // Organize folders by parent
      const rootFolders = customFolders.filter(f => !f.parentFolderId);
      
      let html = '';
      
      rootFolders.forEach(folder => {
        html += renderFolderItem(folder);
        
        // Render subfolders
        const subfolders = customFolders.filter(f => f.parentFolderId === folder.id);
        subfolders.forEach(subfolder => {
          html += renderFolderItem(subfolder, true);
        });
      });
      
      container.innerHTML = html;
    }

    /**
     * Render individual folder item
     */
    function renderFolderItem(folder, isSubfolder = false) {
      const hasSubfolders = customFolders.some(f => f.parentFolderId === folder.id);
      const subfolderClass = isSubfolder ? 'subfolder' : '';
      
      return `
        <div class="email-folder custom-folder ${subfolderClass}" data-folder-id="${folder.id}" onclick="switchFolder('${folder.id}', this)">
          ${hasSubfolders ? `
            <div class="folder-toggle" onclick="event.stopPropagation(); toggleFolderCollapse('${folder.id}')">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </div>
          ` : ''}
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
          </svg>
          <span class="email-folder-name">${folder.displayName}</span>
          ${folder.unreadItemCount > 0 ? `<span class="email-folder-count">${folder.unreadItemCount}</span>` : ''}
          <div class="folder-actions">
            ${!isSubfolder ? `
              <button class="folder-action-btn" onclick="event.stopPropagation(); showNewFolderInput('${folder.id}')" title="Add subfolder">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 5v14M5 12h14"></path>
                </svg>
              </button>
            ` : ''}
            <button class="folder-action-btn" onclick="event.stopPropagation(); renameFolder('${folder.id}', '${folder.displayName}')" title="Rename">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
              </svg>
            </button>
            <button class="folder-action-btn delete" onclick="event.stopPropagation(); deleteFolder('${folder.id}', '${folder.displayName}')" title="Delete">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
            </button>
          </div>
        </div>
      `;
    }

    /**
     * Load custom folders from Microsoft Graph API
     * Call this on email modal open
     */
    async function loadCustomFolders() {
      try {
        /* PRODUCTION CODE - Uncomment when Microsoft Graph API is connected:
        
        const accessTokenResponse = await msalInstance.acquireTokenSilent(accessTokenRequest);
        const accessToken = accessTokenResponse.accessToken;
        
        const response = await fetch('https://graph.microsoft.com/v1.0/me/mailFolders?$filter=parentFolderId ne null', {
          headers: {
            'Authorization': `Bearer ${accessToken}`
          }
        });
        
        const data = await response.json();
        
        // Filter out system folders and populate customFolders array
        customFolders = data.value.filter(folder => {
          const systemFolders = ['inbox', 'drafts', 'sentitems', 'deleteditems', 'junkemail', 'archive'];
          return !systemFolders.includes(folder.displayName.toLowerCase());
        }).map(folder => ({
          id: folder.id,
          displayName: folder.displayName,
          parentFolderId: folder.parentFolderId,
          childFolderCount: folder.childFolderCount || 0,
          unreadItemCount: folder.unreadItemCount || 0,
          totalItemCount: folder.totalItemCount || 0
        }));
        
        renderCustomFolders();
        */
        
        // DEMO MODE - Start with empty folders
        customFolders = [];
        renderCustomFolders();
        
      } catch (error) {
        console.error('Error loading folders:', error);
      }
    }

    // Initialize folders when email modal opens
    document.addEventListener('DOMContentLoaded', function() {
      // Load folders when needed
      loadCustomFolders();
    });

    /**
     * Update switchFolder function to handle folder element parameter
     */
    function switchFolder(folderId, folderElement) {
      // Remove active class from all folders
      document.querySelectorAll('.email-folder').forEach(f => f.classList.remove('active'));
      
      // Add active class to clicked folder
      if (folderElement) {
        folderElement.classList.add('active');
      }
      
      // Update email list header
      const header = document.querySelector('.email-list-header h3');
      const folderName = folderElement ? folderElement.querySelector('.email-folder-name').textContent : folderId;
      if (header) {
        header.textContent = folderName;
      }
      
      // Load emails for this folder (existing functionality)
      console.log('Switched to folder:', folderId);
      
      /* PRODUCTION CODE - Load emails from selected folder:
      loadEmailsFromFolder(folderId);
      */
    }


    /**
     * Block sender - Adds sender to blocked senders list
     * Uses Microsoft Graph API: POST /me/inferenceClassification/overrides
     */
    async function blockSender() {
      if (!confirm('Block this sender? You will no longer receive emails from this address in your inbox.')) {
        return;
      }

      try {
        const currentSenderEmail = getCurrentSenderEmail();
        
        if (!currentSenderEmail) {
          alert('No sender information available');
          return;
        }

        /* PRODUCTION CODE - Uncomment when Microsoft Graph API is connected:
        
        // Get access token
        const accessTokenResponse = await msalInstance.acquireTokenSilent(accessTokenRequest);
        const accessToken = accessTokenResponse.accessToken;
        
        // Create Inbox Rule to move sender's emails to Junk
        const ruleResponse = await fetch('https://graph.microsoft.com/v1.0/me/mailFolders/inbox/messageRules', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${accessToken}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            displayName: `Block ${currentSenderEmail}`,
            sequence: 1,
            isEnabled: true,
            conditions: {
              senderContains: [currentSenderEmail]
            },
            actions: {
              moveToFolder: 'junkemail',
              stopProcessingRules: true
            }
          })
        });
        
        if (ruleResponse.ok) {
          alert(`Sender blocked: ${currentSenderEmail}`);
          await markAsSpam();
        } else {
          throw new Error('Failed to block sender');
        }
        */
        
        // DEMO MODE - Remove this in production
        alert(` Sender blocked: ${currentSenderEmail} (Demo mode - Connect Graph API for live functionality)`);
        console.log('Would block sender:', currentSenderEmail);
        
      } catch (error) {
        console.error('Error blocking sender:', error);
        alert('Failed to block sender. Please try again.');
      }
    }

    // Helper functions for tracking current email
    let currentEmailId = null;
    let currentSenderEmail = null;
    let currentSenderName = null;

    function getCurrentEmailId() {
      return currentEmailId;
    }

    function getCurrentSenderEmail() {
      return currentSenderEmail;
    }

    function getCurrentSenderName() {
      return currentSenderName;
    }

    function setCurrentEmail(emailId, senderEmail, senderName) {
      currentEmailId = emailId;
      currentSenderEmail = senderEmail;
      currentSenderName = senderName;
    }

    function removeEmailFromView(emailId) {
      const emailElement = document.querySelector(`[data-email-id="${emailId}"]`);
      if (emailElement) {
        emailElement.style.opacity = '0';
        emailElement.style.transform = 'translateX(-100%)';
        setTimeout(() => emailElement.remove(), 300);
      }
    }

    // ==========================================
    // SIDEBAR RESIZE FUNCTIONALITY
    // ==========================================
    
    /**
     * Initialize sidebar resizing
     */
    function initSidebarResize() {
      const resizeHandle = document.querySelector('.sidebar-resize-handle');
      const sidebar = document.querySelector('.email-sidebar');
      
      if (!resizeHandle || !sidebar) return;
      
      let isResizing = false;
      let startX = 0;
      let startWidth = 0;
      
      resizeHandle.addEventListener('mousedown', function(e) {
        isResizing = true;
        startX = e.clientX;
        startWidth = sidebar.offsetWidth;
        
        document.body.style.cursor = 'col-resize';
        document.body.style.userSelect = 'none';
        
        e.preventDefault();
      });
      
      document.addEventListener('mousemove', function(e) {
        if (!isResizing) return;
        
        const deltaX = e.clientX - startX;
        const newWidth = startWidth + deltaX;
        
        // Apply min and max constraints
        const minWidth = 150;
        const maxWidth = 400;
        
        if (newWidth >= minWidth && newWidth <= maxWidth) {
          sidebar.style.width = newWidth + 'px';
        }
      });
      
      document.addEventListener('mouseup', function() {
        if (isResizing) {
          isResizing = false;
          document.body.style.cursor = '';
          document.body.style.userSelect = '';
        }
      });
    }
    
    // Initialize resize when email modal opens
    document.addEventListener('DOMContentLoaded', function() {
      // Wait for modal to be added to DOM
      setTimeout(() => {
        initSidebarResize();
      }, 100);
    });

// ==========================================
    // EMAIL COMPOSER FUNCTIONS
    // Microsoft Graph API Production Ready
    // ==========================================

    /**
     * Open Email Composer
     */
    function openEmailComposer() {
      const composer = document.getElementById('emailComposer');
      composer.classList.add('active');
      document.getElementById('composerEditor').focus();
    }

    /**
     * Close Email Composer
     */
    function closeEmailComposer() {
      const composer = document.getElementById('emailComposer');
      
      // Confirm if there's content
      const editor = document.getElementById('composerEditor');
      const to = document.getElementById('composerTo').value;
      const subject = document.getElementById('composerSubject').value;
      
      if (editor.innerHTML.trim() || to || subject) {
        if (!confirm('Discard this email?')) {
          return;
        }
      }
      
      composer.classList.remove('active');
      clearComposer();
    }

    /**
     * Clear composer fields
     */
    function clearComposer() {
      document.getElementById('composerTo').value = '';
      document.getElementById('composerCC').value = '';
      document.getElementById('composerBCC').value = '';
      document.getElementById('composerSubject').value = '';
      document.getElementById('composerEditor').innerHTML = '';
      document.getElementById('composerAttachments').innerHTML = '';
      document.getElementById('ccField').style.display = 'none';
      document.getElementById('bccField').style.display = 'none';
      attachedFiles = [];
    }

    /**
     * Toggle CC field
     */
    function toggleCCField() {
      const ccField = document.getElementById('ccField');
      ccField.style.display = ccField.style.display === 'none' ? 'block' : 'none';
      if (ccField.style.display === 'block') {
        document.getElementById('composerCC').focus();
      }
    }

    /**
     * Toggle BCC field
     */
    function toggleBCCField() {
      const bccField = document.getElementById('bccField');
      bccField.style.display = bccField.style.display === 'none' ? 'block' : 'none';
      if (bccField.style.display === 'block') {
        document.getElementById('composerBCC').focus();
      }
    }

    /**
     * Format text in editor
     */
    function formatText(command, value = null) {
      document.execCommand(command, false, value);
      document.getElementById('composerEditor').focus();
    }

    /**
     * Apply font family
     */
    function applyFontFamily(font) {
      formatText('fontName', font);
    }

    /**
     * Apply font size
     */
    function applyFontSize(size) {
      formatText('fontSize', size);
    }

    /**
     * Apply text color
     */
    function applyTextColor(color) {
      formatText('foreColor', color);
    }

    /**
     * Apply highlight color
     */
    function applyHighlight(color) {
      formatText('backColor', color);
    }

    /**
     * Toggle emoji picker
     */
    function toggleEmojiPicker() {
      const picker = document.getElementById('emojiPicker');
      picker.classList.toggle('active');
    }

    /**
     * Insert emoji at cursor
     */
    function insertEmoji(emoji) {
      const editor = document.getElementById('composerEditor');
      editor.focus();
      document.execCommand('insertText', false, emoji);
      toggleEmojiPicker();
    }

    /**
     * Handle file attachments
     */
    let attachedFiles = [];

    function handleFileAttach(files) {
      const container = document.getElementById('composerAttachments');
      
      Array.from(files).forEach((file, index) => {
        attachedFiles.push(file);
        
        const attachItem = document.createElement('div');
        attachItem.className = 'attachment-item';
        attachItem.innerHTML = `
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
            <polyline points="13 2 13 9 20 9"></polyline>
          </svg>
          <span>${file.name} (${formatFileSize(file.size)})</span>
          <button class="attachment-remove" onclick="removeAttachment(${attachedFiles.length - 1})"></button>
        `;
        container.appendChild(attachItem);
      });
    }

    /**
     * Remove attachment
     */
    function removeAttachment(index) {
      attachedFiles.splice(index, 1);
      const container = document.getElementById('composerAttachments');
      container.children[index].remove();
    }

    /**
     * Format file size
     */
    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }

    /**
     * Toggle voice read (Text-to-Speech)
     */
    let speechSynthesis = window.speechSynthesis;
    let currentUtterance = null;

    function toggleVoiceRead() {
      const editor = document.getElementById('composerEditor');
      const voiceIndicator = document.getElementById('voiceRecording');
      
      if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
        voiceIndicator.classList.remove('active');
        return;
      }
      
      const text = editor.innerText;
      if (!text.trim()) {
        alert('No content to read');
        return;
      }
      
      currentUtterance = new SpeechSynthesisUtterance(text);
      currentUtterance.rate = 1.0;
      currentUtterance.pitch = 1.0;
      currentUtterance.volume = 1.0;
      
      currentUtterance.onstart = () => {
        voiceIndicator.classList.add('active');
      };
      
      currentUtterance.onend = () => {
        voiceIndicator.classList.remove('active');
      };
      
      speechSynthesis.speak(currentUtterance);
    }

    /**
     * Send Email via Microsoft Graph API
     * PRODUCTION READY - Uncomment when Graph API is connected
     */
    async function sendEmail() {
      const to = document.getElementById('composerTo').value;
      const cc = document.getElementById('composerCC').value;
      const bcc = document.getElementById('composerBCC').value;
      const subject = document.getElementById('composerSubject').value;
      const body = document.getElementById('composerEditor').innerHTML;
      
      // Validation
      if (!to) {
        alert('Please enter a recipient email address');
        document.getElementById('composerTo').focus();
        return;
      }
      
      if (!subject) {
        alert('Please enter a subject');
        document.getElementById('composerSubject').focus();
        return;
      }
      
      if (!body.trim()) {
        alert('Please enter a message');
        document.getElementById('composerEditor').focus();
        return;
      }
      
      // Parse email addresses
      const toRecipients = to.split(',').map(email => ({
        emailAddress: { address: email.trim() }
      }));
      
      const ccRecipients = cc ? cc.split(',').map(email => ({
        emailAddress: { address: email.trim() }
      })) : [];
      
      const bccRecipients = bcc ? bcc.split(',').map(email => ({
        emailAddress: { address: email.trim() }
      })) : [];
      
      // Build email message
      const message = {
        subject: subject,
        body: {
          contentType: 'HTML',
          content: body
        },
        toRecipients: toRecipients,
        ccRecipients: ccRecipients,
        bccRecipients: bccRecipients
      };
      
      // Add attachments if any
      if (attachedFiles.length > 0) {
        message.attachments = await prepareAttachments();
      }
      
      try {
        /* PRODUCTION CODE - Uncomment when Microsoft Graph API is connected:
        
        // Get access token
        const accessTokenResponse = await msalInstance.acquireTokenSilent(accessTokenRequest);
        const accessToken = accessTokenResponse.accessToken;
        
        // Send email via Graph API
        const response = await fetch('https://graph.microsoft.com/v1.0/me/sendMail', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${accessToken}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            message: message,
            saveToSentItems: true
          })
        });
        
        if (response.ok) {
          alert(' Email sent successfully!');
          closeEmailComposer();
          // Optionally refresh email list
          // refreshEmails();
        } else {
          const error = await response.json();
          throw new Error(error.error.message || 'Failed to send email');
        }
        */
        
        // DEMO MODE - Remove this in production
        console.log('Email data to send:', {
          to: to,
          cc: cc,
          bcc: bcc,
          subject: subject,
          bodyHTML: body,
          attachments: attachedFiles.map(f => ({ name: f.name, size: f.size }))
        });
        
        alert(` Email would be sent to: ${to}\n\nSubject: ${subject}\n\n(Demo mode - Connect Microsoft Graph API for live functionality)`);
        closeEmailComposer();
        
      } catch (error) {
        console.error('Error sending email:', error);
        alert('Failed to send email: ' + error.message);
      }
    }

    /**
     * Prepare attachments for Graph API
     * Converts files to base64 format required by Graph API
     */
    async function prepareAttachments() {
      const attachments = [];
      
      for (const file of attachedFiles) {
        const base64 = await fileToBase64(file);
        attachments.push({
          '@odata.type': '#microsoft.graph.fileAttachment',
          name: file.name,
          contentType: file.type || 'application/octet-stream',
          contentBytes: base64
        });
      }
      
      return attachments;
    }

    /**
     * Convert file to base64
     */
    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
          // Remove data URL prefix
          const base64 = reader.result.split(',')[1];
          resolve(base64);
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    /**
     * Update New Email button to open composer
     */
    document.addEventListener('DOMContentLoaded', function() {
      const newEmailBtn = document.querySelector('.new-email-btn');
      if (newEmailBtn) {
        newEmailBtn.onclick = openEmailComposer;
      }
    });




    // ==========================================
    // VOICE TO TEXT FEATURE
    // ==========================================

    let recognition = null;
    let isRecording = false;

    function toggleVoiceToText() {
      if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
        alert('Voice recognition not supported. Use Chrome, Edge, or Safari.');
        return;
      }
      isRecording ? stopVoiceRecognition() : startVoiceRecognition();
    }

    function startVoiceRecognition() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.continuous = true;
      recognition.interimResults = true;
      recognition.lang = 'en-US';
      
      const editor = document.getElementById('composerEditor');
      const voiceBtn = document.getElementById('voiceToTextBtn');
      let finalTranscript = '';
      
      recognition.onstart = () => {
        isRecording = true;
        voiceBtn.classList.add('recording');
      };
      
      recognition.onresult = (event) => {
        let interimTranscript = '';
        for (let i = event.resultIndex; i < event.results.length; i++) {
          const transcript = event.results[i][0].transcript;
          if (event.results[i].isFinal) {
            finalTranscript += transcript + ' ';
          } else {
            interimTranscript += transcript;
          }
        }
        const currentText = editor.textContent;
        const baseText = currentText.replace(interimTranscript, '').trim();
        editor.textContent = baseText + ' ' + finalTranscript + interimTranscript;
        
        const range = document.createRange();
        const sel = window.getSelection();
        range.selectNodeContents(editor);
        range.collapse(false);
        sel.removeAllRanges();
        sel.addRange(range);
      };
      
      recognition.onerror = (event) => {
        stopVoiceRecognition();
        if (event.error === 'no-speech') alert('No speech detected.');
        else if (event.error === 'not-allowed') alert('Microphone access denied.');
        else alert('Voice error: ' + event.error);
      };
      
      recognition.onend = () => { if (isRecording) recognition.start(); };
      recognition.start();
    }

    function stopVoiceRecognition() {
      if (recognition) {
        isRecording = false;
        recognition.stop();
        document.getElementById('voiceToTextBtn').classList.remove('recording');
      }
    }

    // ==========================================
    // GPT REVIEW FEATURE
    // ==========================================

    let currentEmailContent = '';

    function openGPTReview() {
      const editor = document.getElementById('composerEditor');
      const subject = document.getElementById('composerSubject').value;
      currentEmailContent = editor.innerHTML || editor.textContent;
      
      if (!currentEmailContent.trim() && !subject.trim()) {
        alert('Please write email content before using GPT Review.');
        return;
      }
      
      document.getElementById('gptModal').classList.add('active');
      analyzeEmailWithGPT(subject, currentEmailContent);
    }

    function closeGPTModal() {
      document.getElementById('gptModal').classList.remove('active');
      document.getElementById('gptLoading').style.display = 'flex';
      document.getElementById('gptResults').style.display = 'none';
    }

    async function analyzeEmailWithGPT(subject, content) {
      const loadingDiv = document.getElementById('gptLoading');
      const resultsDiv = document.getElementById('gptResults');
      const previewDiv = document.getElementById('gptPreview');
      const suggestionsDiv = document.getElementById('gptSuggestionsList');
      
      loadingDiv.style.display = 'flex';
      resultsDiv.style.display = 'none';
      
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      /* PRODUCTION: Uncomment for OpenAI API
      const response = await fetch('https://api.openai.com/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer YOUR_API_KEY'
        },
        body: JSON.stringify({
          model: 'gpt-4',
          messages: [
            { role: 'system', content: 'You are an email writing assistant.' },
            { role: 'user', content: `Subject: ${subject}\n\n${content}` }
          ]
        })
      });
      */
      
      const demoSuggestions = [
        { title: 'Tone', text: 'Add a warmer greeting for better rapport.' },
        { title: 'Clarity', text: 'Break long paragraphs for readability.' },
        { title: 'Professional', text: 'Add clear call-to-action at the end.' },
        { title: 'Grammar', text: 'No major issues detected. Well done!' }
      ];
      
      previewDiv.innerHTML = content || '<em style="color: #64748b;">No content</em>';
      suggestionsDiv.innerHTML = demoSuggestions.map(s => 
        `<div class="gpt-suggestion-item"><strong style="color: #a78bfa;">${s.title}:</strong> ${s.text}</div>`
      ).join('');
      
      loadingDiv.style.display = 'none';
      resultsDiv.style.display = 'block';
    }

    function applyGPTSuggestions() {
      alert('Review suggestions and update email manually.\nIn production, AI can auto-improve text.');
      closeGPTModal();
    }


    function toggleStar(event, emailId) {
      event.stopPropagation();
      const starElement = event.currentTarget;
      starElement.classList.toggle('starred');
      console.log('Email ' + emailId + ' starred: ' + starElement.classList.contains('starred'));
    }


    // ==========================================

// EMAIL SIGNATURE MANAGER
    // ==========================================

    let currentSignature = {
      name: 'Default',
      data: {
        firstName: '',
        lastName: '',
        title: '',
        nmls: '',
        company: '',
        email: '',
        phone: '',
        website: '',
        photo: null,
        logo: null,
        accentColor: '#6366f1',
        emailIcon: '',
        phoneIcon: '',
        websiteIcon: '',
        ctaText: '',
        schedulerType: 'none',
        schedulerUsername: '',
        schedulerButtonText: 'Schedule a Meeting',
        badgeStyle: 'button',
        ctaUrl: '',
        autoApply: 'all',
        fieldOrder: ['photo', 'logo', 'name', 'title', 'nmls', 'company', 'email', 'phone', 'website'],
        fieldVisibility: {
          photo: true,
          logo: true,
          name: true,
          title: true,
          nmls: true,
          company: true,
          email: true,
          phone: true,
          website: true
        },
        formatting: {
          firstName: { font: 'Arial, sans-serif', size: '16', color: '#1e293b', bold: true, italic: false, underline: false, highlight: false, highlightColor: '#fef08a' },
          lastName: { font: 'Arial, sans-serif', size: '16', color: '#1e293b', bold: true, italic: false, underline: false, highlight: false, highlightColor: '#fef08a' },
          title: { font: 'Arial, sans-serif', size: '14', color: '#64748b', bold: false, italic: false, underline: false, highlight: false, highlightColor: '#fef08a' },
          nmls: { font: 'Arial, sans-serif', size: '13', color: '#94a3b8', bold: false, italic: false, underline: false, highlight: false, highlightColor: '#fef08a' },
          company: { font: 'Arial, sans-serif', size: '13', color: '#94a3b8', bold: false, italic: false, underline: false, highlight: false, highlightColor: '#fef08a' },
          email: { font: 'Arial, sans-serif', size: '13', color: '#64748b', bold: false, italic: false, underline: false, highlight: false, highlightColor: '#fef08a' },
          phone: { font: 'Arial, sans-serif', size: '13', color: '#64748b', bold: false, italic: false, underline: false, highlight: false, highlightColor: '#fef08a' },
          website: { font: 'Arial, sans-serif', size: '13', color: '#64748b', bold: false, italic: false, underline: false, highlight: false, highlightColor: '#fef08a' }
        }
      }
    };



    function closeSignatureManager() {
      document.getElementById('signatureModal').classList.remove('active');
    }

    function loadSignatureData() {
      // Load from localStorage or default
      const saved = localStorage.getItem('emailSignatures');
      if (saved) {
        // Load saved signatures
        console.log('Loading saved signatures');
      }
      updateSignaturePreview();
    }

    function selectTemplate(templateName) {
      // Remove active from all
      document.querySelectorAll('.signature-template-card').forEach(card => {
        card.classList.remove('active');
      });
      
      // Add active to clicked
      event.currentTarget.classList.add('active');
      
      // Load template data
      console.log('Selected template:', templateName);
    }

    function createNewSignature() {
      const name = prompt('Enter signature template name:');
      if (name) {
        // Create new template
        const newCard = document.createElement('div');
        newCard.className = 'signature-template-card';
        newCard.onclick = () => selectTemplate(name);
        newCard.innerHTML = `
          <div class="signature-template-name">${name}</div>
          <div class="signature-template-info">New emails  Created just now</div>
        `;
        document.getElementById('signatureTemplatesList').appendChild(newCard);
      }
    }

    function updateSignaturePreview() {
      const firstName = document.getElementById('sigFirstName').value;
      const lastName = document.getElementById('sigLastName').value;
      const title = document.getElementById('sigTitle').value;
      const nmls = document.getElementById('sigNMLS').value;
      const company = document.getElementById('sigCompany').value;
      const email = document.getElementById('sigEmail').value;
      const phone = document.getElementById('sigPhone').value;
      const website = document.getElementById('sigWebsite').value;
      const ctaText = document.getElementById('sigCtaText').value;
      const ctaUrl = document.getElementById('sigCtaUrl').value;
      const accentColor = document.getElementById('sigColor').value;
      
      // Get icons
      const emailIcon = document.getElementById('emailIcon').value;
      const phoneIcon = document.getElementById('phoneIcon').value;
      const websiteIcon = document.getElementById('websiteIcon').value;

      const fieldOrder = currentSignature.data.fieldOrder;
      const fieldVis = currentSignature.data.fieldVisibility;
      
      let html = '<div style="display: flex; gap: 15px; line-height: 1.6;">';
      
      let photoHtml = '';
      let mainHtml = '';
      
      // Build fields according to order
      fieldOrder.forEach(field => {
        if (!fieldVis[field]) return; // Skip hidden fields
        
        switch(field) {
          case 'photo':
            if (currentSignature.data.photo) {
              photoHtml = `<div style="flex-shrink: 0;">
                <img src="${currentSignature.data.photo}" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 2px solid ${accentColor};">
              </div>`;
            }
            break;
            
          case 'logo':
            if (currentSignature.data.logo) {
              mainHtml += `<div style="margin-bottom: 10px;">
                <img src="${currentSignature.data.logo}" style="max-width: 120px; max-height: 40px; object-fit: contain;">
              </div>`;
            }
            break;
            
          case 'name':
      
            if (firstName || lastName) {
              mainHtml += '<div style="margin-bottom: 4px;">';
              if (firstName) mainHtml += `<span style="${getFieldStyle('firstName')}">${firstName}</span>`;
              if (firstName && lastName) mainHtml += ' ';
              if (lastName) mainHtml += `<span style="${getFieldStyle('lastName')}">${lastName}</span>`;
              mainHtml += '</div>';
            }
            break;
            
          case 'title':
            if (title) {
              mainHtml += `<div style="${getFieldStyle('title')}margin-bottom: 2px;">${title}</div>`;
            }
            break;
            
          case 'nmls':
            if (nmls) {
              mainHtml += `<div style="${getFieldStyle('nmls')}margin-bottom: 2px;">NMLS #${nmls}</div>`;
            }
            break;
            
          case 'company':
            if (company) {
              mainHtml += `<div style="${getFieldStyle('company')}margin-bottom: 8px;">${company}</div>`;
            }
            break;
            
          case 'email':
            if (email) {
              const icon = emailIcon ? emailIcon + ' ' : '';
              mainHtml += `<div style="${getFieldStyle('email')}margin-bottom: 4px; margin-top: 8px; padding-top: 8px; border-top: 1px solid ${accentColor};">${icon}${email}</div>`;
            }
            break;
            
          case 'phone':
            if (phone) {
              const icon = phoneIcon ? phoneIcon + ' ' : '';
              mainHtml += `<div style="${getFieldStyle('phone')}margin-bottom: 4px;">${icon}${phone}</div>`;
            }
            break;
            
          case 'website':
            if (website) {
              const icon = websiteIcon ? websiteIcon + ' ' : '';
              mainHtml += `<div style="${getFieldStyle('website')}margin-bottom: 4px;">${icon}${website}</div>`;
            }
            break;
        }
      });
      
      // Assemble final HTML
      html += photoHtml;
      html += '<div style="flex: 1;">' + mainHtml + '</div>';
      html += '</div>'; // Close flex container

      document.getElementById('signaturePreview').innerHTML = html;

      // Update CTA preview
      const finalCtaText = document.getElementById('sigCtaText').value;
      const finalCtaUrl = document.getElementById('sigCtaUrl').value;
      const badgeStyle = currentSignature.data.badgeStyle || 'button';
      
      if (finalCtaText && finalCtaUrl) {
        document.getElementById('ctaPreview').style.display = 'block';
        const container = document.getElementById('ctaButtonContainer');
        container.innerHTML = generateSchedulerBadge(finalCtaText, finalCtaUrl, badgeStyle, accentColor);
      } else {
        document.getElementById('ctaPreview').style.display = 'none';
      }
    }

    function updateAccentColor(color) {
      document.querySelector('.signature-color-swatch').style.background = color;
      updateSignaturePreview();
    }

    function toggleSetting(element, setting) {
      // Remove active from siblings in same group
      const siblings = element.parentElement.querySelectorAll('.signature-checkbox-card');
      siblings.forEach(card => card.classList.remove('active'));
      
      // Add active to clicked
      element.classList.add('active');
      
      currentSignature.data.autoApply = setting;
    }

    function saveSignature() {
      // Collect all signature data
      const signatureData = {
        firstName: document.getElementById('sigFirstName').value,
        lastName: document.getElementById('sigLastName').value,
        title: document.getElementById('sigTitle').value,
        nmls: document.getElementById('sigNMLS').value,
        company: document.getElementById('sigCompany').value,
        email: document.getElementById('sigEmail').value,
        photo: currentSignature.data.photo,
        logo: currentSignature.data.logo,
        phone: document.getElementById('sigPhone').value,
        website: document.getElementById('sigWebsite').value,
        font: document.getElementById('sigFont').value,
        fontSize: document.getElementById('sigFontSize').value,
        textColor: document.getElementById('sigTextColor').value,
        highlightColor: document.getElementById('sigHighlightColor').value,
        emailIcon: document.getElementById('emailIcon').value,
        phoneIcon: document.getElementById('phoneIcon').value,
        websiteIcon: document.getElementById('websiteIcon').value,
        bold: currentSignature.data.bold,
        italic: currentSignature.data.italic,
        underline: currentSignature.data.underline,
        highlight: currentSignature.data.highlight,
        ctaText: document.getElementById('sigCtaText').value,
        schedulerType: currentSignature.data.schedulerType,
        schedulerUsername: currentSignature.data.schedulerUsername,
        schedulerButtonText: currentSignature.data.schedulerButtonText,
        badgeStyle: currentSignature.data.badgeStyle,
        ctaUrl: document.getElementById('sigCtaUrl').value,
        accentColor: document.getElementById('sigColor').value,
        autoApply: currentSignature.data.autoApply
      };

      // Save to localStorage
      localStorage.setItem('currentSignature', JSON.stringify(signatureData));

      // Generate HTML for Outlook
      const signatureHTML = generateOutlookSignatureHTML(signatureData);
      
      /* PRODUCTION: Update via Microsoft Graph API
      await fetch('/me/mailboxSettings', {
        method: 'PATCH',
        headers: {
          'Authorization': 'Bearer ' + accessToken,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          automaticRepliesSetting: {
            internalReplyMessage: signatureHTML,
            externalReplyMessage: signatureHTML
          }
        })
      });
      */

      alert(' Signature saved successfully!\n\nIn production, this will sync with your Microsoft 365 account.');
      closeSignatureManager();
    }

    function generateOutlookSignatureHTML(data) {
      // Generate table-based HTML for maximum email client compatibility
      let html = '<table cellpadding="0" cellspacing="0" border="0" style="font-family: Arial, sans-serif;">';
      html += '<tr>';
      
      // Photo column (if exists)
      if (data.photo) {
        html += `<td style="padding-right: 15px; vertical-align: top;">
          <img src="${data.photo}" width="80" height="80" style="border-radius: 50%; display: block; border: 2px solid ${data.accentColor};">
        </td>`;
      }
      
      html += '<td style="padding: 10px 0;">';
      
      // Logo at top (if exists)
      if (data.logo) {
        html += `<div style="margin-bottom: 10px;">
          <img src="${data.logo}" style="max-width: 120px; max-height: 40px; display: block;">
        </div>`;
      }
      
      const fullName = [data.firstName, data.lastName].filter(Boolean).join(' ');
      if (fullName) {
        html += `<strong style="font-size: ${parseInt(data.fontSize) + 2}px; color: ${data.textColor}; display: block; margin-bottom: 2px;">${fullName}</strong>`;
      }
      
      if (data.title) {
        html += `<span style="font-size: ${data.fontSize}px; color: #666; display: block; margin-bottom: 2px;">${data.title}</span>`;
      }
      
      if (data.nmls) {
        html += `<span style="font-size: ${parseInt(data.fontSize) - 1}px; color: #999; display: block; margin-bottom: 2px;">NMLS #${data.nmls}</span>`;
      }
      
      if (data.company) {
        html += `<span style="font-size: ${parseInt(data.fontSize) - 1}px; color: #999; display: block; margin-bottom: 8px;">${data.company}</span>`;
      }

      if (data.email || data.phone || data.website) {
        html += `<div style="margin-top: 10px; padding-top: 10px; border-top: 2px solid ${data.accentColor};">`;
        
        if (data.email) {
          const icon = data.emailIcon ? data.emailIcon + ' ' : '';
          html += `<div style="font-size: ${parseInt(data.fontSize) - 1}px; color: #666; margin-bottom: 3px;">${icon}<a href="mailto:${data.email}" style="color: #666; text-decoration: none;">${data.email}</a></div>`;
        }
        
        if (data.phone) {
          const icon = data.phoneIcon ? data.phoneIcon + ' ' : '';
          html += `<div style="font-size: ${parseInt(data.fontSize) - 1}px; color: #666; margin-bottom: 3px;">${icon}${data.phone}</div>`;
        }
        
        if (data.website) {
          const icon = data.websiteIcon ? data.websiteIcon + ' ' : '';
          html += `<div style="font-size: ${parseInt(data.fontSize) - 1}px; color: #666; margin-bottom: 3px;">${icon}<a href="${data.website}" style="color: #666; text-decoration: none;">${data.website}</a></div>`;
        }
        
        html += '</div>';
      }

      if (data.ctaText && data.ctaUrl) {
        const badgeStyle = data.badgeStyle || 'button';
        let ctaHtml = '';
        
        switch(badgeStyle) {
          case 'button':
            ctaHtml = `<div style="margin-top: 15px;"><a href="${data.ctaUrl}" style="display: inline-block; padding: 10px 20px; background: ${data.accentColor}; color: white; text-decoration: none; border-radius: 6px; font-size: 14px; font-weight: 600;">${data.ctaText}</a></div>`;
            break;
          case 'badge':
            ctaHtml = `<div style="margin-top: 15px;"><a href="${data.ctaUrl}" style="display: inline-flex; align-items: center; gap: 6px; padding: 6px 14px; background: rgba(99, 102, 241, 0.1); color: ${data.accentColor}; text-decoration: none; border-radius: 20px; font-size: 13px; font-weight: 600; border: 1px solid ${data.accentColor};"> ${data.ctaText}</a></div>`;
            break;
          case 'link':
            ctaHtml = `<div style="margin-top: 15px;"><a href="${data.ctaUrl}" style="color: ${data.accentColor}; text-decoration: none; font-size: 13px; font-weight: 600; border-bottom: 2px solid ${data.accentColor};"> ${data.ctaText}</a></div>`;
            break;
        }
        
        html += ctaHtml;
      }

      html += '</td>';
      html += '</tr></table>';
      return html;
    }

    function deleteSignature() {
      if (confirm('Are you sure you want to delete this signature?')) {
        // Delete logic
        alert('Signature deleted');
      }
    }

    function duplicateSignature() {
      const name = prompt('Enter name for duplicated signature:');
      if (name) {
        alert('Signature duplicated: ' + name);
      }
    }



    function loadFieldFormatting() {
      const field = document.getElementById('formatField').value;
      const fmt = currentSignature.data.formatting[field];
      
      // Load current formatting for selected field
      document.getElementById('sigFont').value = fmt.font;
      document.getElementById('sigFontSize').value = fmt.size;
      document.getElementById('sigTextColor').value = fmt.color;
      document.getElementById('sigHighlightColor').value = fmt.highlightColor;
      
      // Update color swatches
      document.getElementById('textColorSwatch').style.background = fmt.color;
      document.getElementById('highlightColorSwatch').style.background = fmt.highlightColor;
      
      // Update style buttons
      document.getElementById('boldBtn').classList.toggle('active', fmt.bold);
      document.getElementById('italicBtn').classList.toggle('active', fmt.italic);
      document.getElementById('underlineBtn').classList.toggle('active', fmt.underline);
      document.getElementById('highlightBtn').classList.toggle('active', fmt.highlight);
      
      // Show/hide highlight color
      document.getElementById('highlightColorGroup').style.display = fmt.highlight ? 'block' : 'none';
    }

    function applyFieldFormatting() {
      const field = document.getElementById('formatField').value;
      const fmt = currentSignature.data.formatting[field];
      
      fmt.font = document.getElementById('sigFont').value;
      fmt.size = document.getElementById('sigFontSize').value;
      
      updateSignaturePreview();
    }

    function updateFieldTextColor(color) {
      const field = document.getElementById('formatField').value;
      currentSignature.data.formatting[field].color = color;
      document.getElementById('textColorSwatch').style.background = color;
      updateSignaturePreview();
    }

    function updateFieldHighlightColor(color) {
      const field = document.getElementById('formatField').value;
      currentSignature.data.formatting[field].highlightColor = color;
      document.getElementById('highlightColorSwatch').style.background = color;
      updateSignaturePreview();
    }

    function toggleFieldTextStyle(element, style) {
      const field = document.getElementById('formatField').value;
      const fmt = currentSignature.data.formatting[field];
      
      element.classList.toggle('active');
      fmt[style] = element.classList.contains('active');
      
      if (style === 'highlight') {
        document.getElementById('highlightColorGroup').style.display = 
          element.classList.contains('active') ? 'block' : 'none';
      }
      
      updateSignaturePreview();
    }

    function getFieldStyle(field) {
      const fmt = currentSignature.data.formatting[field];
      let style = `font-family: ${fmt.font}; font-size: ${fmt.size}px; color: ${fmt.color};`;
      if (fmt.bold) style += ' font-weight: bold;';
      if (fmt.italic) style += ' font-style: italic;';
      if (fmt.underline) style += ' text-decoration: underline;';
      if (fmt.highlight) style += ` background: ${fmt.highlightColor}; padding: 0 4px;`;
      return style;
    }


    // ==========================================
    // MEETING SCHEDULER INTEGRATION
    // ==========================================

    function updateSchedulerFields() {
      const type = document.getElementById('schedulerType').value;
      const schedulerFields = document.getElementById('schedulerFields');
      const customFields = document.getElementById('customCtaFields');
      
      if (type === 'none') {
        schedulerFields.style.display = 'none';
        customFields.style.display = 'block';
      } else {
        schedulerFields.style.display = 'block';
        customFields.style.display = 'none';
        currentSignature.data.schedulerType = type;
        updateSchedulerUrl();
      }
      
      updateSignaturePreview();
    }

    function updateSchedulerUrl() {
      const type = document.getElementById('schedulerType').value;
      const username = document.getElementById('schedulerUsername').value;
      const preview = document.getElementById('schedulerUrlPreview');
      
      currentSignature.data.schedulerUsername = username;
      
      let url = '';
      switch(type) {
        case 'calendly':
          url = username ? `https://calendly.com/${username}` : '';
          break;
        case 'cal':
          url = username ? `https://cal.com/${username}` : '';
          break;
        case 'microsoft':
          url = username ? `https://outlook.office.com/bookwithme/user/${username}` : '';
          break;
        case 'custom':
          url = username;
          break;
      }
      
      preview.textContent = url || 'Enter username to see full URL';
      preview.style.color = url ? '#6366f1' : '#94a3b8';
      
      // Auto-fill the CTA URL
      if (url) {
        document.getElementById('sigCtaUrl').value = url;
      }
      
      updateSignaturePreview();
    }

    function updateCtaText() {
      const select = document.getElementById('schedulerButtonText');
      const customGroup = document.getElementById('customTextGroup');
      
      if (select.value === 'custom') {
        customGroup.style.display = 'block';
      } else {
        customGroup.style.display = 'none';
        document.getElementById('sigCtaText').value = select.value;
        currentSignature.data.schedulerButtonText = select.value;
        updateSignaturePreview();
      }
    }

    function updateCustomCtaText() {
      const text = document.getElementById('customCtaText').value;
      document.getElementById('sigCtaText').value = text;
      currentSignature.data.schedulerButtonText = text;
      updateSignaturePreview();
    }

    function selectBadgeStyle(element, style) {
      // Remove active from siblings
      element.parentElement.querySelectorAll('.signature-checkbox-card').forEach(card => {
        card.classList.remove('active');
      });
      
      element.classList.add('active');
      currentSignature.data.badgeStyle = style;
      updateSignaturePreview();
    }

    function generateSchedulerBadge(text, url, style, accentColor) {
      if (!text || !url) return '';
      
      let html = '';
      
      switch(style) {
        case 'button':
          html = `<a href="${url}" style="display: inline-block; padding: 10px 20px; background: ${accentColor}; color: white; text-decoration: none; border-radius: 6px; font-size: 14px; font-weight: 600; margin-top: 12px;">${text}</a>`;
          break;
        case 'badge':
          html = `<a href="${url}" style="display: inline-flex; align-items: center; gap: 6px; padding: 6px 14px; background: rgba(99, 102, 241, 0.1); color: ${accentColor}; text-decoration: none; border-radius: 20px; font-size: 13px; font-weight: 600; border: 1px solid ${accentColor}; margin-top: 12px;">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            ${text}
          </a>`;
          break;
        case 'link':
          html = `<a href="${url}" style="display: inline-block; color: ${accentColor}; text-decoration: none; font-size: 13px; font-weight: 600; margin-top: 12px; border-bottom: 2px solid ${accentColor};"> ${text}</a>`;
          break;
      }
      
      return html;
    }


    // ==========================================
    // IMAGE UPLOAD HANDLERS
    // ==========================================

    function initializeImageUpload() {
      const photoInput = document.getElementById('sigPhoto');
      const logoInput = document.getElementById('sigLogo');
      
      if (photoInput) {
        photoInput.addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
              currentSignature.data.photo = event.target.result;
              document.getElementById('removePhotoBtn').style.display = 'block';
              document.getElementById('photoUploadText').textContent = 'Replace Photo';
              updateSignaturePreview();
            };
            reader.readAsDataURL(file);
          }
        });
      }

      if (logoInput) {
        logoInput.addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
              currentSignature.data.logo = event.target.result;
              document.getElementById('removeLogoBtn').style.display = 'block';
              document.getElementById('logoUploadText').textContent = 'Replace Logo';
              updateSignaturePreview();
            };
            reader.readAsDataURL(file);
          }
        });
      }
    }

    // Initialize when signature modal opens
    function openSignatureManager() {
      document.getElementById('signatureModal').classList.add('active');
      loadSignatureData();
      
      // Initialize features after modal is open
      setTimeout(() => {
        initializeImageUpload();
        initializeDragAndDrop();
      }, 100);
    }


    // ==========================================

// MEETING SCHEDULER INTEGRATION
    // ==========================================

    function updateSchedulerFields() {
      const type = document.getElementById('schedulerType').value;
      const schedulerFields = document.getElementById('schedulerFields');
      const customFields = document.getElementById('customCtaFields');
      
      if (type === 'none') {
        schedulerFields.style.display = 'none';
        customFields.style.display = 'block';
      } else {
        schedulerFields.style.display = 'block';
        customFields.style.display = 'none';
        currentSignature.data.schedulerType = type;
        updateSchedulerUrl();
      }
      
      updateSignaturePreview();
    }

    function updateSchedulerUrl() {
      const type = document.getElementById('schedulerType').value;
      const username = document.getElementById('schedulerUsername').value;
      const preview = document.getElementById('schedulerUrlPreview');
      
      currentSignature.data.schedulerUsername = username;
      
      let url = '';
      switch(type) {
        case 'calendly':
          url = username ? `https://calendly.com/${username}` : '';
          break;
        case 'cal':
          url = username ? `https://cal.com/${username}` : '';
          break;
        case 'microsoft':
          url = username ? `https://outlook.office.com/bookwithme/user/${username}` : '';
          break;
        case 'custom':
          url = username;
          break;
      }
      
      preview.textContent = url || 'Enter username to see full URL';
      preview.style.color = url ? '#6366f1' : '#94a3b8';
      
      // Auto-fill the CTA URL
      if (url) {
        document.getElementById('sigCtaUrl').value = url;
      }
      
      updateSignaturePreview();
    }

    function updateCtaText() {
      const select = document.getElementById('schedulerButtonText');
      const customGroup = document.getElementById('customTextGroup');
      
      if (select.value === 'custom') {
        customGroup.style.display = 'block';
      } else {
        customGroup.style.display = 'none';
        document.getElementById('sigCtaText').value = select.value;
        currentSignature.data.schedulerButtonText = select.value;
        updateSignaturePreview();
      }
    }

    function updateCustomCtaText() {
      const text = document.getElementById('customCtaText').value;
      document.getElementById('sigCtaText').value = text;
      currentSignature.data.schedulerButtonText = text;
      updateSignaturePreview();
    }

    function selectBadgeStyle(element, style) {
      // Remove active from siblings
      element.parentElement.querySelectorAll('.signature-checkbox-card').forEach(card => {
        card.classList.remove('active');
      });
      
      element.classList.add('active');
      currentSignature.data.badgeStyle = style;
      updateSignaturePreview();
    }

    function generateSchedulerBadge(text, url, style, accentColor) {
      if (!text || !url) return '';
      
      let html = '';
      
      switch(style) {
        case 'button':
          html = `<a href="${url}" style="display: inline-block; padding: 10px 20px; background: ${accentColor}; color: white; text-decoration: none; border-radius: 6px; font-size: 14px; font-weight: 600; margin-top: 12px;">${text}</a>`;
          break;
        case 'badge':
          html = `<a href="${url}" style="display: inline-flex; align-items: center; gap: 6px; padding: 6px 14px; background: rgba(99, 102, 241, 0.1); color: ${accentColor}; text-decoration: none; border-radius: 20px; font-size: 13px; font-weight: 600; border: 1px solid ${accentColor}; margin-top: 12px;">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            ${text}
          </a>`;
          break;
        case 'link':
          html = `<a href="${url}" style="display: inline-block; color: ${accentColor}; text-decoration: none; font-size: 13px; font-weight: 600; margin-top: 12px; border-bottom: 2px solid ${accentColor};"> ${text}</a>`;
          break;
      }
      
      return html;
    }


    // ==========================================
    // IMAGE UPLOAD HANDLERS
    // ==========================================

    function initializeImageUpload() {
      const photoInput = document.getElementById('sigPhoto');
      const logoInput = document.getElementById('sigLogo');
      
      if (photoInput) {
        photoInput.addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
              currentSignature.data.photo = event.target.result;
              document.getElementById('removePhotoBtn').style.display = 'block';
              document.getElementById('photoUploadText').textContent = 'Replace Photo';
              updateSignaturePreview();
            };
            reader.readAsDataURL(file);
          }
        });
      }

      if (logoInput) {
        logoInput.addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
              currentSignature.data.logo = event.target.result;
              document.getElementById('removeLogoBtn').style.display = 'block';
              document.getElementById('logoUploadText').textContent = 'Replace Logo';
              updateSignaturePreview();
            };
            reader.readAsDataURL(file);
          }
        });
      }
    }

    // Initialize when signature modal opens
    function openSignatureManager() {
      document.getElementById('signatureModal').classList.add('active');
      loadSignatureData();
      
      // Initialize features after modal is open
      setTimeout(() => {
        initializeImageUpload();
        initializeDragAndDrop();
      }, 100);
    }


    // ==========================================
    // DRAG AND DROP FIELD REORDERING
    // ==========================================

    let draggedElement = null;

    function initializeDragAndDrop() {
      const items = document.querySelectorAll('.field-reorder-item');
      
      items.forEach(item => {
        item.addEventListener('dragstart', handleDragStart);
        item.addEventListener('dragend', handleDragEnd);
        item.addEventListener('dragover', handleDragOver);
        item.addEventListener('drop', handleDrop);
        item.addEventListener('dragleave', handleDragLeave);
      });
    }

    function handleDragStart(e) {
      draggedElement = this;
      this.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/html', this.innerHTML);
    }

    function handleDragEnd(e) {
      this.classList.remove('dragging');
      
      // Remove drag-over class from all items
      document.querySelectorAll('.field-reorder-item').forEach(item => {
        item.classList.remove('drag-over');
      });
      
      draggedElement = null;
    }

    function handleDragOver(e) {
      if (e.preventDefault) {
        e.preventDefault();
      }
      
      e.dataTransfer.dropEffect = 'move';
      
      if (draggedElement !== this) {
        this.classList.add('drag-over');
      }
      
      return false;
    }

    function handleDragLeave(e) {
      this.classList.remove('drag-over');
    }

    function handleDrop(e) {
      if (e.stopPropagation) {
        e.stopPropagation();
      }
      
      if (draggedElement !== this) {
        // Get the parent container
        const container = this.parentNode;
        const allItems = [...container.querySelectorAll('.field-reorder-item')];
        
        const draggedIndex = allItems.indexOf(draggedElement);
        const targetIndex = allItems.indexOf(this);
        
        // Reorder in DOM
        if (draggedIndex < targetIndex) {
          this.parentNode.insertBefore(draggedElement, this.nextSibling);
        } else {
          this.parentNode.insertBefore(draggedElement, this);
        }
        
        // Update field order in data
        updateFieldOrder();
        
        // Update preview
        updateSignaturePreview();
      }
      
      this.classList.remove('drag-over');
      return false;
    }

    function updateFieldOrder() {
      const items = document.querySelectorAll('.field-reorder-item');
      const newOrder = [];
      
      items.forEach(item => {
        newOrder.push(item.getAttribute('data-field'));
      });
      
      currentSignature.data.fieldOrder = newOrder;
    }

    function toggleFieldVisibility(event, field) {
      event.stopPropagation();
      
      const toggle = event.currentTarget;
      toggle.classList.toggle('visible');
      
      currentSignature.data.fieldVisibility[field] = toggle.classList.contains('visible');
      
      updateSignaturePreview();
    }


    function removePhoto() {
      currentSignature.data.photo = null;
      document.getElementById('sigPhoto').value = '';
      document.getElementById('removePhotoBtn').style.display = 'none';
      document.getElementById('photoUploadText').textContent = 'Upload Photo';
      updateSignaturePreview();
    }

    function removeLogo() {
      currentSignature.data.logo = null;
      document.getElementById('sigLogo').value = '';
      document.getElementById('removeLogoBtn').style.display = 'none';
      document.getElementById('logoUploadText').textContent = 'Upload Logo';
      updateSignaturePreview();
    }


    // ==========================================
    // MEETING SCHEDULER FUNCTIONS
    // ==========================================

    function insertMeetingLink() {
      // Get saved scheduler info from signature settings
      const savedSig = localStorage.getItem('currentSignature');
      let schedulerUrl = '';
      let schedulerType = 'Calendly';
      
      if (savedSig) {
        const sig = JSON.parse(savedSig);
        if (sig.schedulerType && sig.schedulerUsername) {
          switch(sig.schedulerType) {
            case 'calendly':
              schedulerUrl = `https://calendly.com/${sig.schedulerUsername}`;
              schedulerType = 'Calendly';
              break;
            case 'cal':
              schedulerUrl = `https://cal.com/${sig.schedulerUsername}`;
              schedulerType = 'Cal.com';
              break;
            case 'microsoft':
              schedulerUrl = `https://outlook.office.com/bookwithme/user/${sig.schedulerUsername}`;
              schedulerType = 'Microsoft Bookings';
              break;
          }
        }
      }
      
      // If no saved scheduler, prompt user
      if (!schedulerUrl) {
        schedulerUrl = prompt('Enter your meeting scheduler link (Calendly, Cal.com, etc.):');
        if (!schedulerUrl) return;
      }
      
      // Insert formatted meeting link into email composer
      const emailBody = document.getElementById('composerEditor');
      const meetingHTML = `
<br><br>
<div style="padding: 15px; background: #f8fafc; border-left: 4px solid #6366f1; border-radius: 4px; margin: 20px 0;">
  <p style="margin: 0 0 10px 0; font-weight: 600; color: #1e293b;"> Let's Schedule a Meeting</p>
  <p style="margin: 0 0 10px 0; color: #475569; font-size: 14px;">Pick a time that works best for you:</p>
  <a href="${schedulerUrl}" style="display: inline-block; padding: 10px 20px; background: #6366f1; color: white; text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 14px;">Schedule a Time</a>
</div>
<br>`;
      
      emailBody.innerHTML += meetingHTML;
      emailBody.focus();
      
      // Show success notification
      showNotification('Meeting link inserted!', 'success');
    }

    function openScheduleMeetingModal() {
      alert('Schedule Meeting Modal\n\nIn production, this would open a modal to:\n Select date/time\n Choose meeting type (Zoom, Teams, Phone, In-person)\n Add participants\n Sync with Microsoft 365 Calendar');
    }

    function joinMeeting(link) {
      showNotification('Opening meeting...', 'success');
      // In production: window.open(link, '_blank');
    }

    function rescheduleMeeting(meetingId) {
      if (confirm('Would you like to reschedule this meeting?')) {
        showNotification('Opening reschedule options...', 'info');
        // In production: Open reschedule modal with Microsoft Graph API
      }
    }

    function getMeetingDirections(location) {
      showNotification('Opening directions...', 'success');
      // In production: Open Google Maps/Apple Maps with location
    }

    function showNotification(message, type) {
      // Create notification element
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 1rem 1.5rem;
        background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
        color: white;
        border-radius: 0.5rem;
        box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        z-index: 10000;
        font-weight: 600;
        font-size: 0.875rem;
        animation: slideIn 0.3s ease;
      `;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      // Remove after 3 seconds
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // ==========================================
    // DRAGGABLE FILTER BUTTONS
    // ==========================================


    // Placeholder for metrics customization
    function openMetricsModal() {
      alert('Metrics customization feature coming soon!\n\n Select up to 8 metrics\n Drag to reorder\n Save your preferences');
    }
  </script>

</html>
